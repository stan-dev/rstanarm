<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate subject-specific or standardised survival probabilities — posterior_survfit • rstanarm</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate subject-specific or standardised survival probabilities — posterior_survfit"><meta name="description" content="This function allows us to generate estimated survival probabilities
based on draws from the posterior predictive distribution. By default
the survival probabilities are conditional on an individual's
group-specific coefficients (i.e. their individual-level random
effects). If prediction data is provided via the newdataLong
and newdataEvent arguments, then the default behaviour is to
sample new group-specific coefficients for the individuals in the
new data using a Monte Carlo scheme that conditions on their
longitudinal outcome data provided in newdataLong
(sometimes referred to as &quot;dynamic predictions&quot;, see Rizopoulos
(2011)). This default behaviour can be stopped by specifying
dynamic = FALSE, in which case the predicted survival
probabilities will be marginalised over the distribution of the
group-specific coefficients. This has the benefit that the user does
not need to provide longitudinal outcome measurements for the new
individuals, however, it does mean that the predictions will incorporate
all the uncertainty associated with between-individual variation, since
the predictions aren't conditional on any observed data for the individual.
In addition, by default, the predicted subject-specific survival
probabilities are conditional on observed values of the fixed effect
covariates (ie, the predictions will be obtained using either the design
matrices used in the original stan_jm model call, or using the
covariate values provided in the newdataLong and newdataEvent
arguments). However, if you wish to average over the observed distribution
of the fixed effect covariates then this is possible – such predictions
are sometimes referred to as standardised survival probabilties – see the
standardise argument below."><meta property="og:description" content="This function allows us to generate estimated survival probabilities
based on draws from the posterior predictive distribution. By default
the survival probabilities are conditional on an individual's
group-specific coefficients (i.e. their individual-level random
effects). If prediction data is provided via the newdataLong
and newdataEvent arguments, then the default behaviour is to
sample new group-specific coefficients for the individuals in the
new data using a Monte Carlo scheme that conditions on their
longitudinal outcome data provided in newdataLong
(sometimes referred to as &quot;dynamic predictions&quot;, see Rizopoulos
(2011)). This default behaviour can be stopped by specifying
dynamic = FALSE, in which case the predicted survival
probabilities will be marginalised over the distribution of the
group-specific coefficients. This has the benefit that the user does
not need to provide longitudinal outcome measurements for the new
individuals, however, it does mean that the predictions will incorporate
all the uncertainty associated with between-individual variation, since
the predictions aren't conditional on any observed data for the individual.
In addition, by default, the predicted subject-specific survival
probabilities are conditional on observed values of the fixed effect
covariates (ie, the predictions will be obtained using either the design
matrices used in the original stan_jm model call, or using the
covariate values provided in the newdataLong and newdataEvent
arguments). However, if you wish to average over the observed distribution
of the fixed effect covariates then this is possible – such predictions
are sometimes referred to as standardised survival probabilties – see the
standardise argument below."><meta property="og:image" content="https://mc-stan.org/rstanarm/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Estimate subject-specific or standardised survival probabilities</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/New-pkgdown-theme/R/posterior_survfit.R" class="external-link"><code>R/posterior_survfit.R</code></a></small>
      <div class="d-none name"><code>posterior_survfit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function allows us to generate estimated survival probabilities
based on draws from the posterior predictive distribution. By default
the survival probabilities are conditional on an individual's
group-specific coefficients (i.e. their individual-level random
effects). If prediction data is provided via the <code>newdataLong</code>
and <code>newdataEvent</code> arguments, then the default behaviour is to
sample new group-specific coefficients for the individuals in the
new data using a Monte Carlo scheme that conditions on their
longitudinal outcome data provided in <code>newdataLong</code>
(sometimes referred to as "dynamic predictions", see Rizopoulos
(2011)). This default behaviour can be stopped by specifying
<code>dynamic = FALSE</code>, in which case the predicted survival
probabilities will be marginalised over the distribution of the
group-specific coefficients. This has the benefit that the user does
not need to provide longitudinal outcome measurements for the new
individuals, however, it does mean that the predictions will incorporate
all the uncertainty associated with between-individual variation, since
the predictions aren't conditional on any observed data for the individual.
In addition, by default, the predicted subject-specific survival
probabilities are conditional on observed values of the fixed effect
covariates (ie, the predictions will be obtained using either the design
matrices used in the original <code><a href="stan_jm.html">stan_jm</a></code> model call, or using the
covariate values provided in the <code>newdataLong</code> and <code>newdataEvent</code>
arguments). However, if you wish to average over the observed distribution
of the fixed effect covariates then this is possible – such predictions
are sometimes referred to as standardised survival probabilties – see the
<code>standardise</code> argument below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">posterior_survfit</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  newdataLong <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  newdataEvent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extrapolate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  condition <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  last_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prob <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  <span class="va">ids</span>,</span>
<span>  times <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  standardise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dynamic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  draws <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A fitted model object returned by the
<code><a href="stan_jm.html">stan_jm</a></code> modelling function. See
<code><a href="stanreg-objects.html">stanreg-objects</a></code>.</p></dd>


<dt id="arg-newdatalong-newdataevent">newdataLong, newdataEvent<a class="anchor" aria-label="anchor" href="#arg-newdatalong-newdataevent"></a></dt>
<dd><p>Optionally, a data frame (or in the case of
<code>newdataLong</code> this can be a list of data frames) in which to look
for variables with which to predict. If omitted, the model matrices are used.
If new data is provided, then it should also contain the longitudinal
outcome data on which to condition when drawing the new group-specific
coefficients for individuals in the new data. Note that there is only
allowed to be one row of data for each individual in <code>newdataEvent</code>,
that is, time-varying covariates are not allowed in the prediction data for
the event submodel. Also, <code>newdataEvent</code> can optionally include a
variable with information about the last known survival time for the new
individuals – see the description for the <code>last_time</code> argument below
– however also note that when generating the survival probabilities it
is of course assumed that all individuals in <code>newdataEvent</code> have not
yet experienced the event (that is, any variable in <code>newdataEvent</code> that
corresponds to the event indicator will be ignored).</p></dd>


<dt id="arg-extrapolate">extrapolate<a class="anchor" aria-label="anchor" href="#arg-extrapolate"></a></dt>
<dd><p>A logical specifying whether to extrapolate the estimated
survival probabilities beyond the times specified in the <code>times</code> argument.
If <code>TRUE</code> then the extrapolation can be further controlled using
the <code>control</code> argument.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>A named list with parameters controlling extrapolation
  of the estimated survival function when <code>extrapolate = TRUE</code>. The list
  can contain one or more of the following named elements: <br></p><dl><dt><code>epoints</code></dt>
<dd><p>a positive integer specifying the number of
    discrete time points at which to calculate the forecasted survival
    probabilities. The default is 10.</p></dd>

    <dt><code>edist</code></dt>
<dd><p>a positive scalar specifying the amount of time
    across which to forecast the estimated survival function, represented
    in units of the time variable <code>time_var</code> (from fitting the model).
    The default is to extrapolate between the times specified in the
    <code>times</code> argument and the maximum event or censoring time in the
    original data. If <code>edist</code> leads to times that are beyond
    the maximum event or censoring time in the original data then the
    estimated survival probabilities will be truncated at that point, since
    the estimate for the baseline hazard is not available beyond that time.</p></dd>


</dl></dd>


<dt id="arg-condition">condition<a class="anchor" aria-label="anchor" href="#arg-condition"></a></dt>
<dd><p>A logical specifying whether the estimated
subject-specific survival probabilities at time <code>t</code> should be
conditioned on survival up to a fixed time point <code>u</code>. The default
is for <code>condition</code> to be set to <code>TRUE</code>, unless standardised survival
probabilities have been requested (by specifying <code>standardise = TRUE</code>),
in which case <code>condition</code> must (and will) be set to <code>FALSE</code>.
When conditional survival probabilities are requested, the fixed
time point <code>u</code> will be either: (i) the value specified via the
<code>last_time</code> argument; or if the <code>last_time</code> argument is
<code>NULL</code> then the latest observation time for each individual
(taken to be the value in the <code>times</code> argument if <code>newdataEvent</code>
is specified, or the observed event or censoring time if <code>newdataEvent</code>
is <code>NULL</code>.</p></dd>


<dt id="arg-last-time">last_time<a class="anchor" aria-label="anchor" href="#arg-last-time"></a></dt>
<dd><p>A scalar, character string, or <code>NULL</code>. This argument
specifies the last known survival time for each individual when
conditional predictions are being obtained. If
<code>newdataEvent</code> is provided and conditional survival predictions are being
obtained, then the <code>last_time</code> argument can be one of the following:
(i) a scalar, this will use the same last time for each individual in
<code>newdataEvent</code>; (ii) a character string, naming a column in
<code>newdataEvent</code> in which to look for the last time for each individual;
(iii) <code>NULL</code>, in which case the default is to use the time of the latest
longitudinal observation in <code>newdataLong</code>. If <code>newdataEvent</code> is
<code>NULL</code> then the <code>last_time</code> argument cannot be specified
directly; instead it will be set equal to the event or censoring time for
each individual in the dataset that was used to estimate the model.
If standardised survival probabilities are requested (i.e.
<code>standardise = TRUE</code>) then conditional survival probabilities are
not allowed and therefore the <code>last_time</code> argument is ignored.</p></dd>


<dt id="arg-prob">prob<a class="anchor" aria-label="anchor" href="#arg-prob"></a></dt>
<dd><p>A scalar between 0 and 1 specifying the width to use for the
uncertainty interval (sometimes called credible interval) for the predictions.
For example <code>prob = 0.95</code> (the default) means that the 2.5th and 97.5th
percentiles will be provided.</p></dd>


<dt id="arg-ids">ids<a class="anchor" aria-label="anchor" href="#arg-ids"></a></dt>
<dd><p>An optional vector specifying a subset of IDs for whom the
predictions should be obtained. The default is to predict for all individuals
who were used in estimating the model or, if <code>newdataLong</code> and
<code>newdataEvent</code> are specified, then all individuals contained in
the new data.</p></dd>


<dt id="arg-times">times<a class="anchor" aria-label="anchor" href="#arg-times"></a></dt>
<dd><p>A scalar, a character string, or <code>NULL</code>. Specifies the
times at which the estimated survival probabilities should be calculated.
It can be either: (i) <code>NULL</code>, in which case it will default to the last known
survival time for each individual, as determined by the <code>last_time</code>
argument; (ii) a scalar, specifying a time to estimate the survival probability
for each of the individuals; or (iii) if <code>newdataEvent</code> is
provided, it can be the name of a variable in <code>newdataEvent</code> that
indicates the time at which the survival probabilities should be calculated
for each individual.</p></dd>


<dt id="arg-standardise">standardise<a class="anchor" aria-label="anchor" href="#arg-standardise"></a></dt>
<dd><p>A logical specifying whether the estimated
subject-specific survival probabilities should be averaged
across all individuals for whom the subject-specific predictions are
being obtained. This can be used to average over the covariate and random effects
distributions of the individuals used in estimating the model, or the individuals
included in the <code>newdata</code> arguments. This approach of
averaging across the observed distribution of the covariates is sometimes
referred to as a "standardised" survival curve. If <code>standardise = TRUE</code>,
then the <code>times</code> argument must be specified and it must be constant across
individuals, that is, the survival probabilities must be calculated at the
same time for all individuals.</p></dd>


<dt id="arg-dynamic">dynamic<a class="anchor" aria-label="anchor" href="#arg-dynamic"></a></dt>
<dd><p>A logical that is only relevant if new data is provided
via the <code>newdataLong</code> and <code>newdataEvent</code> arguments. If
<code>dynamic = TRUE</code>, then new group-specific parameters are drawn for
the individuals in the new data, conditional on their longitudinal
biomarker data contained in <code>newdataLong</code>. These group-specific
parameters are then used to generate individual-specific survival probabilities
for these individuals. These are often referred to as "dynamic predictions"
in the joint modelling context, because the predictions can be updated
each time additional longitudinal biomarker data is collected on the individual.
On the other hand, if <code>dynamic = FALSE</code> then the survival probabilities
will just be marginalised over the distribution of the group-specific
coefficients; this will mean that the predictions will incorporate all
uncertainty due to between-individual variation so there will likely be
very wide credible intervals on the predicted survival probabilities.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>A scalar, specifying how much to multiply the asymptotic
variance-covariance matrix for the random effects by, which is then
used as the "width" (ie. variance-covariance matrix) of the multivariate
Student-t proposal distribution in the Metropolis-Hastings algorithm. This
is only relevant when <code>newdataEvent</code> is supplied and
<code>dynamic = TRUE</code>, in which case new random effects are simulated
for the individuals in the new data using the Metropolis-Hastings algorithm.</p></dd>


<dt id="arg-draws">draws<a class="anchor" aria-label="anchor" href="#arg-draws"></a></dt>
<dd><p>An integer indicating the number of MCMC draws to return.
The default is to set the number of draws equal to 200, or equal to the
size of the posterior sample if that is less than 200.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An optional <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">seed</a></code> to use.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Currently unused.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame of class <code>survfit.stanjm</code>. The data frame includes
  columns for each of the following:
  (i) the median of the posterior predictions of the estimated survival
  probabilities (<code>survpred</code>);
  (ii) each of the lower and upper limits of the corresponding uncertainty
  interval for the estimated survival probabilities (<code>ci_lb</code> and
  <code>ci_ub</code>);
  (iii) a subject identifier (<code>id_var</code>), unless standardised survival
  probabilities were estimated;
  (iv) the time that the estimated survival probability is calculated for
  (<code>time_var</code>).
  The returned object also includes a number of additional attributes.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Note that if any variables were transformed (e.g. rescaled) in the data
  used to fit the model, then these variables must also be transformed in
  <code>newdataLong</code> and <code>newdataEvent</code>. This only applies if variables
  were transformed before passing the data to one of the modeling functions and
  <em>not</em> if transformations were specified inside the model formula.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Rizopoulos, D. (2011). Dynamic predictions and prospective accuracy in
  joint models for longitudinal and time-to-event data. <em>Biometrics</em>
  <strong>67</strong>, 819.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot.survfit.stanjm.html">plot.survfit.stanjm</a></code> for plotting the estimated survival
  probabilities, <code><a href="ps_check.html">ps_check</a></code> for for graphical checks of the estimated
  survival function, and <code><a href="posterior_traj.html">posterior_traj</a></code> for estimating the
  marginal or subject-specific longitudinal trajectories, and
  <code><a href="plot.survfit.stanjm.html">plot_stack_jm</a></code> for combining plots of the estimated subject-specific
  longitudinal trajectory and survival function.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">!=</span> <span class="st">"windows"</span> <span class="op">||</span> <span class="va">.Platform</span><span class="op">$</span><span class="va">r_arch</span> <span class="op">!=</span> <span class="st">"i386"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span>  <span class="co"># Run example model if not already loaded</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"example_jm"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/example.html" class="external-link">example</a></span><span class="op">(</span><span class="va">example_jm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Obtain subject-specific survival probabilities for a few</span></span></span>
<span class="r-in"><span>  <span class="co"># selected individuals in the estimation dataset who were</span></span></span>
<span class="r-in"><span>  <span class="co"># known to survive up until their censoring time. By default</span></span></span>
<span class="r-in"><span>  <span class="co"># the posterior_survfit function will estimate the conditional</span></span></span>
<span class="r-in"><span>  <span class="co"># survival probabilities, that is, conditional on having survived</span></span></span>
<span class="r-in"><span>  <span class="co"># until the event or censoring time, and then by default will</span></span></span>
<span class="r-in"><span>  <span class="co"># extrapolate the survival predictions forward from there.</span></span></span>
<span class="r-in"><span>  <span class="va">ps1</span> <span class="op">&lt;-</span> <span class="fu">posterior_survfit</span><span class="op">(</span><span class="va">example_jm</span>, ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">13</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># We can plot the estimated survival probabilities using the</span></span></span>
<span class="r-in"><span>  <span class="co"># associated plot function</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ps1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># If we wanted to estimate the survival probabilities for the</span></span></span>
<span class="r-in"><span>  <span class="co"># same three individuals as the previous example, but this time</span></span></span>
<span class="r-in"><span>  <span class="co"># we won't condition on them having survived up until their</span></span></span>
<span class="r-in"><span>  <span class="co"># censoring time. Instead, we will estimate their probability</span></span></span>
<span class="r-in"><span>  <span class="co"># of having survived between 0 and 5 years given their covariates</span></span></span>
<span class="r-in"><span>  <span class="co"># and their estimated random effects.</span></span></span>
<span class="r-in"><span>  <span class="co"># The easiest way to achieve the time scale we want (ie, 0 to 5 years)</span></span></span>
<span class="r-in"><span>  <span class="co"># is to specify that we want the survival time estimated at time 0</span></span></span>
<span class="r-in"><span>  <span class="co"># and then extrapolated forward 5 years. We also specify that we</span></span></span>
<span class="r-in"><span>  <span class="co"># do not want to condition on their last known survival time.</span></span></span>
<span class="r-in"><span>  <span class="va">ps2</span> <span class="op">&lt;-</span> <span class="fu">posterior_survfit</span><span class="op">(</span><span class="va">example_jm</span>, ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">13</span>,<span class="fl">15</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>    extrapolate <span class="op">=</span> <span class="cn">TRUE</span>, condition <span class="op">=</span> <span class="cn">FALSE</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>edist <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Instead we may want to estimate subject-specific survival probabilities</span></span></span>
<span class="r-in"><span>  <span class="co"># for a set of new individuals. To demonstrate this, we will simply take</span></span></span>
<span class="r-in"><span>  <span class="co"># the first two individuals in the estimation dataset, but pass their data</span></span></span>
<span class="r-in"><span>  <span class="co"># via the newdata arguments so that posterior_survfit will assume we are</span></span></span>
<span class="r-in"><span>  <span class="co"># predicting survival for new individuals and draw new random effects</span></span></span>
<span class="r-in"><span>  <span class="co"># under a Monte Carlo scheme (see Rizopoulos (2011)).</span></span></span>
<span class="r-in"><span>  <span class="va">ndL</span> <span class="op">&lt;-</span> <span class="va">pbcLong</span><span class="op">[</span><span class="va">pbcLong</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">ndE</span> <span class="op">&lt;-</span> <span class="va">pbcSurv</span><span class="op">[</span><span class="va">pbcSurv</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">ps3</span> <span class="op">&lt;-</span> <span class="fu">posterior_survfit</span><span class="op">(</span><span class="va">example_jm</span>,</span></span>
<span class="r-in"><span>    newdataLong <span class="op">=</span> <span class="va">ndL</span>, newdataEvent <span class="op">=</span> <span class="va">ndE</span>,</span></span>
<span class="r-in"><span>    last_time <span class="op">=</span> <span class="st">"futimeYears"</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ps3</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># We can then compare the estimated random effects for these</span></span></span>
<span class="r-in"><span>  <span class="co"># individuals based on the fitted model and the Monte Carlo scheme</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="stanreg-methods.html">ranef</a></span><span class="op">(</span><span class="va">example_jm</span><span class="op">)</span><span class="op">$</span><span class="va">Long1</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="co"># from fitted model</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ps3</span>, <span class="st">"b_new"</span><span class="op">)</span><span class="op">)</span>                <span class="co"># from Monte Carlo scheme</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Lastly, if we wanted to obtain "standardised" survival probabilities,</span></span></span>
<span class="r-in"><span>  <span class="co"># (by averaging over the observed distribution of the fixed effect</span></span></span>
<span class="r-in"><span>  <span class="co"># covariates, as well as averaging over the estimated random effects</span></span></span>
<span class="r-in"><span>  <span class="co"># for individuals in our estimation sample or new data) then we can</span></span></span>
<span class="r-in"><span>  <span class="co"># specify 'standardise = TRUE'. We can then plot the resulting</span></span></span>
<span class="r-in"><span>  <span class="co"># standardised survival curve.</span></span></span>
<span class="r-in"><span>  <span class="va">ps4</span> <span class="op">&lt;-</span> <span class="fu">posterior_survfit</span><span class="op">(</span><span class="va">example_jm</span>, standardise <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                           times <span class="op">=</span> <span class="fl">0</span>, extrapolate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ps4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Drawing new random effects for 2 individuals. Monitoring progress:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |===================================                                   |  50%  |                                                                              |======================================================================| 100%</span>
<span class="r-plt img"><img src="posterior_survfit-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

