<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Information criteria and cross-validation — loo.stanreg • rstanarm</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script id="MathJax-script" defer src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.js" integrity="sha256-qoRlVrS5NAnXSSSiMfFXwK8C9obG11Iybe4h2+bQYR4=" crossorigin="anonymous">
  </script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Information criteria and cross-validation — loo.stanreg"><meta name="description" content="For models fit using MCMC, compute approximate leave-one-out
  cross-validation (LOO, LOOIC) or, less preferably, the Widely Applicable
  Information Criterion (WAIC) using the loo
  package. (For \(K\)-fold cross-validation see kfold.stanreg.)
  Functions for  model comparison, and model weighting/averaging are also
  provided.
Note: these functions are not guaranteed to work
  properly unless the data argument was specified when the model was
  fit. Also, as of loo version 2.0.0 the default number of cores
  is now only 1, but we recommend using as many (or close to as many) cores
  as possible by setting the cores argument or using
  options(mc.cores = VALUE) to set it for an entire session."><meta property="og:description" content="For models fit using MCMC, compute approximate leave-one-out
  cross-validation (LOO, LOOIC) or, less preferably, the Widely Applicable
  Information Criterion (WAIC) using the loo
  package. (For \(K\)-fold cross-validation see kfold.stanreg.)
  Functions for  model comparison, and model weighting/averaging are also
  provided.
Note: these functions are not guaranteed to work
  properly unless the data argument was specified when the model was
  fit. Also, as of loo version 2.0.0 the default number of cores
  is now only 1, but we recommend using as many (or close to as many) cores
  as possible by setting the cores argument or using
  options(mc.cores = VALUE) to set it for an entire session."><meta property="og:image" content="https://mc-stan.org/rstanarm/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Information criteria and cross-validation</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/New-pkgdown-theme/R/loo.R" class="external-link"><code>R/loo.R</code></a></small>
      <div class="d-none name"><code>loo.stanreg.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>For models fit using MCMC, compute approximate leave-one-out
  cross-validation (LOO, LOOIC) or, less preferably, the Widely Applicable
  Information Criterion (WAIC) using the <span class="pkg"><a href="https://mc-stan.org/loo/reference/loo-package.html" class="external-link">loo</a></span>
  package. (For \(K\)-fold cross-validation see <code><a href="kfold.stanreg.html">kfold.stanreg</a></code>.)
  Functions for  model comparison, and model weighting/averaging are also
  provided.</p>
<p><strong>Note</strong>: these functions are not guaranteed to work
  properly unless the <code>data</code> argument was specified when the model was
  fit. Also, as of <span class="pkg">loo</span> version <code>2.0.0</code> the default number of cores
  is now only 1, but we recommend using as many (or close to as many) cores
  as possible by setting the <code>cores</code> argument or using
  <code>options(mc.cores = VALUE)</code> to set it for an entire session.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'stanreg'</span></span>
<span><span class="fu">loo</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"mc.cores"</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  save_psis <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  k_threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  r_eff <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'stanreg'</span></span>
<span><span class="fu">waic</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'stanreg'</span></span>
<span><span class="fu">loo_compare</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, criterion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loo"</span>, <span class="st">"kfold"</span>, <span class="st">"waic"</span><span class="op">)</span>, detail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'stanreg_list'</span></span>
<span><span class="fu">loo_compare</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, criterion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loo"</span>, <span class="st">"kfold"</span>, <span class="st">"waic"</span><span class="op">)</span>, detail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'stanreg_list'</span></span>
<span><span class="fu">loo_model_weights</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"mc.cores"</span>, <span class="fl">1</span><span class="op">)</span>, k_threshold <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">compare_models</span><span class="op">(</span><span class="va">...</span>, loos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, detail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>For <code>loo</code> and <code>waic</code>, a fitted model object returned by
  one of the rstanarm modeling functions. See <a href="stanreg-objects.html">stanreg-objects</a>.</p>
<p>For the <code>loo_model_weights</code> method, <code>x</code> should be a
  "stanreg_list" object, which is a list of fitted model objects created by
  <code><a href="stanreg_list.html">stanreg_list</a></code>. <code>loo_compare</code> also allows <code>x</code> to be a
  single stanreg object, with the remaining objects passed via <code>...</code>, or
  a single <code>stanreg_list</code> object.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>For <code>loo_compare.stanreg</code>, <code>...</code> can contain objects
  returned by the <code>loo</code>, <code><a href="kfold.stanreg.html">kfold</a></code>, or
  <code>waic</code> method (see the <strong>Examples</strong> section, below).</p>
<p>For <code>loo_model_weights</code>, <code>...</code> should contain arguments (e.g.
  <code>method</code>) to pass to the default <code><a href="https://mc-stan.org/loo/reference/loo_model_weights.html" class="external-link">loo_model_weights</a></code>
  method from the <span class="pkg">loo</span> package.</p></dd>


<dt id="arg-cores-save-psis">cores, save_psis<a class="anchor" aria-label="anchor" href="#arg-cores-save-psis"></a></dt>
<dd><p>Passed to <code><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></code>.</p></dd>


<dt id="arg-k-threshold">k_threshold<a class="anchor" aria-label="anchor" href="#arg-k-threshold"></a></dt>
<dd><p>Threshold for flagging estimates of the Pareto shape
parameters \(k\) estimated by <code>loo</code>. See the <em>How to proceed
when <code>loo</code> gives warnings</em> section, below, for details.</p></dd>


<dt id="arg-r-eff">r_eff<a class="anchor" aria-label="anchor" href="#arg-r-eff"></a></dt>
<dd><p><code>TRUE</code> or <code>FALSE</code> indicating whether to compute the
<code>r_eff</code> argument to pass to the <span class="pkg">loo</span> package. If <code>TRUE</code>,
<span class="pkg">rstanarm</span> will call <code><a href="https://mc-stan.org/loo/reference/relative_eff.html" class="external-link">relative_eff</a></code> to compute the
<code>r_eff</code> argument to pass to the <span class="pkg">loo</span> package. If <code>FALSE</code>
(the default), we avoid computing <code>r_eff</code>, which can be very slow.
<code>r_eff</code> measures the amount of autocorrelation in MCMC draws, and is
used to compute more accurate ESS and MCSE estimates for pointwise and
total ELPDs. When <code>r_eff=FALSE</code>, the reported ESS and MCSE estimates
may be over-optimistic if the posterior draws are far from independent.</p></dd>


<dt id="arg-criterion">criterion<a class="anchor" aria-label="anchor" href="#arg-criterion"></a></dt>
<dd><p>For <code>loo_compare.stanreg</code> and
<code>loo_compare.stanreg_list</code>, should the comparison be based on LOO-CV
(<code>criterion="loo"</code>), K-fold-CV (<code>criterion="kfold"</code>), or WAIC
(<code>criterion="waic"</code>). The default is LOO-CV. See the <strong>Comparing
models</strong> and <strong>Examples</strong> sections below.</p></dd>


<dt id="arg-detail">detail<a class="anchor" aria-label="anchor" href="#arg-detail"></a></dt>
<dd><p>For <code>loo_compare.stanreg</code> and
<code>loo_compare.stanreg_list</code>, if <code>TRUE</code> then extra information
about each model (currently just the model formulas) will be printed with
the output.</p></dd>


<dt id="arg-loos">loos<a class="anchor" aria-label="anchor" href="#arg-loos"></a></dt>
<dd><p>a list of objects produced by the <code>loo</code> function</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The structure of the objects returned by <code>loo</code> and <code>waic</code>
  methods are documented in detail in the <strong>Value</strong> section in
  <code><a href="https://mc-stan.org/loo/reference/loo.html" class="external-link">loo</a></code> and <code><a href="https://mc-stan.org/loo/reference/waic.html" class="external-link">waic</a></code> (from the <span class="pkg">loo</span>
  package).</p>
<p><code>loo_compare</code> returns a matrix with class 'compare.loo'. See the
  <strong>Comparing models</strong> section below for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="approximate-loo-cv">Approximate LOO CV<a class="anchor" aria-label="anchor" href="#approximate-loo-cv"></a></h2>
    <p>The <code>loo</code> method for stanreg objects
  provides an interface to the <span class="pkg"><a href="https://mc-stan.org/loo/reference/loo-package.html" class="external-link">loo</a></span> package for
  approximate leave-one-out cross-validation (LOO). The LOO Information
  Criterion (LOOIC) has the same purpose as the Akaike Information Criterion
  (AIC) that is used by frequentists. Both are intended to estimate the
  expected log predictive density (ELPD) for a new dataset. However, the AIC
  ignores priors and assumes that the posterior distribution is multivariate
  normal, whereas the functions from the <span class="pkg">loo</span> package do not make this
  distributional assumption and integrate over uncertainty in the parameters.
  This only assumes that any one observation can be omitted without having a
  major effect on the posterior distribution, which can be judged using the
  diagnostic plot provided by the
  <code><a href="https://mc-stan.org/loo/reference/pareto-k-diagnostic.html" class="external-link">plot.loo</a></code> method and the warnings
  provided by the <code><a href="https://mc-stan.org/loo/reference/print.loo.html" class="external-link">print.loo</a></code> method (see the <em>How to
  Use the rstanarm Package</em> vignette for an example of this process).</p>
<p></p><div class="section">
<h3 id="how-to-proceed-when-loo-gives-warnings-k-threshold-">How to proceed when <code>loo</code> gives warnings (k_threshold)<a class="anchor" aria-label="anchor" href="#how-to-proceed-when-loo-gives-warnings-k-threshold-"></a></h3>
<p>The <code>k_threshold</code> argument to the <code>loo</code> method for <span class="pkg">rstanarm</span>
  models is provided as a possible remedy when the diagnostics reveal
  problems stemming from the posterior's sensitivity to particular
  observations. Warnings about Pareto \(k\) estimates indicate observations
  for which the approximation to LOO is problematic (this is described in
  detail in Vehtari, Gelman, and Gabry (2017) and the
  <span class="pkg"><a href="https://mc-stan.org/loo/reference/loo-package.html" class="external-link">loo</a></span> package documentation). The
  <code>k_threshold</code> argument can be used to set the \(k\) value above
  which an observation is flagged. If <code>k_threshold</code> is not <code>NULL</code>
  and there are \(J\) observations with \(k\) estimates above
  <code>k_threshold</code> then when <code>loo</code> is called it will refit the
  original model \(J\) times, each time leaving out one of the \(J\)
  problematic observations. The pointwise contributions of these observations
  to the total ELPD are then computed directly and substituted for the
  previous estimates from these \(J\) observations that are stored in the
  object created by <code>loo</code>. Another option to consider is K-fold
  cross-validation, which is documented on a separate page (see
  <code><a href="kfold.stanreg.html">kfold</a></code>).</p>
<p><strong>Note</strong>: in the warning messages issued by <code>loo</code> about large
  Pareto \(k\) estimates we recommend setting <code>k_threshold</code> to at
  least \(0.7\). There is a theoretical reason, explained in Vehtari,
  Gelman, and Gabry (2017), for setting the threshold to the stricter value
  of \(0.5\), but in practice they find that errors in the LOO
  approximation start to increase non-negligibly when \(k &gt; 0.7\).</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="comparing-models">Comparing models<a class="anchor" aria-label="anchor" href="#comparing-models"></a></h2>
    <p>"loo" (or "waic" or "kfold") objects can be passed
  to the <code><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></code> function in the <span class="pkg">loo</span> package to
  perform model comparison. <span class="pkg">rstanarm</span> also provides a
  <code>loo_compare.stanreg</code> method that can be used if the "loo" (or "waic"
  or "kfold") object has been added to the fitted model object (see the
  <strong>Examples</strong> section below for how to do this). This second method
  allows <span class="pkg">rstanarm</span> to perform some extra checks that can't be done by
  the <span class="pkg">loo</span> package itself (e.g., verifying that all models to be
  compared were fit using the same outcome variable).</p>
<p><code>loo_compare</code> will return a matrix with one row per model and columns
  containing the ELPD difference and the standard error of the difference. In
  the first row of the matrix will be the model with the largest ELPD
  (smallest LOOIC) and will contain zeros (there is no difference between
  this model and itself). For each of the remaining models the ELPD
  difference and SE are reported relative to the model with the best ELPD
  (the first row). See the <strong>Details</strong> section at the
  <code><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></code> page in the <span class="pkg">loo</span> package for more
  information.</p>
    </div>
    <div class="section level2">
    <h2 id="model-weights">Model weights<a class="anchor" aria-label="anchor" href="#model-weights"></a></h2>
    <p>The <code>loo_model_weights</code> method can be used to
  compute model weights for a <code>"stanreg_list"</code> object, which is a list
  of fitted model objects made with <code><a href="stanreg_list.html">stanreg_list</a></code>. The end of
  the <strong>Examples</strong> section has a demonstration. For details see the
  <code><a href="https://mc-stan.org/loo/reference/loo_model_weights.html" class="external-link">loo_model_weights</a></code> documentation in the <span class="pkg">loo</span>
  package.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Vehtari, A., Gelman, A., and Gabry, J. (2017). Practical
  Bayesian model evaluation using leave-one-out cross-validation and WAIC.
  <em>Statistics and Computing</em>. 27(5), 1413–1432.
  doi:10.1007/s11222-016-9696-4. arXiv preprint:
  <a href="https://arxiv.org/abs/1507.04544" class="external-link">https://arxiv.org/abs/1507.04544</a></p>
<p>Yao, Y., Vehtari, A., Simpson, D., and Gelman, A. (2018) Using
  stacking to average Bayesian predictive distributions. <em>Bayesian
  Analysis</em>, advance publication,  <a href="https://doi.org/10.1214/17-BA1091" class="external-link">doi:10.1214/17-BA1091</a>
.</p>
<p>Gabry, J. , Simpson, D. , Vehtari, A. , Betancourt, M. and
  Gelman, A. (2019), Visualization in Bayesian workflow. <em>J. R. Stat.
  Soc. A</em>, 182: 389-402. doi:10.1111/rssa.12378,
  <a href="https://arxiv.org/abs/1709.01449" class="external-link">arXiv preprint</a>,
  <a href="https://github.com/jgabry/bayes-vis-paper" class="external-link">code on GitHub</a>)</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p>The <a href="https://mc-stan.org/loo/articles/" class="external-link"><span class="pkg">loo</span> package vignettes</a>
  and various <a href="https://mc-stan.org/rstanarm/articles/"><span class="pkg">rstanarm</span> vignettes</a>
  for more examples using <code>loo</code> and related functions with <span class="pkg">rstanarm</span> models.</p></li>
<li><p><code><a href="https://mc-stan.org/loo/reference/pareto-k-diagnostic.html" class="external-link">pareto-k-diagnostic</a></code> in the <span class="pkg">loo</span> package for
  more on Pareto \(k\) diagnostics.</p></li>
<li><p><code><a href="log_lik.stanreg.html">log_lik.stanreg</a></code> to directly access the pointwise
  log-likelihood matrix.</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">!=</span> <span class="st">"windows"</span> <span class="op">||</span> <span class="va">.Platform</span><span class="op">$</span><span class="va">r_arch</span> <span class="op">!=</span> <span class="st">"i386"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="stan_glm.html">stan_glm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">mtcars</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="stan_glm.html">stan_glm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">cyl</span>, data <span class="op">=</span> <span class="va">mtcars</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (for bigger models use as many cores as possible)</span></span></span>
<span class="r-in"><span><span class="va">loo1</span> <span class="op">&lt;-</span> <span class="fu">loo</span><span class="op">(</span><span class="va">fit1</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">loo1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">loo2</span> <span class="op">&lt;-</span> <span class="fu">loo</span><span class="op">(</span><span class="va">fit2</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">loo2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># when comparing models the loo objects can be passed to loo_compare</span></span></span>
<span class="r-in"><span><span class="co"># as individual arguments or as a list of loo objects</span></span></span>
<span class="r-in"><span><span class="fu">loo_compare</span><span class="op">(</span><span class="va">loo1</span>, <span class="va">loo2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">loo_compare</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">loo1</span>, <span class="va">loo2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># if the fitted model objects contain a loo object in the component "loo"</span></span></span>
<span class="r-in"><span><span class="co"># then the model objects can be passed directly or as a stanreg_list</span></span></span>
<span class="r-in"><span><span class="va">fit1</span><span class="op">$</span><span class="va">loo</span> <span class="op">&lt;-</span> <span class="va">loo1</span></span></span>
<span class="r-in"><span><span class="va">fit2</span><span class="op">$</span><span class="va">loo</span> <span class="op">&lt;-</span> <span class="va">loo2</span></span></span>
<span class="r-in"><span><span class="fu">loo_compare</span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># if the fitted model objects contain a loo object _and_ a waic or kfold</span></span></span>
<span class="r-in"><span><span class="co"># object, then the criterion argument determines which of them the comparison</span></span></span>
<span class="r-in"><span><span class="co"># is based on </span></span></span>
<span class="r-in"><span><span class="va">fit1</span><span class="op">$</span><span class="va">waic</span> <span class="op">&lt;-</span> <span class="fu">waic</span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2</span><span class="op">$</span><span class="va">waic</span> <span class="op">&lt;-</span> <span class="fu">waic</span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">loo_compare</span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span>, criterion <span class="op">=</span> <span class="st">"waic"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the models can also be combined into a stanreg_list object, and more </span></span></span>
<span class="r-in"><span><span class="co"># informative model names can be provided to use when printing</span></span></span>
<span class="r-in"><span><span class="va">model_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="stanreg_list.html">stanreg_list</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span>, model_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fewer predictors"</span>, <span class="st">"More predictors"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">loo_compare</span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="stan_glm.html">stan_glm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">disp</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">loo3</span> <span class="op">&lt;-</span> <span class="fu">loo</span><span class="op">(</span><span class="va">fit3</span>, cores <span class="op">=</span> <span class="fl">2</span>, k_threshold <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">loo_compare</span><span class="op">(</span><span class="va">loo1</span>, <span class="va">loo2</span>, <span class="va">loo3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># setting detail=TRUE will also print model formulas if used with</span></span></span>
<span class="r-in"><span><span class="co"># loo_compare.stanreg or loo_compare.stanreg_list</span></span></span>
<span class="r-in"><span><span class="va">fit3</span><span class="op">$</span><span class="va">loo</span> <span class="op">&lt;-</span> <span class="va">loo3</span></span></span>
<span class="r-in"><span><span class="va">model_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="stanreg_list.html">stanreg_list</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span>, <span class="va">fit3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">loo_compare</span><span class="op">(</span><span class="va">model_list</span>, detail<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Computing model weights</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># if the objects in model_list already have 'loo' components then those</span></span></span>
<span class="r-in"><span><span class="co"># will be used. otherwise loo will be computed for each model internally</span></span></span>
<span class="r-in"><span><span class="co"># (in which case the 'cores' argument may also be used and is passed to loo())</span></span></span>
<span class="r-in"><span><span class="fu">loo_model_weights</span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span>  <span class="co"># defaults to method="stacking"</span></span></span>
<span class="r-in"><span><span class="fu">loo_model_weights</span><span class="op">(</span><span class="va">model_list</span>,  method <span class="op">=</span> <span class="st">"pseudobma"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">loo_model_weights</span><span class="op">(</span><span class="va">model_list</span>,  method <span class="op">=</span> <span class="st">"pseudobma"</span>, BB <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># you can also pass precomputed loo objects directly to loo_model_weights</span></span></span>
<span class="r-in"><span><span class="va">loo_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">loo1</span>, B <span class="op">=</span> <span class="va">loo2</span>, C <span class="op">=</span> <span class="va">loo3</span><span class="op">)</span> <span class="co"># names optional (affects printing)</span></span></span>
<span class="r-in"><span><span class="fu">loo_model_weights</span><span class="op">(</span><span class="va">loo_list</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Computed from 4000 by 32 log-likelihood matrix.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Estimate  SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> elpd_loo    -83.4 4.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p_loo         3.2 1.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> looic       166.9 8.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCSE of elpd_loo is 0.0.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCSE and ESS estimates assume independent draws (r_eff=1).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All Pareto k estimates are good (k &lt; 0.7).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See help('pareto-k-diagnostic') for details.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Computed from 4000 by 32 log-likelihood matrix.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Estimate  SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> elpd_loo    -78.6 4.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p_loo         4.1 1.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> looic       157.1 9.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCSE of elpd_loo is 0.1.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCSE and ESS estimates assume independent draws (r_eff=1).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All Pareto k estimates are good (k &lt; 0.7).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See help('pareto-k-diagnostic') for details.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> 3 (9.4%) p_waic estimates greater than 0.4. We recommend trying loo instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> 3 (9.4%) p_waic estimates greater than 0.4. We recommend trying loo instead.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1 problematic observation(s) found.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Model will be refit 1 times.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fitting model 1 out of 1 (leaving out observation 4)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Method: stacking</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A 0.000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> B 0.487 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C 0.513 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

