<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate the subject-specific or marginal longitudinal trajectory — posterior_traj • rstanarm</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate the subject-specific or marginal longitudinal trajectory — posterior_traj"><meta name="description" content="This function allows us to generate an estimated longitudinal trajectory
(either subject-specific, or by marginalising over the distribution of the
group-specific parameters) based on draws from the posterior predictive
distribution."><meta property="og:description" content="This function allows us to generate an estimated longitudinal trajectory
(either subject-specific, or by marginalising over the distribution of the
group-specific parameters) based on draws from the posterior predictive
distribution."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate the subject-specific or marginal longitudinal trajectory</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/New-pkgdown-theme/R/posterior_traj.R" class="external-link"><code>R/posterior_traj.R</code></a></small>
      <div class="d-none name"><code>posterior_traj.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function allows us to generate an estimated longitudinal trajectory
(either subject-specific, or by marginalising over the distribution of the
group-specific parameters) based on draws from the posterior predictive
distribution.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">posterior_traj</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  m <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  newdataLong <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  newdataEvent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  interpolate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  extrapolate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  last_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prob <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  <span class="va">ids</span>,</span>
<span>  dynamic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  draws <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return_matrix <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A fitted model object returned by the
<code><a href="stan_jm.html">stan_jm</a></code> modelling function. See
<code><a href="stanreg-objects.html">stanreg-objects</a></code>.</p></dd>


<dt id="arg-m">m<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>Integer specifying the number or name of the submodel</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p><strong>Deprecated</strong>: please use <code>newdataLong</code> instead.
Optionally, a data frame in which to look for variables with
which to predict. If omitted, the model matrix is used. If <code>newdata</code>
is provided and any variables were transformed (e.g. rescaled) in the data
used to fit the model, then these variables must also be transformed in
<code>newdata</code>. This only applies if variables were transformed before
passing the data to one of the modeling functions and <em>not</em> if
transformations were specified inside the model formula.</p></dd>


<dt id="arg-newdatalong-newdataevent">newdataLong, newdataEvent<a class="anchor" aria-label="anchor" href="#arg-newdatalong-newdataevent"></a></dt>
<dd><p>Optionally, a data frame (or in the case of
<code>newdataLong</code> this can be a list of data frames) in which to look
for variables with which to predict. If omitted, the model matrices are used.
If new data is provided, then two options are available. Either one can
provide observed covariate and outcome data, collected up to some time
<em>t</em>, and use this data to draw new individual-specific coefficients
(i.e. individual-level random effects). This is the default behaviour when
new data is provided, determined by the argument <code>dynamic = TRUE</code>, and
requiring both <code>newdataLong</code> and <code>newdataEvent</code> to be specified.
Alternatively, one can specify <code>dynamic = FALSE</code>, and then predict
using just covariate data, by marginalising over the distribution
of the group-specific coefficients; in this case, only <code>newdataLong</code>
needs to be specified and it only needs to be a single data frame with
the covariate data for the predictions for the one longitudinal submodel.</p></dd>


<dt id="arg-interpolate">interpolate<a class="anchor" aria-label="anchor" href="#arg-interpolate"></a></dt>
<dd><p>A logical specifying whether to interpolate the estimated
longitudinal trajectory in between the observation times. This can be used
to achieve a smooth estimate of the longitudinal trajectory across the
entire follow up time. If <code>TRUE</code> then the interpolation can be further
controlled using the <code>control</code> argument.</p></dd>


<dt id="arg-extrapolate">extrapolate<a class="anchor" aria-label="anchor" href="#arg-extrapolate"></a></dt>
<dd><p>A logical specifying whether to extrapolate the estimated
longitudinal trajectory beyond the time of the last known observation time.
If <code>TRUE</code> then the extrapolation can be further controlled using
the <code>control</code> argument.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>A named list with parameters controlling the interpolation or
extrapolation of the estimated longitudinal trajectory when either
<code>interpolate = TRUE</code> or <code>extrapolate = TRUE</code>. The
list can contain one or more of the following named elements: <br></p><dl><dt><code>ipoints</code></dt>
<dd><p>a positive integer specifying the number of discrete
  time points at which to calculate the estimated longitudinal response for
  <code>interpolate = TRUE</code>. These time points are evenly spaced starting at
  0 and ending at the last known observation time for each individual. The
  last observation time for each individual is taken to be either: the
  event or censoring time if no new data is provided; the time specified
  in the "last_time" column if provided in the new data (see <strong>Details</strong>
  section below); or the time of the last longitudinal measurement if new
  data is provided but no "last_time" column is included. The default is 15.</p></dd>

  <dt><code>epoints</code></dt>
<dd><p>a positive integer specifying the number of discrete
  time points at which to calculate the estimated longitudinal response for
  <code>extrapolate = TRUE</code>. These time points are evenly spaced between the
  last known observation time for each individual and the extrapolation
  distance specifed using either <code>edist</code> or <code>eprop</code>.
  The default is 15.</p></dd>

  <dt><code>eprop</code></dt>
<dd><p>a positive scalar between 0 and 1 specifying the
  amount of time across which to extrapolate the longitudinal trajectory,
  represented as a proportion of the total observed follow up time for each
  individual. For example specifying <code>eprop = 0.2</code> means that for an
  individual for whom the latest of their measurement, event or censoring times
  was 10 years, their estimated longitudinal trajectory will be extrapolated
  out to 12 years (i.e. 10 + (0.2 * 10)). The default value is 0.2.</p></dd>

  <dt><code>edist</code></dt>
<dd><p>a positive scalar specifying the amount of time
  across which to extrapolate the longitudinal trajectory for each individual,
  represented in units of the time variable <code>time_var</code> (from fitting the
  model). This cannot be specified if <code>eprop</code> is specified.</p></dd>


</dl></dd>


<dt id="arg-last-time">last_time<a class="anchor" aria-label="anchor" href="#arg-last-time"></a></dt>
<dd><p>A scalar, character string, or <code>NULL</code>. This argument
specifies the last known survival time for each individual when
conditional predictions are being obtained. If
<code>newdataEvent</code> is provided and conditional survival predictions are being
obtained, then the <code>last_time</code> argument can be one of the following:
(i) a scalar, this will use the same last time for each individual in
<code>newdataEvent</code>; (ii) a character string, naming a column in
<code>newdataEvent</code> in which to look for the last time for each individual;
(iii) <code>NULL</code>, in which case the default is to use the time of the latest
longitudinal observation in <code>newdataLong</code>. If <code>newdataEvent</code> is
<code>NULL</code> then the <code>last_time</code> argument cannot be specified
directly; instead it will be set equal to the event or censoring time for
each individual in the dataset that was used to estimate the model.
If standardised survival probabilities are requested (i.e.
<code>standardise = TRUE</code>) then conditional survival probabilities are
not allowed and therefore the <code>last_time</code> argument is ignored.</p></dd>


<dt id="arg-prob">prob<a class="anchor" aria-label="anchor" href="#arg-prob"></a></dt>
<dd><p>A scalar between 0 and 1 specifying the width to use for the
uncertainty interval (sometimes called credible interval) for the predicted
mean response and the prediction interval for the predicted (raw) response.
For example <code>prob = 0.95</code> (the default) means that the 2.5th and 97.5th
percentiles will be provided. Only relevant when <code>return_matrix</code> is
<code>FALSE</code>.</p></dd>


<dt id="arg-ids">ids<a class="anchor" aria-label="anchor" href="#arg-ids"></a></dt>
<dd><p>An optional vector specifying a subset of subject IDs for whom the
predictions should be obtained. The default is to predict for all individuals
who were used in estimating the model or, if <code>newdata</code> is specified,
then all individuals contained in <code>newdata</code>.</p></dd>


<dt id="arg-dynamic">dynamic<a class="anchor" aria-label="anchor" href="#arg-dynamic"></a></dt>
<dd><p>A logical that is only relevant if new data is provided
via the <code>newdata</code> argument. If
<code>dynamic = TRUE</code>, then new group-specific parameters are drawn for
the individuals in the new data, conditional on their longitudinal
biomarker data contained in <code>newdata</code>. These group-specific
parameters are then used to generate individual-specific survival probabilities
for these individuals. These are often referred to as "dynamic predictions"
in the joint modelling context, because the predictions can be updated
each time additional longitudinal biomarker data is collected on the individual.
On the other hand, if <code>dynamic = FALSE</code> then the survival probabilities
will just be marginalised over the distribution of the group-specific
coefficients; this will mean that the predictions will incorporate all
uncertainty due to between-individual variation so there will likely be
very wide credible intervals on the predicted survival probabilities.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>A scalar, specifying how much to multiply the asymptotic
variance-covariance matrix for the random effects by, which is then
used as the "width" (ie. variance-covariance matrix) of the multivariate
Student-t proposal distribution in the Metropolis-Hastings algorithm. This
is only relevant when <code>newdataEvent</code> is supplied and
<code>dynamic = TRUE</code>, in which case new random effects are simulated
for the individuals in the new data using the Metropolis-Hastings algorithm.</p></dd>


<dt id="arg-draws">draws<a class="anchor" aria-label="anchor" href="#arg-draws"></a></dt>
<dd><p>An integer indicating the number of MCMC draws to return.
The default is to set the number of draws equal to 200, or equal to the
size of the posterior sample if that is less than 200.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An optional <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">seed</a></code> to use.</p></dd>


<dt id="arg-return-matrix">return_matrix<a class="anchor" aria-label="anchor" href="#arg-return-matrix"></a></dt>
<dd><p>A logical. If <code>TRUE</code> then a <code>draws</code> by
<code>nrow(newdata)</code> matrix is returned which contains all the actual
simulations or draws from the posterior predictive distribution. Otherwise
if <code>return_matrix</code> is set to <code>FALSE</code> (the default) then a
data frame is returned, as described in the <strong>Value</strong> section below.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments passed to <code><a href="posterior_predict.stanreg.html">posterior_predict</a></code>, for
example <code>draws</code>, <code>re.form</code>, <code>seed</code>, etc.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>When <code>return_matrix = FALSE</code>, a data frame
  of class <code>predict.stanjm</code>. The data frame includes a column for the median
  of the posterior predictions of the mean longitudinal response (<code>yfit</code>),
  a column for each of the lower and upper limits of the uncertainty interval
  corresponding to the posterior predictions of the mean longitudinal response
  (<code>ci_lb</code> and <code>ci_ub</code>), and a column for each of the lower and upper
  limits of the prediction interval corresponding to the posterior predictions
  of the (raw) longitudinal response. The data frame also includes columns for
  the subject ID variable, and each of the predictor variables. The returned
  object also includes a number of attributes.</p>
<p>When <code>return_matrix = TRUE</code>, the returned object is the same as that
  described for <code><a href="posterior_predict.stanreg.html">posterior_predict</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>posterior_traj</code> function acts as a wrapper to the
<code><a href="posterior_predict.stanreg.html">posterior_predict</a></code> function, but allows predictions to be
easily generated at time points that are interpolated and/or extrapolated
between time zero (baseline) and the last known survival time for the
individual, thereby providing predictions that correspond to a smooth estimate
of the longitudinal trajectory (useful for the plotting via the associated
<code><a href="plot.predict.stanjm.html">plot.predict.stanjm</a></code> method). In addition it returns a data
frame by default, whereas the <code><a href="posterior_predict.stanreg.html">posterior_predict</a></code> function
returns a matrix; see the <strong>Value</strong> section below for details. Also,
<code>posterior_traj</code> allows predictions to only be generated for a subset
of individuals, via the <code>ids</code> argument.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot.predict.stanjm.html">plot.predict.stanjm</a></code>, <code><a href="posterior_predict.stanreg.html">posterior_predict</a></code>,
  <code><a href="posterior_survfit.html">posterior_survfit</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">!=</span> <span class="st">"windows"</span> <span class="op">||</span> <span class="va">.Platform</span><span class="op">$</span><span class="va">r_arch</span> <span class="op">!=</span> <span class="st">"i386"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span>  <span class="co"># Run example model if not already loaded</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"example_jm"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/example.html" class="external-link">example</a></span><span class="op">(</span><span class="va">example_jm</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Obtain subject-specific predictions for all individuals </span></span></span>
<span class="r-in"><span>  <span class="co"># in the estimation dataset</span></span></span>
<span class="r-in"><span>  <span class="va">pt1</span> <span class="op">&lt;-</span> <span class="fu">posterior_traj</span><span class="op">(</span><span class="va">example_jm</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span>, extrapolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pt1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Obtain subject-specific predictions only for a few selected individuals</span></span></span>
<span class="r-in"><span>  <span class="va">pt2</span> <span class="op">&lt;-</span> <span class="fu">posterior_traj</span><span class="op">(</span><span class="va">example_jm</span>, ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># If we wanted to obtain subject-specific predictions in order to plot the </span></span></span>
<span class="r-in"><span>  <span class="co"># longitudinal trajectories, then we might want to ensure a full trajectory </span></span></span>
<span class="r-in"><span>  <span class="co"># is obtained by interpolating and extrapolating time. We can then use the </span></span></span>
<span class="r-in"><span>  <span class="co"># generic plot function to plot the subject-specific predicted trajectories</span></span></span>
<span class="r-in"><span>  <span class="co"># for the first three individuals. Interpolation and extrapolation is </span></span></span>
<span class="r-in"><span>  <span class="co"># carried out by default.</span></span></span>
<span class="r-in"><span>  <span class="va">pt3</span> <span class="op">&lt;-</span> <span class="fu">posterior_traj</span><span class="op">(</span><span class="va">example_jm</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pt3</span><span class="op">)</span> <span class="co"># predictions at additional time points compared with pt1 </span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pt3</span>, ids <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># If we wanted to extrapolate further in time, but decrease the number of </span></span></span>
<span class="r-in"><span>  <span class="co"># discrete time points at which we obtain predictions for each individual, </span></span></span>
<span class="r-in"><span>  <span class="co"># then we could specify a named list in the 'control' argument</span></span></span>
<span class="r-in"><span>  <span class="va">pt4</span> <span class="op">&lt;-</span> <span class="fu">posterior_traj</span><span class="op">(</span><span class="va">example_jm</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ipoints <span class="op">=</span> <span class="fl">10</span>, epoints <span class="op">=</span> <span class="fl">10</span>, eprop <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># If we have prediction data for a new individual, and we want to</span></span></span>
<span class="r-in"><span>  <span class="co"># estimate the longitudinal trajectory for that individual conditional</span></span></span>
<span class="r-in"><span>  <span class="co"># on this new data (perhaps extrapolating forward from our last</span></span></span>
<span class="r-in"><span>  <span class="co"># longitudinal measurement) then we can do that. It requires drawing</span></span></span>
<span class="r-in"><span>  <span class="co"># new individual-specific parameters, based on the full likelihood,</span></span></span>
<span class="r-in"><span>  <span class="co"># so we must supply new data for both the longitudinal and event </span></span></span>
<span class="r-in"><span>  <span class="co"># submodels. These are sometimes known as dynamic predictions.</span></span></span>
<span class="r-in"><span>  <span class="va">ndL</span> <span class="op">&lt;-</span> <span class="va">pbcLong</span><span class="op">[</span><span class="va">pbcLong</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">8</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">ndE</span> <span class="op">&lt;-</span> <span class="va">pbcSurv</span><span class="op">[</span><span class="va">pbcSurv</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">8</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">ndL</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"new_subject"</span> <span class="co"># new id can't match one used in training data</span></span></span>
<span class="r-in"><span>  <span class="va">ndE</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"new_subject"</span></span></span>
<span class="r-in"><span>  <span class="va">pt5</span> <span class="op">&lt;-</span> <span class="fu">posterior_traj</span><span class="op">(</span><span class="va">example_jm</span>, </span></span>
<span class="r-in"><span>                        newdataLong <span class="op">=</span> <span class="va">ndL</span>,</span></span>
<span class="r-in"><span>                        newdataEvent <span class="op">=</span> <span class="va">ndE</span><span class="op">)</span></span></span>
<span class="r-in"><span>                        </span></span>
<span class="r-in"><span>  <span class="co"># By default it is assumed that the last known survival time for </span></span></span>
<span class="r-in"><span>  <span class="co"># the individual is the time of their last biomarker measurement,</span></span></span>
<span class="r-in"><span>  <span class="co"># but if we know they survived to some later time then we can</span></span></span>
<span class="r-in"><span>  <span class="co"># condition on that information using the last_time argument</span></span></span>
<span class="r-in"><span>  <span class="va">pt6</span> <span class="op">&lt;-</span> <span class="fu">posterior_traj</span><span class="op">(</span><span class="va">example_jm</span>, </span></span>
<span class="r-in"><span>                        newdataLong <span class="op">=</span> <span class="va">ndL</span>,</span></span>
<span class="r-in"><span>                        newdataEvent <span class="op">=</span> <span class="va">ndE</span>, </span></span>
<span class="r-in"><span>                        last_time <span class="op">=</span> <span class="st">"futimeYears"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Alternatively we may want to estimate the marginal longitudinal</span></span></span>
<span class="r-in"><span>  <span class="co"># trajectory for a given set of covariates. To do this, we can pass</span></span></span>
<span class="r-in"><span>  <span class="co"># the desired covariate values in a new data frame (however the only</span></span></span>
<span class="r-in"><span>  <span class="co"># covariate in our fitted model was the time variable, year). To make sure  </span></span></span>
<span class="r-in"><span>  <span class="co"># that we marginalise over the random effects, we need to specify an ID value</span></span></span>
<span class="r-in"><span>  <span class="co"># which does not correspond to any of the individuals who were used in the</span></span></span>
<span class="r-in"><span>  <span class="co"># model estimation and specify the argument dynamic=FALSE.</span></span></span>
<span class="r-in"><span>  <span class="co"># The marginal prediction is obtained by generating subject-specific </span></span></span>
<span class="r-in"><span>  <span class="co"># predictions using a series of random draws from the random </span></span></span>
<span class="r-in"><span>  <span class="co"># effects distribution, and then integrating (ie, averaging) over these. </span></span></span>
<span class="r-in"><span>  <span class="co"># Our marginal prediction will therefore capture the between-individual </span></span></span>
<span class="r-in"><span>  <span class="co"># variation associated with the random effects.</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"new1"</span>, <span class="fl">11</span><span class="op">)</span>, year <span class="op">=</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">pt7</span> <span class="op">&lt;-</span> <span class="fu">posterior_traj</span><span class="op">(</span><span class="va">example_jm</span>, newdataLong <span class="op">=</span> <span class="va">nd</span>, dynamic <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pt7</span><span class="op">)</span>  <span class="co"># note the greater width of the uncertainty interval compared </span></span></span>
<span class="r-in"><span>             <span class="co"># with the subject-specific predictions in pt1, pt2, etc</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Alternatively, we could have estimated the "marginal" trajectory by </span></span></span>
<span class="r-in"><span>  <span class="co"># ignoring the random effects (ie, assuming the random effects were set </span></span></span>
<span class="r-in"><span>  <span class="co"># to zero). This will generate a predicted longitudinal trajectory only</span></span></span>
<span class="r-in"><span>  <span class="co"># based on the fixed effect component of the model. In essence, for a </span></span></span>
<span class="r-in"><span>  <span class="co"># linear mixed effects model (ie, a model that uses an identity link </span></span></span>
<span class="r-in"><span>  <span class="co"># function), we should obtain a similar point estimate ("yfit") to the</span></span></span>
<span class="r-in"><span>  <span class="co"># estimates obtained in pt5 (since the mean of the estimated random effects</span></span></span>
<span class="r-in"><span>  <span class="co"># distribution will be approximately 0). However, it is important to note that</span></span></span>
<span class="r-in"><span>  <span class="co"># the uncertainty interval will be much more narrow, since it completely</span></span></span>
<span class="r-in"><span>  <span class="co"># ignores the between-individual variability captured by the random effects.</span></span></span>
<span class="r-in"><span>  <span class="co"># Further, if the model uses a non-identity link function, then the point</span></span></span>
<span class="r-in"><span>  <span class="co"># estimate ("yfit") obtained only using the fixed effect component of the</span></span></span>
<span class="r-in"><span>  <span class="co"># model will actually provide a biased estimate of the marginal prediction.</span></span></span>
<span class="r-in"><span>  <span class="co"># Nonetheless, to demonstrate how we can obtain the predictions only using </span></span></span>
<span class="r-in"><span>  <span class="co"># the fixed effect component of the model, we simply specify 're.form = NA'. </span></span></span>
<span class="r-in"><span>  <span class="co"># (We will use the same covariate values as used in the prediction for </span></span></span>
<span class="r-in"><span>  <span class="co"># example for pt5).</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="va">pt8</span> <span class="op">&lt;-</span> <span class="fu">posterior_traj</span><span class="op">(</span><span class="va">example_jm</span>, newdataLong <span class="op">=</span> <span class="va">nd</span>, dynamic <span class="op">=</span> <span class="cn">FALSE</span>, </span></span>
<span class="r-in"><span>                        re.form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pt8</span><span class="op">)</span>  <span class="co"># note the much narrower ci, compared with pt5</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `geom_smooth()` using formula = 'y ~ x'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `geom_smooth()` using formula = 'y ~ x'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Drawing new random effects for 1 individuals. Monitoring progress:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Drawing new random effects for 1 individuals. Monitoring progress:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     id      year      yfit      ci_lb     ci_ub      pi_lb    pi_ub</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 new1 0.0000000 0.4916872 -0.4241185 0.8481504 -1.2898612 1.439933</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 new1 0.3571429 0.5504692 -0.3639245 0.9054757 -0.4663548 1.641273</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 new1 0.7142857 0.6128161 -0.3037304 0.9653442 -0.4979441 1.371600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 new1 1.0714286 0.6751630 -0.2435363 1.0255971 -0.5529147 1.420842</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 new1 1.4285714 0.7358875 -0.1833423 1.0858500 -0.3959071 1.359410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 new1 1.7857143 0.7955649 -0.1231482 1.1461029 -0.4307864 1.614048</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

