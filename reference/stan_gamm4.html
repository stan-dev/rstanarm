<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Bayesian generalized linear additive models with optional group-specific terms via Stan — stan_gamm4 • rstanarm</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.js" integrity="sha256-qoRlVrS5NAnXSSSiMfFXwK8C9obG11Iybe4h2+bQYR4=" crossorigin="anonymous">
  </script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian generalized linear additive models with optional group-specific terms via Stan — stan_gamm4"><meta name="description" content="
Bayesian inference for GAMMs with flexible priors."><meta property="og:description" content="
Bayesian inference for GAMMs with flexible priors."><meta property="og:image" content="https://mc-stan.org/rstanarm/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Bayesian generalized linear additive models with optional group-specific terms via Stan</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/master/R/stan_gamm4.R" class="external-link"><code>R/stan_gamm4.R</code></a></small>
      <div class="d-none name"><code>stan_gamm4.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>
Bayesian inference for GAMMs with flexible priors.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stan_gamm4</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  random <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">na.action</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  drop.unused.levels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="priors.html">default_prior_coef</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>  prior_intercept <span class="op">=</span> <span class="fu"><a href="priors.html">default_prior_intercept</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>  prior_smooth <span class="op">=</span> <span class="fu"><a href="priors.html">exponential</a></span><span class="op">(</span>autoscale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  prior_aux <span class="op">=</span> <span class="fu"><a href="priors.html">exponential</a></span><span class="op">(</span>autoscale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  prior_covariance <span class="op">=</span> <span class="fu"><a href="priors.html">decov</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prior_PD <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sampling"</span>, <span class="st">"meanfield"</span>, <span class="st">"fullrank"</span><span class="op">)</span>,</span>
<span>  adapt_delta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  QR <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_nonlinear</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">smooths</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  prob <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">0.75</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula-random-family-data-knots-drop-unused-levels">formula, random, family, data, knots, drop.unused.levels<a class="anchor" aria-label="anchor" href="#arg-formula-random-family-data-knots-drop-unused-levels"></a></dt>
<dd><p>Same as for
<code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4</a></code>. <em>We strongly advise against
omitting the <code>data</code> argument</em>. Unless <code>data</code> is specified (and is
a data frame) many post-estimation functions (including <code>update</code>,
<code>loo</code>, <code>kfold</code>) are not guaranteed to work properly.</p></dd>


<dt id="arg-subset-weights-na-action">subset, weights, na.action<a class="anchor" aria-label="anchor" href="#arg-subset-weights-na-action"></a></dt>
<dd><p>Same as <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code>,
but rarely specified.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to <code>sampling</code> (e.g.
<code>iter</code>, <code>chains</code>, <code>cores</code>, etc.) or to
<code>vb</code> (if <code>algorithm</code> is <code>"meanfield"</code> or
<code>"fullrank"</code>).</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>The prior distribution for the (non-hierarchical) regression
coefficients.</p>
<p>The default priors are described in the vignette
<a href="https://mc-stan.org/rstanarm/articles/priors.html"><em>Prior
Distributions for rstanarm Models</em></a>.
If not using the default, <code>prior</code> should be a call to one of the
various functions provided by <span class="pkg">rstanarm</span> for specifying priors. The
subset of these functions that can be used for the prior on the
coefficients can be grouped into several "families":</p>
<table class="table table"><tr><td><strong>Family</strong></td><td><strong>Functions</strong></td></tr><tr><td><em>Student t family</em></td><td><code>normal</code>, <code>student_t</code>, <code>cauchy</code></td></tr><tr><td><em>Hierarchical shrinkage family</em></td><td><code>hs</code>, <code>hs_plus</code></td></tr><tr><td><em>Laplace family</em></td><td><code>laplace</code>, <code>lasso</code></td></tr><tr><td><em>Product normal family</em></td><td><code>product_normal</code></td></tr></table><p>See the <a href="priors.html">priors help page</a> for details on the families and
how to specify the arguments for all of the functions in the table above.
To omit a prior —i.e., to use a flat (improper) uniform prior—
<code>prior</code> can be set to <code>NULL</code>, although this is rarely a good
idea.</p>
<p><strong>Note:</strong> Unless <code>QR=TRUE</code>, if <code>prior</code> is from the Student t
family or Laplace family, and if the <code>autoscale</code> argument to the
function used to specify the prior (e.g. <code><a href="priors.html">normal</a></code>) is left at
its default and recommended value of <code>TRUE</code>, then the default or
user-specified prior scale(s) may be adjusted internally based on the
scales of the predictors. See the <a href="priors.html">priors help page</a> and the
<em>Prior Distributions</em> vignette for details on the rescaling and the
<code><a href="prior_summary.stanreg.html">prior_summary</a></code> function for a summary of the priors used for a
particular model.</p></dd>


<dt id="arg-prior-intercept">prior_intercept<a class="anchor" aria-label="anchor" href="#arg-prior-intercept"></a></dt>
<dd><p>The prior distribution for the intercept (after
  centering all predictors, see note below).</p>
<p>The default prior is described in the vignette
  <a href="https://mc-stan.org/rstanarm/articles/priors.html"><em>Prior
  Distributions for rstanarm Models</em></a>.
  If not using the default, <code>prior_intercept</code> can be a call to
  <code>normal</code>, <code>student_t</code> or <code>cauchy</code>. See the
  <a href="priors.html">priors help page</a> for details on these functions. To omit a
  prior on the intercept —i.e., to use a flat (improper) uniform prior—
  <code>prior_intercept</code> can be set to <code>NULL</code>.</p>
<p><strong>Note:</strong> If using a dense representation of the design matrix
  —i.e., if the <code>sparse</code> argument is left at its default value of
  <code>FALSE</code>— then the prior distribution for the intercept is set so it
  applies to the value <em>when all predictors are centered</em> (you don't
  need to manually center them). This is explained further in
  [Prior Distributions for rstanarm Models](https://mc-stan.org/rstanarm/articles/priors.html)
  If you prefer to specify a prior on the intercept without the predictors
  being auto-centered, then you have to omit the intercept from the
  <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> and include a column of ones as a predictor,
  in which case some element of <code>prior</code> specifies the prior on it,
  rather than <code>prior_intercept</code>. Regardless of how
  <code>prior_intercept</code> is specified, the reported <em>estimates</em> of the
  intercept always correspond to a parameterization without centered
  predictors (i.e., same as in <code>glm</code>).</p></dd>


<dt id="arg-prior-smooth">prior_smooth<a class="anchor" aria-label="anchor" href="#arg-prior-smooth"></a></dt>
<dd><p>The prior distribution for the hyperparameters in GAMs,
with lower values yielding less flexible smooth functions.</p>
<p><code>prior_smooth</code> can be a call to <code>exponential</code> to
use an exponential distribution, or <code>normal</code>, <code>student_t</code> or
<code>cauchy</code>, which results in a half-normal, half-t, or half-Cauchy
prior. See <code><a href="priors.html">priors</a></code> for details on these functions. To omit a
prior —i.e., to use a flat (improper) uniform prior— set
<code>prior_smooth</code> to <code>NULL</code>. The number of hyperparameters depends
on the model specification but a scalar prior will be recylced as necessary
to the appropriate length.</p></dd>


<dt id="arg-prior-aux">prior_aux<a class="anchor" aria-label="anchor" href="#arg-prior-aux"></a></dt>
<dd><p>The prior distribution for the "auxiliary" parameter (if
applicable). The "auxiliary" parameter refers to a different parameter
depending on the <code>family</code>. For Gaussian models <code>prior_aux</code>
controls <code>"sigma"</code>, the error
standard deviation. For negative binomial models <code>prior_aux</code> controls
<code>"reciprocal_dispersion"</code>, which is similar to the
<code>"size"</code> parameter of <code><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></code>:
smaller values of <code>"reciprocal_dispersion"</code> correspond to
greater dispersion. For gamma models <code>prior_aux</code> sets the prior on
to the <code>"shape"</code> parameter (see e.g.,
<code><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></code>), and for inverse-Gaussian models it is the
so-called <code>"lambda"</code> parameter (which is essentially the reciprocal of
a scale parameter). Binomial and Poisson models do not have auxiliary
parameters.</p>
<p>The default prior is described in the vignette
<a href="https://mc-stan.org/rstanarm/articles/priors.html"><em>Prior
Distributions for rstanarm Models</em></a>.
If not using the default, <code>prior_aux</code> can be a call to
<code>exponential</code> to use an exponential distribution, or <code>normal</code>,
<code>student_t</code> or <code>cauchy</code>, which results in a half-normal, half-t,
or half-Cauchy prior. See <code><a href="priors.html">priors</a></code> for details on these
functions. To omit a prior —i.e., to use a flat (improper) uniform
prior— set <code>prior_aux</code> to <code>NULL</code>.</p></dd>


<dt id="arg-prior-covariance">prior_covariance<a class="anchor" aria-label="anchor" href="#arg-prior-covariance"></a></dt>
<dd><p>Cannot be <code>NULL</code>; see <code><a href="priors.html">decov</a></code> for
more information about the default arguments.</p></dd>


<dt id="arg-prior-pd">prior_PD<a class="anchor" aria-label="anchor" href="#arg-prior-pd"></a></dt>
<dd><p>A logical scalar (defaulting to <code>FALSE</code>) indicating
whether to draw from the prior predictive distribution instead of
conditioning on the outcome.</p></dd>


<dt id="arg-algorithm">algorithm<a class="anchor" aria-label="anchor" href="#arg-algorithm"></a></dt>
<dd><p>A string (possibly abbreviated) indicating the
estimation approach to use. Can be <code>"sampling"</code> for MCMC (the
default), <code>"optimizing"</code> for optimization, <code>"meanfield"</code> for
variational inference with independent normal distributions, or
<code>"fullrank"</code> for variational inference with a multivariate normal
distribution. See <code><a href="rstanarm-package.html">rstanarm-package</a></code> for more details on the
estimation algorithms. NOTE: not all fitting functions support all four
algorithms.</p></dd>


<dt id="arg-adapt-delta">adapt_delta<a class="anchor" aria-label="anchor" href="#arg-adapt-delta"></a></dt>
<dd><p>Only relevant if <code>algorithm="sampling"</code>. See
the <a href="adapt_delta.html">adapt_delta</a> help page for details.</p></dd>


<dt id="arg-qr">QR<a class="anchor" aria-label="anchor" href="#arg-qr"></a></dt>
<dd><p>A logical scalar defaulting to <code>FALSE</code>, but if <code>TRUE</code>
applies a scaled <code><a href="https://rdrr.io/r/base/qr.html" class="external-link">qr</a></code> decomposition to the design matrix. The
transformation does not change the likelihood of the data but is
recommended for computational reasons when there are multiple predictors.
See the <a href="QR-argument.html">QR-argument</a> documentation page for details on how
<span class="pkg">rstanarm</span> does the transformation and important information about how
to interpret the prior distributions of the model parameters when using
<code>QR=TRUE</code>.</p></dd>


<dt id="arg-sparse">sparse<a class="anchor" aria-label="anchor" href="#arg-sparse"></a></dt>
<dd><p>A logical scalar (defaulting to <code>FALSE</code>) indicating
whether to use a sparse representation of the design (X) matrix.
If <code>TRUE</code>, the the design matrix is not centered (since that would
destroy the sparsity) and likewise it is not possible to specify both
<code>QR = TRUE</code> and <code>sparse = TRUE</code>. Depending on how many zeros
there are in the design matrix, setting <code>sparse = TRUE</code> may make
the code run faster and can consume much less RAM.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An object produced by <code>stan_gamm4</code>.</p></dd>


<dt id="arg-smooths">smooths<a class="anchor" aria-label="anchor" href="#arg-smooths"></a></dt>
<dd><p>An optional character vector specifying a subset of the smooth
functions specified in the call to <code>stan_gamm4</code>. The default is
include all smooth terms.</p></dd>


<dt id="arg-prob">prob<a class="anchor" aria-label="anchor" href="#arg-prob"></a></dt>
<dd><p>For univarite smooths, a scalar between 0 and 1 governing the
width of the uncertainty interval.</p></dd>


<dt id="arg-facet-args">facet_args<a class="anchor" aria-label="anchor" href="#arg-facet-args"></a></dt>
<dd><p>An optional named list of arguments passed to
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></code> (other than the <code>facets</code> argument).</p></dd>


<dt id="arg-alpha-size">alpha, size<a class="anchor" aria-label="anchor" href="#arg-alpha-size"></a></dt>
<dd><p>For univariate smooths, passed to
<code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></code>. For bivariate smooths, <code>size/2</code> is
passed to <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="stanreg-objects.html">stanreg</a> object is returned
for <code>stan_gamm4</code>.</p>
<p><code>plot_nonlinear</code> returns a ggplot object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>stan_gamm4</code> function is similar in syntax to
  <code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4</a></code> in the <span class="pkg">gamm4</span> package. But rather than performing
  (restricted) maximum likelihood estimation with the <span class="pkg">lme4</span> package,
  the <code>stan_gamm4</code> function utilizes MCMC to perform Bayesian
  estimation. The Bayesian model adds priors on the common regression
  coefficients (in the same way as <code><a href="stan_glm.html">stan_glm</a></code>), priors on the
  standard deviations of the smooth terms, and a prior on the decomposition
  of the covariance matrices of any group-specific parameters (as in
  <code><a href="stan_glmer.html">stan_glmer</a></code>). Estimating these models via MCMC avoids
  the optimization issues that often crop up with GAMMs and provides better
  estimates for the uncertainty in the parameter estimates.</p>
<p>See <code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4</a></code> for more information about the model
  specicification and <code><a href="priors.html">priors</a></code> for more information about the
  priors on the main coefficients. The <code>formula</code> should include at least
  one smooth term, which can be specified in any way that is supported by the
  <code><a href="https://rdrr.io/pkg/mgcv/man/jagam.html" class="external-link">jagam</a></code> function in the <span class="pkg">mgcv</span> package. The
  <code>prior_smooth</code> argument should be used to specify a prior on the unknown
  standard deviations that govern how smooth the smooth function is. The
  <code>prior_covariance</code> argument can be used to specify the prior on the
  components of the covariance matrix for any (optional) group-specific terms.
  The <code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4</a></code> function in the <span class="pkg">gamm4</span> package uses
  group-specific terms to implement the departure from linearity in the smooth
  terms, but that is not the case for <code>stan_gamm4</code> where the group-specific
  terms are exactly the same as in <code><a href="stan_glmer.html">stan_glmer</a></code>.</p>
<p>The <code>plot_nonlinear</code> function creates a ggplot object with one facet for
  each smooth function specified in the call to <code>stan_gamm4</code> in the case
  where all smooths are univariate. A subset of the smooth functions can be
  specified using the <code>smooths</code> argument, which is necessary to plot a
  bivariate smooth or to exclude the bivariate smooth and plot the univariate
  ones. In the bivariate case, a plot is produced using
  <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour</a></code>. In the univariate case, the resulting
  plot is conceptually similar to <code><a href="https://rdrr.io/pkg/mgcv/man/plot.gam.html" class="external-link">plot.gam</a></code> except the
  outer lines here demark the edges of posterior uncertainty intervals
  (credible intervals) rather than confidence intervals and the inner line
  is the posterior median of the function rather than the function implied
  by a point estimate. To change the colors used in the plot see
  <code><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Crainiceanu, C., Ruppert D., and Wand, M. (2005). Bayesian analysis for
penalized spline regression using WinBUGS. <em>Journal of Statistical
Software</em>. <strong>14</strong>(14), 1–22.
<a href="https://www.jstatsoft.org/article/view/v014i14" class="external-link">https://www.jstatsoft.org/article/view/v014i14</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="stanreg-methods.html">stanreg-methods</a></code> and
<code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4</a></code>.</p>
<p>The vignette for <code>stan_glmer</code>, which also discusses
  <code>stan_gamm4</code>. <a href="https://mc-stan.org/rstanarm/articles/">https://mc-stan.org/rstanarm/articles/</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">!=</span> <span class="st">"windows"</span> <span class="op">||</span> <span class="va">.Platform</span><span class="op">$</span><span class="va">r_arch</span> <span class="op">!=</span> <span class="st">"i386"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># from example(gamm4, package = "gamm4"), prefixing gamm4() call with stan_</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html" class="external-link">gamSim</a></span><span class="op">(</span><span class="fl">1</span>, n <span class="op">=</span> <span class="fl">400</span>, scale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">## simulate 4 term additive truth</span></span></span>
<span class="r-in"><span><span class="co">## Now add 20 level random effect `fac'...</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">fac</span> <span class="op">&lt;-</span> <span class="va">fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">400</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">fac</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="op">*</span> <span class="fl">.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">br</span> <span class="op">&lt;-</span> <span class="fu">stan_gamm4</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">x0</span><span class="op">)</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span>, random <span class="op">=</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">fac</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                 chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># for example speed</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">br</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_nonlinear</span><span class="op">(</span><span class="va">br</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_nonlinear</span><span class="op">(</span><span class="va">br</span>, smooths <span class="op">=</span> <span class="st">"s(x0)"</span>, alpha <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gu &amp; Wahba 4 term additive model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SAMPLING FOR MODEL 'continuous' NOW (CHAIN 1).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Gradient evaluation took 7.9e-05 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.79 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration:   1 / 500 [  0%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration:  50 / 500 [ 10%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 100 / 500 [ 20%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 150 / 500 [ 30%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 200 / 500 [ 40%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 250 / 500 [ 50%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 251 / 500 [ 50%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 300 / 500 [ 60%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 350 / 500 [ 70%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 400 / 500 [ 80%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 450 / 500 [ 90%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 500 / 500 [100%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:  Elapsed Time: 2.475 seconds (Warm-up)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                1.245 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                3.72 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There were 6 divergent transitions after warmup. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The largest R-hat is 1.05, indicating chains have not mixed.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#r-hat</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stan_gamm4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  family:       gaussian [identity]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  formula:      y ~ s(x0) + x1 + s(x2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  observations: 400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Median MAD_SD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   5.2    0.2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1            5.6    0.4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).1      -0.2    1.6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).2      -0.1    2.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).3       0.1    2.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).4       0.2    1.6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).5      -0.1    1.7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).6      -2.6    1.4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).7       0.2    0.8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).8      -1.8    1.6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x0).9       0.0    0.8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).1     -31.8   13.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).2     -21.1    9.9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).3      23.3    8.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).4      18.1    5.2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).5     -29.0    4.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).6      13.1    2.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).7      12.4    2.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).8     -11.0    4.9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x2).9       6.1    9.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Auxiliary parameter(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Median MAD_SD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma 2.1    0.1   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smoothing terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Median MAD_SD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> smooth_sd[s(x0)1]  2.1    0.8  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> smooth_sd[s(x0)2]  1.2    1.2  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> smooth_sd[s(x2)1] 16.7    3.1  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> smooth_sd[s(x2)2]  5.2    4.9  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups   Name        Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  fac      (Intercept) 0.75    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Residual             2.15    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Num. levels: fac 20 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * For help interpreting the printed output see ?print.stanreg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * For info on the priors used see ?prior_summary.stanreg</span>
<span class="r-plt img"><img src="stan_gamm4-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

