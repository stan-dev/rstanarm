<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating Joint Models for Longitudinal and Time-to-Event Data with rstanarm • rstanarm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Joint Models for Longitudinal and Time-to-Event Data with rstanarm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages">
<li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Estimating Joint Models for Longitudinal and Time-to-Event Data with rstanarm</h1>
                        <h4 data-toc-skip class="author">Sam
Brilleman</h4>
            
            <h4 data-toc-skip class="date">2025-12-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/New-pkgdown-theme/vignettes/jm.Rmd" class="external-link"><code>vignettes/jm.Rmd</code></a></small>
      <div class="d-none name"><code>jm.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{stan_jm: Joint Models for Longitudinal and Time-to-Event Data}
-->
<style type="text/css">
h1 { /* Header 1 */
  font-size: 25px;
}
#TOC { /* Table of contents */
  width: 90%;
}
</style>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/theme_default.html" class="external-link">theme_default</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="preamble">Preamble<a class="anchor" aria-label="anchor" href="#preamble"></a>
</h2>
<p>This vignette provides an introduction to the <code>stan_jm</code>
modelling function in the <strong>rstanarm</strong> package. The
<code>stan_jm</code> function allows the user to estimate a shared
parameter joint model for longitudinal and time-to-event data under a
Bayesian framework.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Joint modelling can be broadly defined as the simultaneous estimation
of two or more statistical models which traditionally would have been
separately estimated. When we refer to a shared parameter joint model
for longitudinal and time-to-event data, we generally mean the joint
estimation of: 1) a longitudinal mixed effects model which analyses
patterns of change in an outcome variable that has been measured
repeatedly over time (for example, a clinical biomarker) and 2) a
survival or time-to-event model which analyses the time until an event
of interest occurs (for example, death or disease progression). Joint
estimation of these so-called “submodels” is achieved by assuming they
are correlated via individual-specific parameters (i.e. individual-level
random effects).</p>
<p>Over the last two decades the joint modelling of longitudinal and
time-to-event data has received a significant amount of attention [1-5].
Methodological developments in the area have been motivated by a growing
awareness of the benefits that a joint modelling approach can provide.
In clinical or epidemiological research it is common for a clinical
biomarker to be repeatedly measured over time on a given patient. In
addition, it is common for time-to-event data, such as the
patient-specific time from a defined origin (e.g. time of diagnosis of a
disease) until a terminating clinical event such as death or disease
progression to also be collected. The figure below shows observed
longitudinal measurements (i.e. observed “trajectories”) of log serum
bilirubin for a small sample of patients with primary biliary cirrhosis.
Solid lines are used for those patients who were still alive at the end
of follow up, while dashed lines are used for those patients who died.
From the plots, we can observe between-patient variation in the
longitudinal trajectories for log serum bilirubin, with some patients
showing an increase in the biomarker over time, others decreasing, and
some remaining stable. Moreover, there is variation between patients in
terms of the frequency and timing of the longitudinal
measurements.<br><img src="jm_files/figure-html/traj_figure-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>From the perspective of clinical risk prediction, we may be
interested in asking whether the between-patient variation in the log
serum bilirubin trajectories provides meaningful prognostic information
that can help us differentiate patients with regard to some clinical
event of interest, such as death. Alternatively, from an epidemiological
perspective we may wish to explore the potential for etiological
associations between changes in log serum bilirubin and mortality. Joint
modelling approaches provide us with a framework under which we can
begin to answer these types of clinical and epidemiological
questions.</p>
<p>More formally, the motivations for undertaking a joint modelling
analysis of longitudinal and time-to-event data might include one or
more of the following:</p>
<ul>
<li><p>One may be interested in how <em>underlying changes in the
biomarker influence the occurrence of the event</em>. However, including
the observed biomarker measurements directly into a time-to-event model
as time-varying covariates poses several problems. For example, if the
widely used Cox proportional hazards model is assumed for the
time-to-event model then biomarker measurements need to be available for
all patients at all failure times, which is unlikely to be the case [3].
If simple methods of imputation are used, such as the “last observation
carried forward” method, then these are likely to induce bias [6].
Furthermore, the observed biomarker measurements may be subject to
measurement error and therefore their inclusion as time-varying
covariates may result in biased and inefficient estimates. In most
cases, the measurement error will result in parameter estimates which
are shrunk towards the null [7]. On the other hand, joint modelling
approaches allow us to estimate the association between the biomarker
(or some function of the biomarker trajectory, such as rate of change in
the biomarker) and the risk of the event, whilst allowing for both the
discrete time and measurement-error aspects of the observed
biomarker.</p></li>
<li><p>One may be interested primarily in the evolution of the clinical
biomarker but <em>may wish to account for what is known as informative
dropout</em>. If the value of future (unobserved) biomarker measurements
are related to the occurrence of the terminating event, then those
unobserved biomarker measurements will be “missing not at random” [8,9].
In other words, biomarker measurements for patients who have an event
will differ from those who do not have an event. Under these
circumstances, inference based solely on observed measurements of the
biomarker will be subject to bias. A joint modelling approach can help
to adjust for informative dropout and has been shown to reduce bias in
the estimated parameters associated with longitudinal changes in the
biomarker [1,9,10].</p></li>
<li><p>Joint models are naturally suited to the task of <em>dynamic risk
prediction</em>. For example, joint modelling approaches have been used
to develop prognostic models where predictions of event risk can be
updated as new longitudinal biomarker measurements become available.
Taylor et al. [11] jointly modelled longitudinal measurements of the
prostate specific antigen (PSA) and time to clinical recurrence of
prostate cancer. The joint model was then used to develop a web-based
calculator which could provide real-time predictions of the probability
of recurrence based on a patient’s up to date PSA measurements.</p></li>
</ul>
<p>In this vignette, we describe the <strong>rstanarm</strong> package’s
<code>stan_jm</code> modelling function. This modelling function allows
users to fit a shared parameter joint model for longitudinal and
time-to-event data under a Bayesian framework, with the backend
estimation carried out using Stan. In Section 2 we describe the
formulation of the joint model used by <code>stan_jm</code>. In Section
3 we present a variety of examples showing the usage of
<code>stan_jm</code>.</p>
<p>Note that some aspects of the estimation are covered in other
vignettes, such as the priors <a href="priors.html">vignette</a> which
contains details on the prior distributions available for regression
coefficients.</p>
</div>
<div class="section level2">
<h2 id="technical-details">Technical details<a class="anchor" aria-label="anchor" href="#technical-details"></a>
</h2>
<div class="section level3">
<h3 id="model-formulation">Model formulation<a class="anchor" aria-label="anchor" href="#model-formulation"></a>
</h3>
<p>A shared parameter joint model consists of related submodels which
are specified separately for each of the longitudinal and time-to-event
outcomes. These are therefore commonly referred to as the
<em>longitudinal submodel(s)</em> and the <em>event submodel</em>. The
longitudinal and event submodels are linked using shared
individual-specific parameters, which can be parameterised in a number
of ways. We describe each of these submodels below.</p>
<div class="section level4">
<h4 id="longitudinal-submodels">Longitudinal submodel(s)<a class="anchor" aria-label="anchor" href="#longitudinal-submodels"></a>
</h4>
<p>We assume <span class="math inline">\(y_{ijm}(t) =
y_{im}(t_{ij})\)</span> corresponds to the observed value of the <span class="math inline">\(m^{th}\)</span> <span class="math inline">\((m =
1,...,M)\)</span> biomarker for individual <span class="math inline">\(i\)</span> <span class="math inline">\((i =
1,...,N)\)</span> taken at time point <span class="math inline">\(t_{ij}\)</span>, <span class="math inline">\(j
=  1,...,n_{im}\)</span>. We specify a (multivariate) generalised linear
mixed model that assumes <span class="math inline">\(y_{ijm}(t)\)</span>
follows a distribution in the exponential family with mean <span class="math inline">\(\mu_{ijm}(t)\)</span> and linear predictor</p>
<p><span class="math display">\[
\eta_{ijm}(t) = g_m(\mu_{ijm}(t)) =
  \boldsymbol{x}^T_{ijm}(t) \boldsymbol{\beta}_m +
  \boldsymbol{z}^T_{ijm}(t) \boldsymbol{b}_{im}
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{x}^T_{ijm}(t)\)</span>
and <span class="math inline">\(\boldsymbol{z}^T_{ijm}(t)\)</span> are
both row-vectors of covariates (which likely include some function of
time, for example a linear slope, cubic splines, or polynomial terms)
with associated vectors of fixed and individual-specific parameters
<span class="math inline">\(\boldsymbol{\beta}_m\)</span> and <span class="math inline">\(\boldsymbol{b}_{im}\)</span>, respectively, and
<span class="math inline">\(g_m\)</span> is some known link function.
The distribution and link function are allowed to differ over the <span class="math inline">\(M\)</span> longitudinal submodels. We let the
vector <span class="math inline">\(\boldsymbol{\beta} = \{
\boldsymbol{\beta}_m ; m = 1,...,M\}\)</span> denote the collection of
population-level parameters across the <span class="math inline">\(M\)</span> longitudinal submodels. We assume that
the dependence across the different longitudinal submodels (i.e. the
correlation between the different longitudinal biomarkers) is captured
through a shared multivariate normal distribution for the
individual-specific parameters; that is, we assume</p>
<p><span class="math display">\[
\begin{pmatrix} \boldsymbol{b}_{i1} \\ \vdots \\ \boldsymbol{b}_{iM}
\end{pmatrix} =
  \boldsymbol{b}_i \sim
  \mathsf{Normal} \left( 0 , \boldsymbol{\Sigma} \right)
\]</span></p>
<p>for some unstructured variance-covariance matrix <span class="math inline">\(\boldsymbol{\Sigma}\)</span>.</p>
</div>
<div class="section level4">
<h4 id="event-submodel">Event submodel<a class="anchor" aria-label="anchor" href="#event-submodel"></a>
</h4>
<p>We assume that we also observe an event time <span class="math inline">\(T_i = \mathsf{min} \left( T^*_i , C_i
\right)\)</span> where <span class="math inline">\(T^*_i\)</span>
denotes the so-called “true” event time for individual <span class="math inline">\(i\)</span> (potentially unobserved) and <span class="math inline">\(C_i\)</span> denotes the censoring time. We define
an event indicator <span class="math inline">\(d_i = I(T^*_i \leq
C_i)\)</span>. We then model the hazard of the event using a parametric
proportional hazards regression model of the form</p>
<p><span class="math display">\[
h_i(t) = h_0(t; \boldsymbol{\omega}) \mathsf{exp}
  \left(
    \boldsymbol{w}^T_i(t) \boldsymbol{\gamma} +
    \sum_{m=1}^M \sum_{q=1}^{Q_m}
      f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t)
  \right)
\]</span></p>
<p>where <span class="math inline">\(h_i(t)\)</span> is the hazard of
the event for individual <span class="math inline">\(i\)</span> at time
<span class="math inline">\(t\)</span>, <span class="math inline">\(h_0(t; \boldsymbol{\omega})\)</span> is the
baseline hazard at time <span class="math inline">\(t\)</span> given
parameters <span class="math inline">\(\boldsymbol{\omega}\)</span>,
<span class="math inline">\(\boldsymbol{w}^T_i(t)\)</span> is a
row-vector of individual-specific covariates (possibly time-dependent)
with an associated vector of regression coefficients <span class="math inline">\(\boldsymbol{\gamma}\)</span> (log hazard ratios),
<span class="math inline">\(f_{mq}(.)\)</span> are a set of known
functions for <span class="math inline">\(m=1,...,M\)</span> and <span class="math inline">\(q=1,...,Q_m\)</span>, and the <span class="math inline">\(\alpha_{mq}\)</span> are regression coefficients
(log hazard ratios).</p>
<p>The longitudinal and event submodels are assumed to be related via an
“association structure”, which is a set of functions each <span class="math inline">\(\{ f_{mq} ; m = 1,...,M, q = 1,...,Q_m \}\)</span>
that may each be conditional on the population-level parameters from the
longitudinal submodel <span class="math inline">\(\boldsymbol{\beta}\)</span>, the
individual-specific parameters <span class="math inline">\(\boldsymbol{b}_{i}\)</span>, and the
population-level parameters <span class="math inline">\(\alpha_{mq}\)</span> for <span class="math inline">\(m=1,...,M\)</span> and <span class="math inline">\(q=1,...,Q_m\)</span>. That is, the association
structure of the joint model is captured via the <span class="math inline">\(\sum_{m=1}^M \sum_{q=1}^{Q_m}
f_{mq}(\boldsymbol{\beta}_m, \boldsymbol{b}_{im}, \alpha_{mq};
t)\)</span> term in the linear predictor of the event submodel. The
<span class="math inline">\(\alpha_{mq}\)</span> are referred to as the
“association parameters” since they quantify the strength of the
association between the longitudinal and event processes. The various
ways in which the association structure can be are described in the next
section.</p>
<p>The probability of individual <span class="math inline">\(i\)</span>
still being event-free at time <span class="math inline">\(t\)</span>,
often referred to as the “survival probability”, is defined as</p>
<p><span class="math display">\[
S_i(t) =
  \text{Prob} \Big( T_i^* \geq t \Big) =
  \exp \Big( -H_i(t) \Big)
\]</span></p>
<p>where <span class="math inline">\(H_i(t) = \int_{s=0}^t h_i(s)
ds\)</span> is the cumulative hazard for individual <span class="math inline">\(i\)</span>.</p>
<p>We assume that the baseline hazard <span class="math inline">\(h_0(t;
\boldsymbol{\omega})\)</span> is modelled parametrically. In the
<code>stan_jm</code> modelling function the baseline hazard be specified
as either: an approximation using B-splines on the log hazard scale (the
default); a Weibull distribution; or an approximation using a piecewise
constant function on the log hazard scale (sometimes referred to as
piecewise exponential). The choice of baseline hazard can be made via
the <code>basehaz</code> argument. In the case of the B-splines or
piecewise constant baseline hazard, the user can control the flexibility
by specifying the knots or degrees of freedom via the
<code>basehaz_ops</code> argument. (Note that currently there is
slightly limited post-estimation functionality available for models
estimated with a piecewise constant baseline hazard, so this is perhaps
the least preferable choice).</p>
</div>
<div class="section level4">
<h4 id="association-structures">Association structures<a class="anchor" aria-label="anchor" href="#association-structures"></a>
</h4>
<p>As mentioned in the previous section, the dependence between the
longitudinal and event submodels is captured through the association
structure, which can be specified in a number of ways. The simplest
association structure is likely to be</p>
<p><span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{im}, \alpha_{mq}; t) =
\alpha_{mq} \eta_{im}(t)
\]</span></p>
<p>and this is often referred to as a <em>current value</em> association
structure since it assumes that the log hazard of the event at time
<span class="math inline">\(t\)</span> is linearly associated with the
value of the longitudinal submodel’s linear predictor also evaluated at
time <span class="math inline">\(t\)</span>. This is the most common
association structure used in the joint modelling literature to date. In
the situation where the longitudinal submodel is based on an identity
link function and normal error distribution (i.e. a linear mixed model)
the <em>current value</em> association structure can be viewed as a
method for including the underlying “true” value of the biomarker as a
time-varying covariate in the event submodel.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;By “true” value of the biomarker, we mean the value of
the biomarker which is not subject to measurement error or discrete time
observation. Of course, for the expected value from the longitudinal
submodel to be considered the so-called “true” underlying biomarker
value, we would need to have specified the longitudinal submodel
appropriately!&lt;/p&gt;"><sup>1</sup></a></p>
<p>However, other association structures are also possible. For example,
we could assume the log hazard of the event is linearly associated with
the <em>current slope</em> (i.e. rate of change) of the longitudinal
submodel’s linear predictor, that is</p>
<p><span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \frac{d\eta_{im}(t)}{dt}
\]</span></p>
<p>There are in fact a whole range of possible association structures,
many of which have been discussed in the literature [14-16].</p>
<p>The <code>stan_jm</code> modelling function in the
<strong>rstanarm</strong> package allows for the following association
structures, which are specified via the <code>assoc</code> argument:</p>
<p>Current value (of the linear predictor or expected value) <span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \eta_{im}(t) \\
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \mu_{im}(t)
\]</span></p>
<p>Current slope (of the linear predictor or expected value) <span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \frac{d\eta_{im}(t)}{dt} \\
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \frac{d\mu_{im}(t)}{dt}
\]</span></p>
<p>Area under the curve (of the linear predictor or expected value)
<span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \int_0^t \eta_{im}(u) du \\
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \int_0^t \mu_{im}(u) du
\]</span></p>
<p>Interactions between different biomarkers <span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \eta_{im}(t) \eta_{im'}(t)
  \text{ for some } m = m' \text{ or } m \neq m' \\
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \eta_{im}(t) \mu_{im'}(t)
  \text{ for some } m = m' \text{ or } m \neq m' \\
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \mu_{im}(t) \mu_{im'}(t)
  \text{ for some } m = m' \text{ or } m \neq m'
\]</span></p>
<p>Interactions between the biomarker (or it’s slope) and observed data
<span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} c_{i}(t)  \eta_{im}(t)
  \text{  for some covariate value } c_{i}(t) \\
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} c_{i}(t)  \mu_{im}(t)
  \text{  for some covariate value } c_{i}(t) \\
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} c_{i}(t)  \frac{d\eta_{im}(t)}{dt}
  \text{  for some covariate value } c_{i}(t) \\
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} c_{i}(t)  \frac{d\mu_{im}(t)}{dt}
  \text{  for some covariate value } c_{i}(t)
\]</span></p>
<p>As well as using lagged values for any of the above. That is,
replacing <span class="math inline">\(t\)</span> with <span class="math inline">\(t-u\)</span> where <span class="math inline">\(u\)</span> is some lag time, such that the hazard
of the event at time <span class="math inline">\(t\)</span> is assumed
to be associated with some function of the longitudinal submodel
parameters at time <span class="math inline">\(t-u\)</span>.</p>
<p>Lastly, we can specify some time-independent function of the random
effects, possibly including the fixed effect component. For example,</p>
<p><span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
\alpha_{mq} \boldsymbol{b}_{im0}
\]</span></p>
<p>or</p>
<p><span class="math display">\[
f_{mq}(\boldsymbol{\beta}, \boldsymbol{b}_{i}, \alpha_{mq}; t) =
  \alpha_{mq} \Big( \boldsymbol{\beta}_{m0} + \boldsymbol{b}_{im0} \Big)
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\beta}_{m0}\)</span> is
the population-level intercept for the <span class="math inline">\(m^{th}\)</span> longitudinal submodel and <span class="math inline">\(\boldsymbol{b}_{im0}\)</span> is the <span class="math inline">\(i^{th}\)</span> individual’s random deviation from
the population-level intercept for the <span class="math inline">\(m^{th}\)</span> longitudinal submodel.</p>
<p>Note that more than one association structure can be specified,
however, not all possible combinations are allowed. Moreover, if you are
fitting a multivariate joint model (i.e. more than one longitudinal
outcome) then you can optionally choose to use a different association
structure(s) for linking each longitudinal submodel to the event
submodel. To do this you can pass a list of length <span class="math inline">\(M\)</span> to the <code>assoc</code> argument.</p>
</div>
<div class="section level4">
<h4 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a>
</h4>
<p>Here we define a set of assumptions for the multivariate shared
parameter joint model.</p>
<p>The so-called conditional independence assumption of the shared
parameter joint model postulates</p>
<p><span class="math display">\[
  y_{im}(t) \perp y_{im'}(t) \mid \boldsymbol{b}_i,
\boldsymbol{\theta}  \\
  y_{im}(t) \perp y_{im}(t') \mid \boldsymbol{b}_i,
\boldsymbol{\theta} \\
  y_{im}(t) \perp T_i^*      \mid \boldsymbol{b}_i, \boldsymbol{\theta}
\]</span></p>
<p>for some <span class="math inline">\(m \neq m'\)</span> and <span class="math inline">\(t \neq t'\)</span>, and where <span class="math inline">\(\boldsymbol{\theta}\)</span> denotes the combined
vector of all remaining population-level parameters in the model. That
is, conditional on the individual-specific parameters <span class="math inline">\(\boldsymbol{b}_i\)</span> and population-level
parameters <span class="math inline">\(\boldsymbol{\theta}\)</span>, the
following are assumed: (i) any biomarker measurement for individual
<span class="math inline">\(i\)</span> is independent of that
individual’s true event time <span class="math inline">\(T_i^*\)</span>;
(ii) any two measurements of the <span class="math inline">\(m^{th}\)</span> biomarker taken on the <span class="math inline">\(i^{th}\)</span> individual at two distinct time
points <span class="math inline">\(t\)</span> and <span class="math inline">\(t'\)</span> (i.e. longitudinal or repeated
measurements) are independent of one another; and (iii) any two
measurements of two different biomarkers, taken on the <span class="math inline">\(i^{th}\)</span> individual at some time point
<span class="math inline">\(t\)</span> are independent of one another.
These conditional independence assumptions allow for a convenient
factorisation of the full likelihood for joint model into the
likelihoods for each of the component parts (i.e. the likelihood for the
longitudinal submodel, the likelihood for the event submodel, and the
likelihood for the distribution of the individual-specific parameters),
which facilitates the estimation of the model.</p>
<p>Moreover, we require two additional assumptions: (i) that the
censoring process for the event outcome is independent of the true event
time, that is <span class="math inline">\(C_i \perp T_i^* \mid
\boldsymbol{\theta}\)</span> (i.e. uninformative censoring); and (ii)
that the visiting process by which the observation times <span class="math inline">\(t_{ijm}\)</span> are determined is independent of
the true event time <span class="math inline">\(T_i^*\)</span> and all
missing future unobserved longitudinal biomarker measurements.</p>
</div>
<div class="section level4">
<h4 id="log-posterior-distribution">Log posterior distribution<a class="anchor" aria-label="anchor" href="#log-posterior-distribution"></a>
</h4>
<p>Under the conditional independence assumption, the log posterior for
the <span class="math inline">\(i^{th}\)</span> individual can be
specified as</p>
<p><span class="math display">\[
\log p(\boldsymbol{\theta}, \boldsymbol{b}_{i} \mid \boldsymbol{y}_{i},
T_i, d_i)
  \propto
    \log \Bigg[
      \Bigg(
        \prod_{m=1}^M
          \prod_{j=1}^{n_i}
            p(y_{ijm}(t) \mid \boldsymbol{b}_{i}, \boldsymbol{\theta})
      \Bigg)
      p(T_i, d_i \mid \boldsymbol{b}_{i}, \boldsymbol{\theta})
      p(\boldsymbol{b}_{i} \mid \boldsymbol{\theta})
      p(\boldsymbol{\theta})
    \Bigg]    
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{y}_i = \{ y_{ijm}(t); j
= 1,...,n_i, m = 1,...,M \}\)</span> denotes the collection of
longitudinal biomarker data for individual <span class="math inline">\(i\)</span> and <span class="math inline">\(\boldsymbol{\theta}\)</span> denotes all remaining
population-level parameters in the model.</p>
<p>We can rewrite this log posterior as</p>
<p><span class="math display">\[
\log p(\boldsymbol{\theta}, \boldsymbol{b}_{i} \mid \boldsymbol{y}_{i},
T_i, d_i)
  \propto
    \Bigg(
      \sum_{m=1}^M
        \sum_{j=1}^{n_i}
          \log p(y_{ijm}(t) \mid \boldsymbol{b}_{i},
\boldsymbol{\theta})
    \Bigg) +
    \log p(T_i, d_i \mid \boldsymbol{b}_{i}, \boldsymbol{\theta}) +
    \log p(\boldsymbol{b}_{i} \mid \boldsymbol{\theta}) +
    \log p(\boldsymbol{\theta})
\]</span></p>
<p>where <span class="math inline">\(\sum_{j=1}^{n_{im}} \log p(y_{ijm}
\mid \boldsymbol{b}_{i}, \boldsymbol{\theta})\)</span> is the log
likelihood for the <span class="math inline">\(m^{th}\)</span>
longitudinal submodel, <span class="math inline">\(\log p(T_i, d_i \mid
\boldsymbol{b}_{i}, \boldsymbol{\theta})\)</span> is the log likelihood
for the event submodel, <span class="math inline">\(\log
p(\boldsymbol{b}_{i} \mid \boldsymbol{\theta})\)</span> is the log
likelihood for the distribution of the group-specific parameters
(i.e. random effects), and <span class="math inline">\(\log
p(\boldsymbol{\theta})\)</span> represents the log likelihood for the
joint prior distribution across all remaining unknown parameters.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;We refer the reader to the priors &lt;a href="priors.html"&gt;vignette&lt;/a&gt; for a discussion of the possible prior
distributions.&lt;/p&gt;'><sup>2</sup></a></p>
<p>We can rewrite the log likelihood for the event submodel as</p>
<p><span class="math display">\[
\log p(T_i, d_i \mid \boldsymbol{b}_{i}, \boldsymbol{\theta}) =
  d_i * \log h_i(T_i) - \int_0^{T_i} h_i(s) ds
\]</span></p>
<p>and then use Gauss-Kronrod quadrature with <span class="math inline">\(Q\)</span> nodes to approximate <span class="math inline">\(\int_0^{T_i} h_i(s) ds\)</span>, such that</p>
<p><span class="math display">\[
\int_0^{T_i} h_i(s) ds \approx \frac{T_i}{2} \sum_{q=1}^{Q} w_q h_i
\bigg( \frac{T_i(1+s_q)}{2} \bigg)
\]</span></p>
<p>where <span class="math inline">\(w_q\)</span> and <span class="math inline">\(s_q\)</span>, respectively, are the standardised
weights and locations (“abscissa”) for quadrature node <span class="math inline">\(q\)</span> <span class="math inline">\((q=1,...,Q)\)</span> [17]. The default for the
<code>stan_jm</code> modelling function is to use <span class="math inline">\(Q=15\)</span> quadrature nodes, however if the
user wishes, they can choose between <span class="math inline">\(Q=15\)</span>, <span class="math inline">\(11\)</span>, or <span class="math inline">\(7\)</span> quadrature nodes (specified via the
<code>qnodes</code> argument).</p>
<p>Therefore, once we have an individual’s event time <span class="math inline">\(T_i\)</span> we can evaluate the design matrices
for the event submodel and longitudinal submodels at the <span class="math inline">\(Q+1\)</span> necessary time points (which are the
event time <span class="math inline">\(T_i\)</span> and the quadrature
points <span class="math inline">\(\frac{T_i(1+s_q)}{2}\)</span> for
<span class="math inline">\(q=1,...,Q\)</span>) and then pass these to
Stan’s data block. We can then evaluate the log likelihood for the event
submodel by simply calculating the hazard <span class="math inline">\(h_i(t)\)</span> at those <span class="math inline">\(Q+1\)</span> time points and summing the
quantities appropriately. This calculation will need to be performed
each time we iterate through Stan’s model block. A simplified example of
the underlying Stan code used to fit the joint model can be found in <a href="https://github.com/stan-dev/stancon_talks/blob/master/2018/Contributed-Talks/03_brilleman/notebook.pdf" class="external-link">Brilleman
et al. (2018)</a> [12].</p>
</div>
</div>
<div class="section level3">
<h3 id="model-predictions">Model predictions<a class="anchor" aria-label="anchor" href="#model-predictions"></a>
</h3>
<p>Before discussing the methods by which we can generate posterior
predictions, first let us define some additional relevant quantities.
Let <span class="math inline">\(\mathcal{D} = \{ \boldsymbol{y}_i, T_i,
d_i; i = 1,...,N \}\)</span> be the entire collection of outcome data in
the sample. We will refer to this sample as the “training data”. Let
<span class="math inline">\(T_{max} = \max \{ T_i; i = 1,...,N
\}\)</span> denote the maximum event or censoring time across the <span class="math inline">\(i = 1,...,N\)</span> individuals in our training
data.</p>
<div class="section level4">
<h4 id="individual-specific-predictions-for-in-sample-individuals-for-0-leq-t-leq-t_i">Individual-specific predictions for in-sample individuals (for <span class="math inline">\(0 \leq t \leq T_i\)</span>)<a class="anchor" aria-label="anchor" href="#individual-specific-predictions-for-in-sample-individuals-for-0-leq-t-leq-t_i"></a>
</h4>
<p>We can generate posterior predictions for the longitudinal and
time-to-event outcomes in the following manner. For the <span class="math inline">\(i^{th}\)</span> individual in our training data, a
predicted value for the <span class="math inline">\(m^{th}\)</span>
longitudinal biomarker at time <span class="math inline">\(t\)</span>,
denoted <span class="math inline">\(y^*_{im}(t)\)</span>, can be
generated from the posterior predictive distribution</p>
<p><span class="math display">\[
p \Big( y^{*}_{im}(t) \mid \mathcal{D} \Big) =
  \int
    \int
      p \Big( y^{*}_{im}(t) \mid \boldsymbol{\theta}, \boldsymbol{b}_i
\Big)
      p \Big( \boldsymbol{\theta}, \boldsymbol{b}_i \mid \mathcal{D}
\Big)
    \space d \boldsymbol{b}_i
  \space d \boldsymbol{\theta}
\]</span></p>
<p>and, similarly, a predicted probability of the <span class="math inline">\(i^{th}\)</span> individual being event-free at
time <span class="math inline">\(t\)</span>, denoted <span class="math inline">\(S^*_i(t)\)</span>, can be generated from the
posterior predictive distribution</p>
<p><span class="math display">\[
p \Big( S^{*}_{i}(t) \mid \mathcal{D} \Big) =
  \int
    \int
      p \Big( S^{*}_i(t) \mid \boldsymbol{\theta}, \boldsymbol{b}_i
\Big)
      p \Big( \boldsymbol{\theta}, \boldsymbol{b}_i \mid \mathcal{D}
\Big)
    d \boldsymbol{b}_i \space d \boldsymbol{\theta}      
\]</span></p>
<p>Note that for simplicity we have ignored the implicit conditioning on
covariates; <span class="math inline">\(\boldsymbol{x}_{im}(t)\)</span>
and <span class="math inline">\(\boldsymbol{z}_{im}(t)\)</span>, for
<span class="math inline">\(m = 1,...,M\)</span>, and <span class="math inline">\(\boldsymbol{w}_{i}(t)\)</span>. Since individual
<span class="math inline">\(i\)</span> is included in the training data,
it is easy for us to approximate these posterior predictive
distributions by drawing from <span class="math inline">\(p(y^{*}_{im}(t) \mid \boldsymbol{\theta}^{(l)},
\boldsymbol{b}_i^{(l)})\)</span> and <span class="math inline">\(p(S^{*}_i(t) \mid \boldsymbol{\theta}^{(l)},
\boldsymbol{b}_i^{(l)})\)</span> where <span class="math inline">\(\boldsymbol{\theta}^{(l)}\)</span> and <span class="math inline">\(\boldsymbol{b}_i^{(l)}\)</span> are the <span class="math inline">\(l^{th}\)</span> <span class="math inline">\((l =
1,...,L)\)</span> MCMC draws from the joint posterior distribution <span class="math inline">\(p(\boldsymbol{\theta}, \boldsymbol{b}_i \mid
\mathcal{D})\)</span>.</p>
<p>These draws from the posterior predictive distributions can be used
for assessing the fit of the model. For example,</p>
<ul>
<li><p>the draws from <span class="math inline">\(p(y^{*}_{im}(t) \mid
\mathcal{D})\)</span> for <span class="math inline">\(0 \leq t \leq
T_i\)</span> can be used to evaluate the fit of the longitudinal
trajectory for the <span class="math inline">\(m^{th}\)</span> biomarker
for the <span class="math inline">\(i^{th}\)</span> individual,
and</p></li>
<li><p>the draws from <span class="math inline">\(p(S^{*}_{i}(t) \mid
\mathcal{D})\)</span> for <span class="math inline">\(0 \leq t \leq
T_{max}\)</span> can be averaged across the <span class="math inline">\(N\)</span> individuals to obtain a standardised
survival curve (discussed in greater detail in later sections) which can
then be compared to the observed survival curve, for example, the
Kaplan-Meier curve.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="individual-specific-predictions-for-in-sample-individuals-for-t-c_i">Individual-specific predictions for in-sample individuals (for <span class="math inline">\(t &gt; C_i\)</span>)<a class="anchor" aria-label="anchor" href="#individual-specific-predictions-for-in-sample-individuals-for-t-c_i"></a>
</h4>
<p>However, given that we know the event or censoring time for each
individual in our training data, it may make more sense to consider what
will happen to censored individuals in our study when we look beyond
their last known survival time (i.e. extrapolation).</p>
<p>For an individual <span class="math inline">\(i\)</span>, who was in
our training data, and who was known to be event-free up until their
censoring time <span class="math inline">\(C_i\)</span>, we wish to draw
from the conditional posterior predictive distribution for their
longitudinal outcome at some time <span class="math inline">\(t &gt;
C_i\)</span>, that is</p>
<p><span class="math display">\[
p \Big( y^{*}_{im}(t) \mid \mathcal{D}, t &gt; C_i \Big) =
  \int
    \int
      p \Big( y^{*}_{im}(t) \mid \boldsymbol{\theta}, \boldsymbol{b}_i,
t &gt; C_i \Big)
      p \Big( \boldsymbol{\theta}, \boldsymbol{b}_i \mid \mathcal{D}
\Big)
    d \boldsymbol{b}_i \space d \boldsymbol{\theta}
\]</span></p>
<p>and the conditional posterior predictive distribution for their
survival probability at some time <span class="math inline">\(t &gt;
C_i\)</span>, that is</p>
<p><span class="math display">\[
\begin{aligned}
p \Big( S^{*}_{i}(t) \mid \mathcal{D}, t &gt; C_i, T_i^* &gt; C_i \Big)
&amp; =
  \frac
    {p \Big( S^{*}_{i}(t)   \mid \mathcal{D} \Big)}
    {p \Big( S^{*}_{i}(C_i) \mid \mathcal{D} \Big)} \\
&amp; =
  \int
    \int
      \frac
        {p \Big( S^{*}_i(t)   \mid \boldsymbol{\theta}, \boldsymbol{b}_i
\Big)}
        {p \Big( S^{*}_i(C_i) \mid \boldsymbol{\theta}, \boldsymbol{b}_i
\Big)}
      \space p \Big( \boldsymbol{\theta}, \boldsymbol{b}_i \mid
\mathcal{D} \Big)
    d \boldsymbol{b}_i \space d \boldsymbol{\theta}
\end{aligned}
\]</span></p>
<p>These draws from the conditional posterior predictive distributions
can be used to extrapolate into the future for individual <span class="math inline">\(i\)</span>, conditional on their longitudinal
biomarker data collected between baseline and their censoring time <span class="math inline">\(C_i\)</span>. For example,</p>
<ul>
<li><p>the draws from <span class="math inline">\(p(y^{*}_{im}(t) \mid
\mathcal{D}, t &gt; C_i)\)</span> for <span class="math inline">\(C_i
\leq t \leq T_{max}\)</span> can be used to show the forecasted
longitudinal trajectory for the <span class="math inline">\(m^{th}\)</span> biomarker for the <span class="math inline">\(i^{th}\)</span> individual, and</p></li>
<li><p>the draws from <span class="math inline">\(p(S^{*}_{i}(t) \mid
\mathcal{D}, t &gt; C_i, T_i^* &gt; C_i))\)</span> for <span class="math inline">\(C_i \leq t \leq T_{max}\)</span> can be used to
show the estimated conditional probability of individual <span class="math inline">\(i\)</span> remaining event-free into the
future.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="individual-specific-predictions-for-out-of-sample-individuals-i-e--dynamic-predictions">Individual-specific predictions for out-of-sample individuals
(i.e. dynamic predictions)<a class="anchor" aria-label="anchor" href="#individual-specific-predictions-for-out-of-sample-individuals-i-e--dynamic-predictions"></a>
</h4>
<p><strong>TBC.</strong> Describe dynamic predictions under the
framework of Rizopoulos (2011) [18]. These types of individual-specific
predictions can be obtained using the <code>posterior_traj</code> and
<code>posterior_survfit</code> functions by providing prediction data
and specifying <code>dynamic = TRUE</code> (which is the default); see
the examples provided below.</p>
</div>
<div class="section level4">
<h4 id="population-level-i-e--marginal-predictions">Population-level (i.e. marginal) predictions<a class="anchor" aria-label="anchor" href="#population-level-i-e--marginal-predictions"></a>
</h4>
<p>We can also generate posterior predictions for the longitudinal and
time-to-event outcomes that do not require any conditioning on observed
outcome data for a specific individual. Here, we will discuss two ways
in which this can be done.</p>
<p>The first way is to “marginalise” over the distribution of the
individual-specific parameters. We wish to generate a predicted value
for the <span class="math inline">\(m^{th}\)</span> longitudinal
biomarker at time <span class="math inline">\(t\)</span> for a new
individual <span class="math inline">\(k\)</span> for whom we do not
have any observed data. We will denote this prediction <span class="math inline">\(y^*_{km}(t)\)</span> and note that it can be
generated from the posterior predictive distribution for the
longitudinal outcome</p>
<p><span class="math display">\[
\begin{aligned}
p \Big( y^{*}_{km}(t) \mid \mathcal{D} \Big)
&amp; =
  \int
    \int
      p \Big( y^{*}_{km}(t) \mid \boldsymbol{\theta},
\boldsymbol{\tilde{b}}_k \Big)
      p \Big( \boldsymbol{\theta}, \boldsymbol{\tilde{b}}_k \mid
\mathcal{D} \Big)
    \space d \boldsymbol{\tilde{b}}_{k}
  \space d \boldsymbol{\theta} \\
&amp; =
  \int
    \int
      p \Big( y^{*}_{km}(t) \mid \boldsymbol{\theta},
\boldsymbol{\tilde{b}}_k \Big)
      p \Big( \boldsymbol{\tilde{b}}_k \mid \boldsymbol{\theta} \Big)
      p \Big( \boldsymbol{\theta} \mid \mathcal{D} \Big)
    \space d \boldsymbol{\tilde{b}}_{k}
  \space d \boldsymbol{\theta}
\end{aligned}
\]</span></p>
<p>and similarly for the survival probability</p>
<p><span class="math display">\[
\begin{aligned}
p \Big( S^{*}_{k}(t) \mid \mathcal{D} \Big)
&amp; =
  \int
    \int
      p \Big( S^{*}_k(t) \mid \boldsymbol{\theta},
\boldsymbol{\tilde{b}}_k \Big)
      p \Big( \boldsymbol{\theta}, \boldsymbol{\tilde{b}}_k \mid
\mathcal{D} \Big)
    d \boldsymbol{b}_k \space d \boldsymbol{\theta} \\
&amp; = \int
    \int
      p \Big( S^{*}_k(t) \mid \boldsymbol{\theta},
\boldsymbol{\tilde{b}}_k \Big)
      p \Big( \boldsymbol{\tilde{b}}_k \mid \boldsymbol{\theta} \Big)
      p \Big( \boldsymbol{\theta} \mid \mathcal{D} \Big)
    d \boldsymbol{b}_k \space d \boldsymbol{\theta} \\
\end{aligned}
\]</span></p>
<p>We can obtain draws for <span class="math inline">\(\boldsymbol{\tilde{b}}_k\)</span> in the same
manner as for the individual-specific parameters <span class="math inline">\(\boldsymbol{b}_i\)</span>. That is, at the <span class="math inline">\(l^{th}\)</span> iteration of the MCMC sampler we
draw <span class="math inline">\(\boldsymbol{\tilde{b}}_k^{(l)}\)</span>
and store it<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;These random draws from the posterior distribution of
the group-specific parameters are stored each time a joint model is
estimated using &lt;code&gt;stan_glmer&lt;/code&gt;, &lt;code&gt;stan_mvmer&lt;/code&gt;, or
&lt;code&gt;stan_jm&lt;/code&gt;; they are saved under an ID value called
&lt;code&gt;"_NEW_"&lt;/code&gt;&lt;/p&gt;'><sup>3</sup></a>. However, individual <span class="math inline">\(k\)</span> did not provide any contribution to the
training data and so we are effectively taking random draws from the
posterior distribution for the individual-specific parameters. We are
therefore effectively marginalising over the distribution of the
group-specific coefficients when we obtain predictions using the draws
<span class="math inline">\(\boldsymbol{\tilde{b}}_k^{(l)}\)</span> fro
<span class="math inline">\(l = 1,\dots,L\)</span>. In other words, we
are predicting for a new individual whom we have no information except
that they are drawn from the same population as the <span class="math inline">\(i = 1,...,N\)</span> individuals in the training
data. Because these predictions will incorporate all the uncertainty
associated with between-individual variation our 95% credible intervals
are likely to be very wide. These types of marginal predictions can be
obtained using the <code>posterior_traj</code> and
<code>posterior_survfit</code> functions by providing prediction data
and specifying <code>dynamic = FALSE</code>; see the examples provided
below.</p>
<p>The second way is to effectively ignore the group-level structure in
the model. That is, to only predict with only the population-level
parameters contributing to the model. For example, under a identity link
function and normal error distribution (i.e. linear mixed effect
longitudinal submodel), we would obtain draws from the distribution
<span class="math inline">\(y^{(l)}_{km}(t) \sim N \Big(
\boldsymbol{x}^T_{km}(t) \boldsymbol{\beta}_m^{(l)}, \sigma_m^{(l)}
\Big)\)</span> where <span class="math inline">\(\boldsymbol{\beta}_m^{(l)}\)</span> and <span class="math inline">\(\sigma_m^{(l)}\)</span> are the population-level
parameters and residual error standard deviation, respectively, for the
<span class="math inline">\(l^{th}\)</span> draw of the MCMC samples.
However, referring to this as a “marginal” prediction is somewhat
misleading since we are not explicitly conditioning on the
individual-specific parameters but we are implicitly assuming that we
know they are equal to zero with absolute certainty. That is, we are
actually drawing from the posterior predictive distribution for the
longitudinal outcome</p>
<p><span class="math display">\[
\begin{aligned}
p \Big( y^{*}_{km}(t) \mid \mathcal{D} \Big)
&amp; =
  \int
      p \Big( y^{*}_{km}(t) \mid \boldsymbol{\theta}, \boldsymbol{b}_k =
0 \Big)
      p \Big( \boldsymbol{\theta} \mid \mathcal{D} \Big)
  d \boldsymbol{\theta} \\
\end{aligned}
\]</span> and similarly for the survival probability</p>
<p><span class="math display">\[
p \Big( S^{*}_{k}(t) \mid \mathcal{D} \Big) =
  \int
    p \Big( S^{*}_k(t) \mid \boldsymbol{\theta}, \boldsymbol{b}_k = 0
\Big)
    p \Big( \boldsymbol{\theta} \mid \mathcal{D} \Big)
  d \boldsymbol{\theta} \\
\]</span></p>
<p>These types of so-called “marginal” predictions can not currently be
obtained using the <code>posterior_traj</code> and
<code>posterior_survfit</code> functions.</p>
</div>
<div class="section level4">
<h4 id="standardised-survival-probabilities">Standardised survival probabilities<a class="anchor" aria-label="anchor" href="#standardised-survival-probabilities"></a>
</h4>
<p>All of the previously discussed population-level (i.e. marginal)
predictions assumed implicit conditioning on some covariate values for
the longitudinal submodel, <span class="math inline">\(\boldsymbol{x}_{im}(t)\)</span> and <span class="math inline">\(\boldsymbol{z}_{im}(t)\)</span> for <span class="math inline">\(m = 1,...,M\)</span>, and for the event submodel,
<span class="math inline">\(\boldsymbol{w}_{i}(t)\)</span>. Even though
we marginalise over the distribution of the individual-specific
parameters we were still assuming that we obtained predictions for some
known values of the covariates. However, sometimes we wish to
marginalise (i.e. average) over the observed distribution of covariates
as well. Here we discuss a method by which we can do that for the
predicted survival probabilities.</p>
<p>At any time <span class="math inline">\(t\)</span>, it is possible to
obtain a standardised survival probability by averaging the
individual-specific survival probabilities. That is, we can obtain</p>
<p><span class="math display">\[
S^*(t) = \frac{\sum_{i=1}^{N^{pred}} S_i^*(t)}{N^{pred}}
\]</span></p>
<p>where <span class="math inline">\(S_i^*(t)\)</span> is the predicted
survival probability for individual <span class="math inline">\(i\)</span> (<span class="math inline">\(i =
1,\dots,N^{pred}\)</span> at time <span class="math inline">\(t\)</span>, and <span class="math inline">\(N^{pred}\)</span> is the number of individuals
included in the prediction dataset. We refer to these predictions as
<em>standardised survival probabilities</em>.</p>
<p>Note however, that if <span class="math inline">\(N_{pred}\)</span>
is not sufficiently large (e.g. we pass new data with just 2
individuals, say) then marginalising over their covariate distribution
may not be meaningful and, similarly, their joint random effects
distribution may be a poor representation of the random effects
distribution for the entire population. It is better to calculate these
standardised survival probabilities using where, say, <span class="math inline">\(N^{pred}\)</span> is equal to the total number of
individuals in the training data.</p>
</div>
</div>
<div class="section level3">
<h3 id="model-extensions">Model extensions<a class="anchor" aria-label="anchor" href="#model-extensions"></a>
</h3>
<div class="section level4">
<h4 id="delayed-entry-left-truncation">Delayed entry (left-truncation)<a class="anchor" aria-label="anchor" href="#delayed-entry-left-truncation"></a>
</h4>
<p><strong>TBC.</strong></p>
</div>
<div class="section level4">
<h4 id="multilevel-clustering">Multilevel clustering<a class="anchor" aria-label="anchor" href="#multilevel-clustering"></a>
</h4>
<p><strong>TBC.</strong></p>
</div>
</div>
<div class="section level3">
<h3 id="model-comparison">Model comparison<a class="anchor" aria-label="anchor" href="#model-comparison"></a>
</h3>
<div class="section level4">
<h4 id="loowaic-in-the-context-of-joint-models">LOO/WAIC in the context of joint models<a class="anchor" aria-label="anchor" href="#loowaic-in-the-context-of-joint-models"></a>
</h4>
<p><strong>TBC.</strong></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="usage-examples">Usage examples<a class="anchor" aria-label="anchor" href="#usage-examples"></a>
</h2>
<div class="section level3">
<h3 id="dataset-used-in-the-examples">Dataset used in the examples<a class="anchor" aria-label="anchor" href="#dataset-used-in-the-examples"></a>
</h3>
<p>We use the Mayo Clinic’s primary biliary cirrhosis (PBC) dataset in
the examples below. The dataset contains 312 individuals with primary
biliary cirrhosis who participated in a randomised placebo controlled
trial of D-penicillamine conducted at the Mayo Clinic between 1974 and
1984 [19]. However, to ensure the examples run quickly, we use a small
random subset of just 40 patients from the full data.</p>
<p>These example data are contained in two separate data frames. The
first data frame contains multiple-row per patient longitudinal
biomarker information, as shown in</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pbcLong</span><span class="op">)</span></span></code></pre></div>
<pre><code>  id      age sex trt      year     logBili albumin platelet
1  1 58.76523   f   1 0.0000000  2.67414865    2.60      190
2  1 58.76523   f   1 0.5256674  3.05870707    2.94      183
3  2 56.44627   f   1 0.0000000  0.09531018    4.14      221
4  2 56.44627   f   1 0.4982888 -0.22314355    3.60      188
5  2 56.44627   f   1 0.9993155  0.00000000    3.55      161
6  2 56.44627   f   1 2.1026694  0.64185389    3.92      122</code></pre>
<p>while the second data frame contains single-row per patient survival
information, as shown in</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pbcSurv</span><span class="op">)</span></span></code></pre></div>
<pre><code>   id      age sex trt futimeYears status death
1   1 58.76523   f   1    1.095140      2     1
3   2 56.44627   f   1   14.151951      0     0
12  3 70.07255   m   1    2.770705      2     1
16  4 54.74059   f   1    5.270363      2     1
23  5 38.10541   f   0    4.120465      1     0
29  6 66.25873   f   0    6.852841      2     1</code></pre>
<p>The variables included across the two datasets can be defined as
follows:</p>
<ul>
<li>
<code>age</code> in years</li>
<li>
<code>albumin</code> serum albumin (g/dl)</li>
<li>
<code>logBili</code> logarithm of serum bilirubin</li>
<li>
<code>death</code> indicator of death at endpoint</li>
<li>
<code>futimeYears</code> time (in years) between baseline and the
earliest of death, transplantion or censoring</li>
<li>
<code>id</code> numeric ID unique to each individual</li>
<li>
<code>platelet</code> platelet count</li>
<li>
<code>sex</code> gender (m = male, f = female)</li>
<li>
<code>status</code> status at endpoint (0 = censored, 1 =
transplant, 2 = dead)</li>
<li>
<code>trt</code> binary treatment code (0 = placebo, 1 =
D-penicillamine)</li>
<li>
<code>year</code> time (in years) of the longitudinal measurements,
taken as time since baseline)</li>
</ul>
<p>A description of the example datasets can be found by accessing the
following help documentation:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="st">"datasets"</span>, package <span class="op">=</span> <span class="st">"rstanarm"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-models">Fitting the models<a class="anchor" aria-label="anchor" href="#fitting-the-models"></a>
</h3>
<div class="section level4">
<h4 id="univariate-joint-model-current-value-association-structure">Univariate joint model (current value association structure)<a class="anchor" aria-label="anchor" href="#univariate-joint-model-current-value-association-structure"></a>
</h4>
<p>In this example we fit a simple univariate joint model, with one
normally distributed longitudinal marker, an association structure based
on the current value of the linear predictor, and B-splines baseline
hazard. To fit the model we use the joint (longitudinal and
time-to-event) modelling function in the <strong>rstanarm</strong>
package: <code>stan_jm</code>. When calling <code>stan_jm</code> we
must, at a minimum, specify a formula object for each of the
longitudinal and event submodels (through the arguments
<code>formulaLong</code> and <code>formulaEvent</code>), the data frames
which contain the variables for each of the the longitudinal and event
submodels (through the arguments <code>dataLong</code> and
<code>dataEvent</code>), and the name of the variable representing time
in the longitudinal submodel (through the argument
<code>time_var</code>).</p>
<p>The formula for the longitudinal submodel is specified using the
<strong>lme4</strong> package formula style. That is
<code>y ~ x + (random_effects | grouping_factor)</code>. In this example
we specify that log serum bilirubin (<code>logBili</code>) follows a
subject-specific linear trajectory. To do this we include a fixed
intercept and fixed slope (<code>year</code>), as well as a random
intercept and random slope for each subject <code>id</code>
(<code>(year | id)</code>).</p>
<p>The formula for the event submodel is specified using the
<strong>survival</strong> package formula style. That is, the outcome of
the left of the <code>~</code> needs to be of the format
<code>Surv(event_time, event_indicator)</code> for single row per
individual data, or
<code>Surv(start_time, stop_time, event_indicator)</code> for multiple
row per individual data. The latter allows for exogenous time-varying
covariates to be included in the event submodel. In this example we
assume that the log hazard of death is linearly related to gender
(<code>sex</code>) and an indicator of treatment with D-penicillamine
(<code>trt</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_jm.html">stan_jm</a></span><span class="op">(</span>formulaLong <span class="op">=</span> <span class="va">logBili</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="va">year</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>, </span>
<span>                dataLong <span class="op">=</span> <span class="va">pbcLong</span>,</span>
<span>                formulaEvent <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futimeYears</span>, <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">trt</span>, </span>
<span>                dataEvent <span class="op">=</span> <span class="va">pbcSurv</span>,</span>
<span>                time_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>                chains <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">2000</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<pre><code>Fitting a univariate joint model.

Please note the warmup may be much slower than later iterations!

SAMPLING FOR MODEL 'jm' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.00021 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 2.1 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 19.333 seconds (Warm-up)
Chain 1:                20.015 seconds (Sampling)
Chain 1:                39.348 seconds (Total)
Chain 1: </code></pre>
<p>The argument <code>refresh = 2000</code> was specified so that Stan
didn’t provide us with excessive progress updates whilst fitting the
model. However, if you are fitting a model that will take several
minutes or hours to fit, then you may wish to request progress updates
quite regularly, for example setting <code>refresh = 20</code> for every
20 iterations (by default the refresh argument is set to 1/10th of the
total number of iterations).</p>
<p>The fitted model is returned as an object of the S3 class
<code>stanjm</code>. We have a variety of methods and post-estimation
functions available for this class, including: <code>print</code>,
<code>summary</code>, <code>plot</code>, <code>fixef</code>,
<code>ranef</code>, <code>coef</code>, <code>VarCorr</code>,
<code>posterior_interval</code>, <code>update</code>, and more. Here, we
will examine the most basic output for the fitted joint model by typing
<code>print(mod1)</code>:</p>
<pre><code>stan_jm
 formula (Long1): logBili ~ sex + trt + year + (year | id)
 family  (Long1): gaussian [identity]
 formula (Event): survival::Surv(futimeYears, death) ~ sex + trt
 baseline hazard: bs
 assoc:           etavalue (Long1)
------

Longitudinal submodel: logBili
            Median MAD_SD
(Intercept)  0.304  0.558
sexf         0.477  0.523
trt         -0.127  0.370
year         0.212  0.043
sigma        0.354  0.016

Event submodel:
                Median MAD_SD exp(Median)
(Intercept)     -3.179  0.621  0.042     
sexf            -0.336  0.620  0.715     
trt             -0.720  0.415  0.487     
Long1|etavalue   1.341  0.238  3.821     
b-splines-coef1 -0.836  1.035     NA     
b-splines-coef2  0.518  0.881     NA     
b-splines-coef3 -1.797  1.196     NA     
b-splines-coef4  0.299  1.652     NA     
b-splines-coef5 -0.061  1.665     NA     
b-splines-coef6 -0.820  1.665     NA     

Group-level error terms:
 Groups Name              Std.Dev. Corr
 id     Long1|(Intercept) 1.2954       
        Long1|year        0.1921   0.52
Num. levels: id 40 

Sample avg. posterior predictive distribution 
of longitudinal outcomes:
               Median MAD_SD
Long1|mean_PPD 0.585  0.032 

------
For info on the priors used see help('prior_summary.stanreg').</code></pre>
<p>The “Long1|etavalue” row under “Event submodel” is our <span class="math inline">\(\alpha_{mq}\)</span> parameter (<span class="math inline">\(m = 1\)</span>, <span class="math inline">\(q =
1\)</span>). The estimated median of tells us that for each one unit
increase in an individual’s underlying level of log serum bilirubin,
their estimated log hazard of death increases by some amount. The mean
absolute deviation (MAD) is provided as a more robust estimate of the
standard deviation of the posterior distribution. In this case the
MAD_SD for the association parameter indicates there is quite large
uncertainty around the estimated association between log serum bilirubin
and risk of death (recall this is a small dataset).</p>
<p>If we wanted some slightly more detailed output for each of the model
parameters, as well as further details regarding the model estimation
(for example computation time, number of longitudinal observations,
number of individuals, type of baseline hazard, etc) we can instead use
the <code>summary</code> method:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.025</span>,<span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>
Model Info:

 function:        stan_jm
 formula (Long1): logBili ~ sex + trt + year + (year | id)
 family  (Long1): gaussian [identity]
 formula (Event): survival::Surv(futimeYears, death) ~ sex + trt
 baseline hazard: bs
 assoc:           etavalue (Long1)
 algorithm:       sampling
 priors:          see help('prior_summary')
 sample:          1000 (posterior sample size)
 num obs:         304 (Long1)
 num subjects:    40
 num events:      29 (72.5%)
 groups:          id (40)
 runtime:         0.6 mins

Estimates:
                                                mean     sd       2.5%  
Long1|(Intercept)                                0.294    0.586   -0.926
Long1|sexf                                       0.499    0.560   -0.529
Long1|trt                                       -0.144    0.386   -0.973
Long1|year                                       0.214    0.042    0.136
Long1|sigma                                      0.354    0.017    0.324
Long1|mean_PPD                                   0.586    0.030    0.527
Event|(Intercept)                               -3.191    0.622   -4.477
Event|sexf                                      -0.299    0.620   -1.407
Event|trt                                       -0.740    0.445   -1.663
Event|b-splines-coef1                           -0.949    1.065   -3.263
Event|b-splines-coef2                            0.462    0.908   -1.410
Event|b-splines-coef3                           -1.807    1.186   -4.100
Event|b-splines-coef4                            0.388    1.567   -2.682
Event|b-splines-coef5                           -0.077    1.647   -3.410
Event|b-splines-coef6                           -1.014    1.692   -4.884
Assoc|Long1|etavalue                             1.347    0.237    0.915
Sigma[id:Long1|(Intercept),Long1|(Intercept)]    1.678    0.438    1.012
Sigma[id:Long1|year,Long1|(Intercept)]           0.129    0.076    0.018
Sigma[id:Long1|year,Long1|year]                  0.037    0.020    0.014
log-posterior                                 -329.512    9.997 -349.426
                                                97.5% 
Long1|(Intercept)                                1.367
Long1|sexf                                       1.627
Long1|trt                                        0.582
Long1|year                                       0.299
Long1|sigma                                      0.387
Long1|mean_PPD                                   0.647
Event|(Intercept)                               -2.068
Event|sexf                                       1.036
Event|trt                                        0.128
Event|b-splines-coef1                            0.882
Event|b-splines-coef2                            2.114
Event|b-splines-coef3                            0.370
Event|b-splines-coef4                            3.494
Event|b-splines-coef5                            2.989
Event|b-splines-coef6                            1.810
Assoc|Long1|etavalue                             1.829
Sigma[id:Long1|(Intercept),Long1|(Intercept)]    2.703
Sigma[id:Long1|year,Long1|(Intercept)]           0.300
Sigma[id:Long1|year,Long1|year]                  0.085
log-posterior                                 -311.470

Diagnostics:
                                              mcse  Rhat  n_eff
Long1|(Intercept)                             0.029 0.999  411 
Long1|sexf                                    0.028 0.999  407 
Long1|trt                                     0.023 1.001  281 
Long1|year                                    0.002 0.999  288 
Long1|sigma                                   0.001 1.002  953 
Long1|mean_PPD                                0.001 1.001 1165 
Event|(Intercept)                             0.019 1.001 1131 
Event|sexf                                    0.018 1.002 1156 
Event|trt                                     0.013 0.999 1149 
Event|b-splines-coef1                         0.040 0.999  703 
Event|b-splines-coef2                         0.029 1.000 1008 
Event|b-splines-coef3                         0.046 0.999  660 
Event|b-splines-coef4                         0.065 0.999  589 
Event|b-splines-coef5                         0.064 0.999  654 
Event|b-splines-coef6                         0.061 0.999  767 
Assoc|Long1|etavalue                          0.007 0.999 1074 
Sigma[id:Long1|(Intercept),Long1|(Intercept)] 0.025 0.999  306 
Sigma[id:Long1|year,Long1|(Intercept)]        0.006 1.001  182 
Sigma[id:Long1|year,Long1|year]               0.001 1.003  214 
log-posterior                                 0.708 1.002  199 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
<p>The easiest way to extract the correlation matrix for the random
effects (aside from viewing the <code>print</code> output) is to use the
<code>VarCorr</code> function (modelled on the <code>VarCorr</code>
function from the <strong>lme4</strong> package). If you wish to extract
the variances and covariances (instead of the standard deviations and
correlations) then you can type the following to return a data frame
with all of the relevant information:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/stanreg-methods.html">VarCorr</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>  grp              var1       var2       vcov     sdcor
1  id Long1|(Intercept)       &lt;NA&gt; 1.67802152 1.2953847
2  id        Long1|year       &lt;NA&gt; 0.03691896 0.1921431
3  id Long1|(Intercept) Long1|year 0.12937327 0.5197818</code></pre>
</div>
<div class="section level4">
<h4 id="univariate-joint-model-current-value-and-current-slope-association-structure">Univariate joint model (current value and current slope association
structure)<a class="anchor" aria-label="anchor" href="#univariate-joint-model-current-value-and-current-slope-association-structure"></a>
</h4>
<p>In the previous example we were fitting a shared parameter joint
model which assumed that the log hazard of the event (in this case the
log hazard of death) at time <em>t</em> was linearly related to the
subject-specific expected value of the longitudinal marker (in this case
the expected value of log serum bilirubin) also at time <em>t</em>. This
is the default association structure, although it could be explicitly
specified by setting the <code>assoc = "etavalue"</code> argument.</p>
<p>However, let’s suppose we believe that the log hazard of death is
actually related to both the <em>current value</em> of log serum
bilirubin and the current <em>rate of change</em> in log serum
bilirubin. To estimate this joint model we need to indicate that we want
to also include the subject-specific slope (at time <em>t</em>) from the
longitudinal submodel as part of the association structure. We do this
by setting the <code>assoc</code> argument equal to a character vector
<code>c("etavalue", "etaslope")</code> which indicates our desired
association structure:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_jm.html">stan_jm</a></span><span class="op">(</span>formulaLong <span class="op">=</span> <span class="va">logBili</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="va">year</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>, </span>
<span>                dataLong <span class="op">=</span> <span class="va">pbcLong</span>,</span>
<span>                formulaEvent <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futimeYears</span>, <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">trt</span>, </span>
<span>                dataEvent <span class="op">=</span> <span class="va">pbcSurv</span>,</span>
<span>                assoc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"etavalue"</span>, <span class="st">"etaslope"</span><span class="op">)</span>,</span>
<span>                time_var <span class="op">=</span> <span class="st">"year"</span>, </span>
<span>                chains <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">2000</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<p>In this example the subject-specific slope is actually constant
across time <em>t</em> since we have a linear trajectory. Note however
that we could still use the <code>"etaslope"</code> association
structure even if we had a non-linear subject specific trajectory (for
example modelled using cubic splines or polynomials).</p>
</div>
<div class="section level4">
<h4 id="multivariate-joint-model-current-value-association-structures">Multivariate joint model (current value association structures)<a class="anchor" aria-label="anchor" href="#multivariate-joint-model-current-value-association-structures"></a>
</h4>
<p>Suppose instead that we were interested in <em>two</em> repeatedly
measured clinical biomarkers, log serum bilirubin and serum albumin, and
their association with the risk of death. We may wish to model these two
biomarkers, allowing for the correlation between them, and estimating
their respective associations with the log hazard of death. We will fit
a linear mixed effects submodel (identity link, normal distribution) for
each biomarker with a patient-specific intercept and linear slope but no
other covariates. In the event submodel we will include gender
(<code>sex</code>) and treatment (<code>trt</code>) as baseline
covariates. Each biomarker is assumed to be associated with the log
hazard of death at time <span class="math inline">\(t\)</span> via it’s
expected value at time <span class="math inline">\(t\)</span> (i.e. a
<em>current value</em> association structure).</p>
<p>The model we are going to fit can therefore be specified as:</p>
<p><span class="math display">\[
y_{im}(t_{ijm}) \sim N(\mu_{im}(t_{ijm}), \sigma_m)
\]</span></p>
<p><span class="math display">\[
\eta_{im}(t) = \mu_{im}(t) = \beta_{0m} + \beta_{1m} t + b_{0mi} +
b_{1mi} t
\]</span></p>
<p><span class="math display">\[
h_i(t) = h_0(t; \boldsymbol{\omega}) \exp(\gamma_1 w_{1i} + \gamma_2
w_{2i} + \alpha_{1i} \mu_{i1}(t) + \alpha_{2i} \mu_{i2}(t))
\]</span></p>
<p>where <span class="math inline">\(t\)</span> is time in years, and
<span class="math inline">\(w_{1i}\)</span> and <span class="math inline">\(w_{2i}\)</span> are, respectively, the gender and
treatment indicators for individual <span class="math inline">\(i\)</span>.</p>
<p>(Note that due to the very small sample size, the clinical findings
from this analysis should not to be overinterpreted!).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_jm.html">stan_jm</a></span><span class="op">(</span></span>
<span>    formulaLong <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">logBili</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="va">year</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>, </span>
<span>        <span class="va">albumin</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="va">year</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    formulaEvent <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futimeYears</span>, <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">trt</span>, </span>
<span>    dataLong <span class="op">=</span> <span class="va">pbcLong</span>, dataEvent <span class="op">=</span> <span class="va">pbcSurv</span>,</span>
<span>    time_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>    chains <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">2000</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<pre><code>Fitting a multivariate joint model.

Please note the warmup may be much slower than later iterations!

SAMPLING FOR MODEL 'jm' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.000345 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 3.45 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 35.219 seconds (Warm-up)
Chain 1:                36.126 seconds (Sampling)
Chain 1:                71.345 seconds (Total)
Chain 1: </code></pre>
<p>We can now examine the output from the fitted model, for
example<br></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span></code></pre></div>
<pre><code>stan_jm
 formula (Long1): logBili ~ sex + trt + year + (year | id)
 family  (Long1): gaussian [identity]
 formula (Long2): albumin ~ sex + trt + year + (year | id)
 family  (Long2): gaussian [identity]
 formula (Event): survival::Surv(futimeYears, death) ~ sex + trt
 baseline hazard: bs
 assoc:           etavalue (Long1), etavalue (Long2)
------

Longitudinal submodel 1: logBili
            Median MAD_SD
(Intercept)  0.263  0.508
sexf         0.475  0.487
trt         -0.063  0.374
year         0.222  0.043
sigma        0.354  0.017

Longitudinal submodel 2: albumin
            Median MAD_SD
(Intercept)  3.471  0.224
sexf         0.066  0.240
trt          0.000  0.168
year        -0.156  0.023
sigma        0.291  0.013

Event submodel:
                Median  MAD_SD  exp(Median)
(Intercept)       6.854   2.660 947.312    
sexf             -0.101   0.652   0.904    
trt              -0.501   0.500   0.606    
Long1|etavalue    0.805   0.312   2.236    
Long2|etavalue   -3.075   0.834   0.046    
b-splines-coef1  -0.973   1.138      NA    
b-splines-coef2   0.546   0.849      NA    
b-splines-coef3  -2.571   1.352      NA    
b-splines-coef4  -0.645   1.807      NA    
b-splines-coef5  -1.276   1.887      NA    
b-splines-coef6  -2.704   1.864      NA    

Group-level error terms:
 Groups Name              Std.Dev. Corr             
 id     Long1|(Intercept) 1.24123                   
        Long1|year        0.18822   0.49            
        Long2|(Intercept) 0.51395  -0.65 -0.49      
        Long2|year        0.09606  -0.57 -0.81  0.45
Num. levels: id 40 

Sample avg. posterior predictive distribution 
of longitudinal outcomes:
               Median MAD_SD
Long1|mean_PPD 0.588  0.030 
Long2|mean_PPD 3.343  0.025 

------
For info on the priors used see help('prior_summary.stanreg').</code></pre>
<p>or we can examine the summary output for the association parameters
alone:<br></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod3</span>, pars <span class="op">=</span> <span class="st">"assoc"</span><span class="op">)</span></span></code></pre></div>
<pre><code>
Model Info:

 function:        stan_jm
 formula (Long1): logBili ~ sex + trt + year + (year | id)
 family  (Long1): gaussian [identity]
 formula (Long2): albumin ~ sex + trt + year + (year | id)
 family  (Long2): gaussian [identity]
 formula (Event): survival::Surv(futimeYears, death) ~ sex + trt
 baseline hazard: bs
 assoc:           etavalue (Long1), etavalue (Long2)
 algorithm:       sampling
 priors:          see help('prior_summary')
 sample:          1000 (posterior sample size)
 num obs:         304 (Long1), 304 (Long2)
 num subjects:    40
 num events:      29 (72.5%)
 groups:          id (40)
 runtime:         1.2 mins

Estimates:
                       mean   sd     2.5%   25%    50%    75%    97.5%
Assoc|Long1|etavalue  0.806  0.301  0.236  0.593  0.805  1.014  1.397 
Assoc|Long2|etavalue -3.142  0.872 -4.946 -3.657 -3.075 -2.532 -1.603 

Diagnostics:
                     mcse  Rhat  n_eff
Assoc|Long1|etavalue 0.009 0.999 1189 
Assoc|Long2|etavalue 0.032 1.000  763 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="posterior-predictions">Posterior predictions<a class="anchor" aria-label="anchor" href="#posterior-predictions"></a>
</h3>
<p>We can also access the range of post-estimation functions (described
in the <code>stan_jm</code> and related help documentation; see for
example <code><a href="../reference/posterior_traj.html">help(posterior_traj)</a></code> or
<code><a href="../reference/posterior_survfit.html">help(posterior_survfit)</a></code>).</p>
<div class="section level4">
<h4 id="predicted-individual-specific-longitudinal-trajectory-for-in-sample-individuals">Predicted individual-specific longitudinal trajectory for in-sample
individuals<a class="anchor" aria-label="anchor" href="#predicted-individual-specific-longitudinal-trajectory-for-in-sample-individuals"></a>
</h4>
<p>Predicted individual-specific biomarker values can be obtained using
either the <code>posterior_traj</code> or <code>posterior_predict</code>
function. The <code>posterior_traj</code> is preferable, because it can
be used to obtain the biomarker values at a series of evenly spaced time
points between baseline and the individual’s event or censoring time by
using the default <code>interpolate = TRUE</code> option. Whereas, the
<code>posterior_predict</code> function only provides the predicted
biomarker values at the observed time points, or the time points in the
new data. Predicting the biomarker values at a series of evenly spaced
time points can be convenient because they can be easily used for
plotting the longitudinal trajectory. Moreover, by default the
<code>posterior_traj</code> returns a data frame with variables
corresponding to the individual ID, the time, the predicted mean
biomarker value, the limits for the 95% credible interval
(i.e. uncertainty interval for the predicted mean biomarker value), and
limits for the 95% prediction interval (i.e. uncertainty interval for a
predicted biomarker data point), where the level for the uncertainty
intervals can be changed via the <code>prob</code> argument. Conversely,
the <code>posterior_predict</code> function returns an <span class="math inline">\(S\)</span> by <span class="math inline">\(N\)</span> matrix of predictions where <span class="math inline">\(S\)</span> is the number of posterior draws and
<span class="math inline">\(N\)</span> is the number of prediction time
points (note that this return type can also be obtained for
<code>posterior_traj</code> by specifying the argument
<code>return_matrix = TRUE</code>).</p>
<p>As an example, let’s plot the predicted individual-specific
longitudinal trajectories for each of the two biomarkers (log serum
bilirubin and serum albumin) in the multivariate joint model estimated
above. We will do this for three individuals (IDs 6, 7 and 8) who were
included in the model estimation.</p>
<p>Here are the plots for log serum bilirubin:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_traj.html">posterior_traj</a></span><span class="op">(</span><span class="va">mod3</span>, m <span class="op">=</span> <span class="fl">1</span>, ids <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">pp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p1</span>, plot_observed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pp1</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_872312-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>and here are the plots for serum albumin:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_traj.html">posterior_traj</a></span><span class="op">(</span><span class="va">mod3</span>, m <span class="op">=</span> <span class="fl">2</span>, ids <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">pp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p2</span>, plot_observed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pp2</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_555762-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>The <code>m</code> argument specifies which biomarker we want to
predict for (only relevant for a multivariate joint model). The
<code>ids</code> argument is optional, and specifies a subset of
individuals for whom we want to predict. In the plotting method, the
<code>plot_observed = TRUE</code> specifies that we want to include the
observed biomarker values in the plot of the longitudinal
trajectory.</p>
<p>If we wanted to extrapolate the trajectory forward from the event or
censoring time for each individual, then this can be easily achieved by
specifying <code>extrapolate = TRUE</code> in the
<code>posterior_traj</code> call. For example, here is the plot for log
serum bilirubin with extrapolation:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_traj.html">posterior_traj</a></span><span class="op">(</span><span class="va">mod3</span>, m <span class="op">=</span> <span class="fl">1</span>, ids <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span>, extrapolate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p3</span>, plot_observed <span class="op">=</span> <span class="cn">TRUE</span>, vline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pp3</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_65662-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>and for serum albumin with extrapolation:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_traj.html">posterior_traj</a></span><span class="op">(</span><span class="va">mod3</span>, m <span class="op">=</span> <span class="fl">2</span>, ids <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span>, extrapolate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pp4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p4</span>, plot_observed <span class="op">=</span> <span class="cn">TRUE</span>, vline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pp4</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_998889-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>Here, we included the <code>vline = TRUE</code> which adds a vertical
dashed line at the timing of the individual’s event or censoring time.
The interpolation and extrapolation of the biomarker trajectory can be
further controlled through the <code>control</code> argument to the
<code>posterior_traj</code> function; for example, we could specify the
number of time points at which to predict, the distance by which to
extrapolate, and so on.</p>
<p>We could customize these plots further, for example, by using any of
the <strong>ggplot2</strong> functionality or using the additional
arguments described in <code><a href="../reference/plot.predict.stanjm.html">help(plot.predict.stanjm)</a></code>.</p>
</div>
<div class="section level4">
<h4 id="predicted-individual-specific-survival-curves-for-in-sample-individuals">Predicted individual-specific survival curves for in-sample
individuals<a class="anchor" aria-label="anchor" href="#predicted-individual-specific-survival-curves-for-in-sample-individuals"></a>
</h4>
<p>Predicted individual-specific survival probabilities and/or survival
curves can be obtained using the <code>posterior_survfit</code>
function. The function by default returns a data frame with the
individual ID, the time, and the predicted survival probability
(posterior mean and limits for the 95% credible interval). The
uncertainty level for the credible interval can be changed via the
<code>prob</code> argument. By default, individual-specific survival
probabilities are calculated <em>conditional</em> on the individual’s
last known survival time. When we are predicting survival probabilities
for individuals that were used in the estimation of the model
(i.e. in-sample individuals, where no new covariate data is provided),
then the individual’s “last known survival time” will be their event or
censoring time. (Note that if we wanted didn’t want to condition on the
individual’s last known survival time, then we could specify
<code>condition = FALSE</code>, but we probably wouldn’t want to do this
unless we were calculating marginal or standardised survival
probabilities, which are discussed later).</p>
<p>The default argument <code>extrapolate = TRUE</code> specifies that
the individual-specific conditional survival probabilities will be
calculated at evenly spaced time points between the individual’s last
known survival time and the maximum follow up time that was observed in
the estimation sample. The behaviour of the extrapolation can be further
controlled via the <code>control</code> argument. If we were to specify
<code>extrapolate = FALSE</code> then the survival probabilities would
only be calculated at one time point, which could be specified in the
<code>times</code> argument (or otherwise would default to the
individual’s last known survival time).</p>
<p>As an example, let plot the predicted individual-specific conditional
survival curve for the same three individual’s that were used in the
previous example. The predicted survival curve will be obtained under
the multivariate joint model estimated above.<br></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_survfit.html">posterior_survfit</a></span><span class="op">(</span><span class="va">mod3</span>, ids <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">pp5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p5</span><span class="op">)</span></span>
<span><span class="va">pp5</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_23812-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>We could customize the plot further, for example, by using any of the
<strong>ggplot2</strong> functionality or using the additional arguments
described in <code><a href="../reference/plot.survfit.stanjm.html">help(plot.survfit.stanjm)</a></code>.</p>
</div>
<div class="section level4">
<h4 id="combined-plot-of-longitudinal-trajectories-and-survival-curves">Combined plot of longitudinal trajectories and survival curves<a class="anchor" aria-label="anchor" href="#combined-plot-of-longitudinal-trajectories-and-survival-curves"></a>
</h4>
<p>The package also provides a convenience plotting function, which
combines plots of the individual-specific longitudinal trajectories, and
the individual-specific survival function. We can demonstrate this by
replotting the predictions for the three individuals in the previous
example:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.survfit.stanjm.html">plot_stack_jm</a></span><span class="op">(</span>yplot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pp3</span>, <span class="va">pp4</span><span class="op">)</span>, survplot <span class="op">=</span> <span class="va">pp5</span><span class="op">)</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_987321-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>Here we can see the strong relationship between the underlying values
of the biomarkers and mortality. Patient <code>8</code> who, relative to
patients <code>6</code> and <code>7</code>, has a higher underlying
value for log serum bilirubin and a lower underlying value for serum
albumin at the end of their follow up has a far worse predicted
probability of survival.</p>
</div>
<div class="section level4">
<h4 id="predicted-individual-specific-longitudinal-trajectory-and-survival-curve-for-out-of-sample-individuals-i-e--dynamic-predictions">Predicted individual-specific longitudinal trajectory and survival
curve for out-of-sample individuals (i.e. dynamic predictions)<a class="anchor" aria-label="anchor" href="#predicted-individual-specific-longitudinal-trajectory-and-survival-curve-for-out-of-sample-individuals-i-e--dynamic-predictions"></a>
</h4>
<p>Let us take an individual from our training data, in this case the
individual with subject ID value <code>8</code>. However, we will
pretend this individual was not a member of our training data and rather
that they are a new individual for whom we have obtained new biomarker
measurements. Our goal is to obtain predictions for the longitudinal
trajectory for this individual, and their conditional survival curve,
given that we know they are conditional on their biomarker measurements
we currently have available.</p>
<p>First, let’s extract the data for subject <code>8</code> and then
rename their subject ID value so that they appear to be an individual
who was not included in our training dataset:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndL</span> <span class="op">&lt;-</span> <span class="va">pbcLong</span><span class="op">[</span><span class="va">pbcLong</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">8</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">ndE</span> <span class="op">&lt;-</span> <span class="va">pbcSurv</span><span class="op">[</span><span class="va">pbcSurv</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">8</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">ndL</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"new_patient"</span><span class="op">)</span></span>
<span><span class="va">ndE</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"new_patient"</span><span class="op">)</span></span></code></pre></div>
<p>Note that we have both the longitudinal data and event data for this
new individual. We require data for both submodels because we are going
to generate <em>dynamic predictions</em> that require drawing new
individual-specific parameters (i.e. random effects) for this individual
conditional on their observed data. That means we need to evaluate the
likelihood for the full joint model and that requires both the
longitudinal and event data (note however that the status indicator
<code>death</code> will be ignored, since it is assumed that the
individual we are predicting for is still alive at the time we wish to
generate the predictions).</p>
<p>Now we can pass this data to the <code>posterior_traj</code> function
in the same way as for the in-sample individuals, except we will now
specify the <code>newdataLong</code> and <code>newdataEvent</code>
arguments. We will also specify the <code>last_time</code> argument so
that the function knows which variable in the event data specifies the
individual’s last known survival time (the default behaviour is to use
the time of the last biomarker measurement).</p>
<p>Our predictions for this new individual for the log serum bilirubin
trajectory can be obtained using:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_traj.html">posterior_traj</a></span><span class="op">(</span><span class="va">mod3</span>, m <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                     newdataLong <span class="op">=</span> <span class="va">ndL</span>, </span>
<span>                     newdataEvent <span class="op">=</span> <span class="va">ndE</span>,</span>
<span>                     last_time <span class="op">=</span> <span class="st">"futimeYears"</span><span class="op">)</span></span></code></pre></div>
<pre><code>Drawing new random effects for 1 individuals. Monitoring progress:
  |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p6</span>, plot_observed <span class="op">=</span> <span class="cn">TRUE</span>, vline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pp6</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_999333-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>and for the serum albumin trajectory:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_traj.html">posterior_traj</a></span><span class="op">(</span><span class="va">mod3</span>, m <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                     newdataLong <span class="op">=</span> <span class="va">ndL</span>, </span>
<span>                     newdataEvent <span class="op">=</span> <span class="va">ndE</span>,</span>
<span>                     last_time <span class="op">=</span> <span class="st">"futimeYears"</span><span class="op">)</span></span></code></pre></div>
<pre><code>Drawing new random effects for 1 individuals. Monitoring progress:
  |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p7</span>, plot_observed <span class="op">=</span> <span class="cn">TRUE</span>, vline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pp7</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_122223-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>For the conditional survival probabilities we use similar
information, provided to the <code>posterior_survfit</code>
function:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_survfit.html">posterior_survfit</a></span><span class="op">(</span><span class="va">mod3</span>,</span>
<span>                        newdataLong <span class="op">=</span> <span class="va">ndL</span>, </span>
<span>                        newdataEvent <span class="op">=</span> <span class="va">ndE</span>,</span>
<span>                        last_time <span class="op">=</span> <span class="st">"futimeYears"</span><span class="op">)</span></span></code></pre></div>
<pre><code>Drawing new random effects for 1 individuals. Monitoring progress:
  |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p8</span><span class="op">)</span></span>
<span><span class="va">pp8</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_65401-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>We can then use the <code>plot_stack_jm</code> function, as we saw in
a previous example, to stack the plots of the longitudinal trajectory
and the conditional survival curve:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.survfit.stanjm.html">plot_stack_jm</a></span><span class="op">(</span>yplot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pp6</span>, <span class="va">pp7</span><span class="op">)</span>, survplot <span class="op">=</span> <span class="va">pp8</span><span class="op">)</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plots_0089231-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>Here we see that the predicted longitudinal trajectories and
conditional survival curve for this individual, obtained using the
dynamic predictions approach, are similar to the predictions we obtained
when we used their individual-specific parameters from the original
model estimation. This is because in both situations we are conditioning
on the same outcome data.</p>
<p><strong>Side note:</strong> We can even compare the estimated
individual specific parameters obtained under the two approaches. For
example, here is the posterior mean for the estimated
individual-specific parameters for individual <code>8</code> from the
fitted model:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/stanreg-methods.html">ranef</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span><span class="op">[[</span><span class="st">"Long1"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"id"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">8</span>,<span class="op">]</span>, </span>
<span>  <span class="fu"><a href="../reference/stanreg-methods.html">ranef</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span><span class="op">[[</span><span class="st">"Long2"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"id"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">8</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>$`(Intercept)`
[1] -1.636025

$year
[1] 0.1106856

$`(Intercept)`
[1] 0.4636367

$year
[1] -0.04915748</code></pre>
<p>and here is the mean of the draws for the individual-specific
parameters for individual <code>8</code> under the dynamic predictions
approach:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">p6</span>, <span class="st">"b_new"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>b[Long1|(Intercept) id:new_patient]        b[Long1|year id:new_patient] 
                        -1.65217893                          0.10504485 
b[Long2|(Intercept) id:new_patient]        b[Long2|year id:new_patient] 
                         0.45330164                         -0.03059108 </code></pre>
</div>
<div class="section level4">
<h4 id="predicted-population-level-longitudinal-trajectory">Predicted population-level longitudinal trajectory<a class="anchor" aria-label="anchor" href="#predicted-population-level-longitudinal-trajectory"></a>
</h4>
<p>Suppose we wanted to predict the longitudinal trajectory for each of
the biomarkers, marginalising over the distribution of the
individual-specific parameters. To do this, we can pass a new data frame
with the covariate values we want to use in the predictions. Here, we
will demonstrate this by obtaining the predicted trajectory for log
serum bilirubin, under the multivariate joint model that was estimated
previously. Our prediction data will require the variables
<code>year</code>, <code>sex</code> and <code>trt</code>, since these
were the covariates used in the longitudinal submodel.</p>
<p>We will predict the value of log serum bilirubin at years 0 through
10, for each combination of <code>sex</code> and <code>trt</code>. We
also need to include the <code>id</code> variable in our prediction data
because this is relevant to the longitudinal submodel. Since we want to
marginalise over the individual-specific parameters
(i.e. individual-level random effects) we need to note two things:</p>
<ul>
<li><p>First, the values for the <code>id</code> variable <strong>must
not</strong> match any individual used in the model estimation. Here, we
use the following <code>id</code> values: <code>"male_notrt"</code>,
<code>"female_notrt"</code>, <code>"male_trt"</code>, and
<code>"female_trt"</code>, since each individual in our prediction data
represents a different combination of <code>sex</code> and
<code>trt</code>. However, we could have given the individuals any
<code>id</code> value just as long as is didn’t match an individual who
was used in the model estimation</p></li>
<li><p>Second, we need to specify the argument
<code>dynamic = FALSE</code> when calling <code>posterior_traj</code>.
This specifies that we do not want to draw new individual-specific
parameters conditional on outcome data observed up to some time <span class="math inline">\(t\)</span>. Instead, we want predictions that
marginalise over the distribution of individual-specific parameters and
are therefore conditional <em>only on covariates</em> and not
conditional on outcome data for the new individuals.</p></li>
</ul>
<p>Here is our prediction data:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"f"</span><span class="op">)</span>, </span>
<span>                   trt <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">ndL</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male_notrt"</span>, <span class="st">"female_notrt"</span>,</span>
<span>                <span class="st">"male_trt"</span>, <span class="st">"female_trt"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span><span class="va">ndL</span> <span class="op">&lt;-</span> <span class="va">ndL</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ndL</span><span class="op">)</span></span></code></pre></div>
<pre><code>'data.frame':   44 obs. of  4 variables:
 $ id  : chr  "male_notrt" "male_notrt" "male_notrt" "male_notrt" ...
 $ year: num  0 1 2 3 4 5 6 7 8 9 ...
 $ sex : Factor w/ 2 levels "m","f": 1 1 1 1 1 1 1 1 1 1 ...
 $ trt : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>And to predict the marginal longitudinal trajectory for log serum
bilirubin under each covariate profile and plot it we can type:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_traj.html">posterior_traj</a></span><span class="op">(</span><span class="va">mod3</span>, m <span class="op">=</span> <span class="fl">1</span>, newdataLong <span class="op">=</span> <span class="va">ndL</span>, dynamic <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="jm_files/figure-html/plot_traj_218391-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>Because we are marginalising over the distribution of the
individual-specific parameters, we are incorporating all the variation
related to between-individual differences, and therefore the prediction
interval is wide (shown by the shaded area around the marginal
longitudinal trajectory). The magnitude of the effects of both
<code>sex</code> and <code>trt</code> are relatively small compared to
the population-level effect of <code>year</code> and the
between-individual variation in the intercept and slope. For example,
here are the point estimates for the population-level effects of
<code>sex</code>, <code>trt</code>, and <code>year</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stanreg-methods.html">fixef</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span><span class="op">$</span><span class="va">Long1</span></span></code></pre></div>
<pre><code>(Intercept)        sexf         trt        year 
 0.26316891  0.47545756 -0.06287211  0.22199841 </code></pre>
<p>and here are the standard deviations for the individual-level random
effects:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stanreg-methods.html">VarCorr</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span></code></pre></div>
<pre><code> Groups Name              Std.Dev. Corr                
 id     Long1|(Intercept) 1.241233                     
        Long1|year        0.188221  0.490              
        Long2|(Intercept) 0.513955 -0.652 -0.494       
        Long2|year        0.096057 -0.567 -0.810  0.454</code></pre>
<p>This shows us that the point estimates for the population-level
effects of <code>sex</code> and <code>trt</code> are 0.57 and -0.10,
respectively, whereas the standard deviation for the individual-specific
intercept and slope parameters are 1.24 and 0.19; hence, any differences
due to the population-level effects of gender and treatment
(i.e. differences in the black line across the four panels of the plot)
are swamped by the width of the uncertainty intervals (i.e. the grey
shaded areas).</p>
</div>
<div class="section level4">
<h4 id="standardised-survival-curves">Standardised survival curves<a class="anchor" aria-label="anchor" href="#standardised-survival-curves"></a>
</h4>
<p>In this example we show how a standardised survival curve can be
obtained, where the <span class="math inline">\(i =
1,...,N^{pred}\)</span> individuals used in generating the standardised
survival curve are the same individuals that were used in estimating the
model. We will obtain the survival curve for the multivariate joint
model estimated in an earlier example (<code>mod3</code>). The
<code>standardise = TRUE</code> argument to
<code>posterior_survfit</code> specifies that we want to obtain
individual-specific predictions of the survival curve and then average
these. Because, in practical terms, we need to obtain survival
probabilities at time <span class="math inline">\(t\)</span> for each
individual and then average them we want to explicitly specify the
values of <span class="math inline">\(t\)</span> we want to use (and the
same values of <span class="math inline">\(t\)</span> will be used for
individuals). We specify the values of <span class="math inline">\(t\)</span> to use via the <code>times</code>
argument; here we will predict the standardised survival curve at time 0
and then for convenience we can just specify
<code>extrapolate = TRUE</code> (which is the default anyway) which will
mean we automatically predict at 10 evenly spaced time points between 0
and the maximum event or censoring time.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_survfit.html">posterior_survfit</a></span><span class="op">(</span><span class="va">mod3</span>, standardise <span class="op">=</span> <span class="cn">TRUE</span>, times <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span> <span class="co"># data frame with standardised survival probabilities</span></span></code></pre></div>
<pre><code>    year survpred  ci_lb  ci_ub
1 0.0000   1.0000 1.0000 1.0000
2 1.0154   0.8243 0.7659 0.8943
3 2.0307   0.7309 0.6606 0.7805
4 3.0461   0.6789 0.6133 0.7221
5 4.0614   0.6351 0.5746 0.6877
6 5.0768   0.5934 0.5386 0.6456</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span> <span class="co"># plot the standardised survival curve</span></span></code></pre></div>
<p><img src="jm_files/figure-html/standsurv-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Henderson R, Diggle P, Dobson A. Joint modelling of longitudinal
measurements and event time data. <em>Biostatistics</em>
2000;<strong>1</strong>(4):465-80.</li>
<li>Wulfsohn MS, Tsiatis AA. A joint model for survival and longitudinal
data measured with error. <em>Biometrics</em>
1997;<strong>53</strong>(1):330-9.</li>
<li>Tsiatis AA, Davidian M. Joint modeling of longitudinal and
time-to-event data: An overview. <em>Stat Sinica</em>
2004;<strong>14</strong>(3):809-34.</li>
<li>Gould AL, Boye ME, Crowther MJ, Ibrahim JG, Quartey G, Micallef S,
et al. Joint modeling of survival and longitudinal non-survival data:
current methods and issues. Report of the DIA Bayesian joint modeling
working group. <em>Stat Med</em>.
2015;<strong>34</strong>(14):2181-95.</li>
<li>Rizopoulos D. <em>Joint Models for Longitudinal and Time-to-Event
Data: With Applications in R</em> CRC Press; 2012.</li>
<li>Liu G, Gould AL. Comparison of alternative strategies for analysis
of longitudinal trials with dropouts. <em>J Biopharm Stat</em>
2002;<strong>12</strong>(2):207-26.</li>
<li>Prentice RL. Covariate Measurement Errors and Parameter-Estimation
in a Failure Time Regression-Model. <em>Biometrika</em>
1982;<strong>69</strong>(2):331-42.</li>
<li>Baraldi AN, Enders CK. An introduction to modern missing data
analyses. <em>J Sch Psychol</em> 2010;<strong>48</strong>(1):5-37.</li>
<li>Philipson PM, Ho WK, Henderson R. Comparative review of methods for
handling drop-out in longitudinal studies. <em>Stat Med</em>
2008;<strong>27</strong>(30):6276-98.</li>
<li>Pantazis N, Touloumi G. Bivariate modelling of longitudinal
measurements of two human immunodeficiency type 1 disease progression
markers in the presence of informative drop-outs. <em>Applied
Statistics</em> 2005;<strong>54</strong>:405-23.</li>
<li>Taylor JM, Park Y, Ankerst DP, et al. Real-time individual
predictions of prostate cancer recurrence using joint models.
<em>Biometrics</em> 2013;<strong>69</strong>(1):206-13.</li>
<li>Brilleman SL, Crowther MJ, Moreno-Betancur M, Buros Novik J, Wolfe
R. Joint longitudinal and time-to-event models via Stan. <em>In:
Proceedings of StanCon 2018.</em> <a href="https://github.com/stan-dev/stancon_talks" class="external-link uri">https://github.com/stan-dev/stancon_talks</a>
</li>
<li>Stan Development Team. <em>rstanarm: Bayesian applied regression
modeling via Stan.</em> R package version 2.14.1. <a href="https://mc-stan.org/" class="external-link uri">https://mc-stan.org/</a>.
2016.</li>
<li>R Core Team. <em>R: A language and environment for statistical
computing.</em> Vienna, Austria: R Foundation for Statistical Computing;
2015.</li>
<li>Crowther MJ, Lambert PC, Abrams KR. Adjusting for measurement error
in baseline prognostic biomarkers included in a time-to-event analysis:
a joint modelling approach. <em>BMC Med Res Methodol</em>
2013;<strong>13</strong>.</li>
<li>Hickey GL, Philipson P, Jorgensen A, Kolamunnage-Dona R. Joint
modelling of time-to-event and multivariate longitudinal outcomes:
recent developments and issues. <em>BMC Med Res Methodol</em>
2016;<strong>16</strong>(1):117.</li>
<li>Rizopoulos D, Ghosh P. A Bayesian semiparametric multivariate joint
model for multiple longitudinal outcomes and a time-to-event. <em>Stat
Med</em>. 2011;<strong>30</strong>(12):1366-80.</li>
<li>Laurie DP. Calculation of Gauss-Kronrod quadrature rules. <em>Math
Comput</em> 1997;<strong>66</strong>(219):1133-45.</li>
<li>Rizopoulos D. Dynamic Predictions and Prospective Accuracy in Joint
Models for Longitudinal and Time-to-Event Data. <em>Biometrics</em>
2011;<strong>67</strong>(3):819-829.</li>
<li>Therneau T, Grambsch P. <em>Modeling Survival Data: Extending the
Cox Model</em> Springer-Verlag, New York; 2000. ISBN: 0-387-98784-3</li>
</ol>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
