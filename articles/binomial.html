<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating Generalized Linear Models for Binary and Binomial Data with rstanarm • rstanarm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Generalized Linear Models for Binary and Binomial Data with rstanarm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages">
<li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Estimating Generalized Linear Models for Binary and Binomial Data with rstanarm</h1>
                        <h4 data-toc-skip class="author">Jonah Gabry and
Ben Goodrich</h4>
            
            <h4 data-toc-skip class="date">2025-12-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/New-pkgdown-theme/vignettes/binomial.Rmd" class="external-link"><code>vignettes/binomial.Rmd</code></a></small>
      <div class="d-none name"><code>binomial.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{stan_glm: GLMs for Binary and Binomial Data}
-->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/theme_default.html" class="external-link">theme_default</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette explains how to estimate generalized linear models
(GLMs) for binary (Bernoulli) and Binomial response variables using the
<code>stan_glm</code> function in the <strong>rstanarm</strong>
package.</p>
<p>The four steps of a Bayesian analysis are</p>
<ol style="list-style-type: decimal">
<li>Specify a joint distribution for the outcome(s) and all the
unknowns, which typically takes the form of a marginal prior
distribution for the unknowns multiplied by a likelihood for the
outcome(s) conditional on the unknowns. This joint distribution is
proportional to a posterior distribution of the unknowns conditional on
the observed data</li>
<li>Draw from posterior distribution using Markov Chain Monte Carlo
(MCMC).</li>
<li>Evaluate how well the model fits the data and possibly revise the
model.</li>
<li>Draw from the posterior predictive distribution of the outcome(s)
given interesting values of the predictors in order to visualize how a
manipulation of a predictor affects (a function of) the outcome(s).</li>
</ol>
<p>Steps 3 and 4 are covered in more depth by the vignette entitled <a href="rstanarm.html">“How to Use the <strong>rstanarm</strong>
Package”</a>. This vignette focuses on Step 1 when the likelihood is the
product of conditionally independent binomial distributions (possibly
with only one trial per observation).</p>
</div>
<div class="section level2">
<h2 id="likelihood">Likelihood<a class="anchor" aria-label="anchor" href="#likelihood"></a>
</h2>
<p>For a binomial GLM the likelihood for one observation <span class="math inline">\(y\)</span> can be written as a conditionally
binomial PMF <span class="math display">\[\binom{n}{y} \pi^{y} (1 -
\pi)^{n - y},\]</span> where <span class="math inline">\(n\)</span> is
the known number of trials, <span class="math inline">\(\pi =
g^{-1}(\eta)\)</span> is the probability of success and <span class="math inline">\(\eta = \alpha + \mathbf{x}^\top
\boldsymbol{\beta}\)</span> is a linear predictor. For a sample of size
<span class="math inline">\(N\)</span>, the likelihood of the entire
sample is the product of <span class="math inline">\(N\)</span>
individual likelihood contributions.</p>
<p>Because <span class="math inline">\(\pi\)</span> is a probability,
for a binomial model the <em>link</em> function <span class="math inline">\(g\)</span> maps between the unit interval (the
support of <span class="math inline">\(\pi\)</span>) and the set of all
real numbers <span class="math inline">\(\mathbb{R}\)</span>. When
applied to a linear predictor <span class="math inline">\(\eta\)</span>
with values in <span class="math inline">\(\mathbb{R}\)</span>, the
inverse link function <span class="math inline">\(g^{-1}(\eta)\)</span>
therefore returns a valid probability between 0 and 1.</p>
<p>The two most common link functions used for binomial GLMs are the <a href="https://en.wikipedia.org/wiki/Logit" class="external-link">logit</a> and <a href="https://en.wikipedia.org/wiki/Probit" class="external-link">probit</a> functions. With
the logit (or log-odds) link function <span class="math inline">\(g(x) =
\ln{\left(\frac{x}{1-x}\right)}\)</span>, the likelihood for a single
observation becomes</p>
<p><span class="math display">\[\binom{n}{y}\left(\text{logit}^{-1}(\eta)\right)^y
\left(1 - \text{logit}^{-1}(\eta)\right)^{n-y} =
\binom{n}{y} \left(\frac{e^{\eta}}{1 + e^{\eta}}\right)^{y}
\left(\frac{1}{1 + e^{\eta}}\right)^{n - y}\]</span></p>
<p>and the probit link function <span class="math inline">\(g(x) =
\Phi^{-1}(x)\)</span> yields the likelihood</p>
<p><span class="math display">\[\binom{n}{y} \left(\Phi(\eta)\right)^{y}
\left(1 - \Phi(\eta)\right)^{n - y},\]</span></p>
<p>where <span class="math inline">\(\Phi\)</span> is the CDF of the
standard normal distribution. The differences between the logit and
probit functions are minor and – if, as <strong>rstanarm</strong> does
by default, the probit is scaled so its slope at the origin matches the
logit’s – the two link functions should yield similar results. With
<code>stan_glm</code>, binomial models with a logit link function can
typically be fit slightly faster than the identical model with a probit
link because of how the two models are implemented in Stan. Unless the
user has a specific reason to prefer the probit link, we recommend the
logit simply because it will be slightly faster and more numerically
stable.</p>
<p>In theory, there are infinitely many possible link functions,
although in practice only a few are typically used. Other common choices
are the <code>cauchit</code> and <code>cloglog</code> functions, which
can also be used with <code>stan_glm</code> (every link function
compatible with<code>glm</code> will work with
<code>stan_glm</code>).</p>
</div>
<div class="section level2">
<h2 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h2>
<p>A full Bayesian analysis requires specifying prior distributions
<span class="math inline">\(f(\alpha)\)</span> and <span class="math inline">\(f(\boldsymbol{\beta})\)</span> for the intercept
and vector of regression coefficients. When using <code>stan_glm</code>,
these distributions can be set using the <code>prior_intercept</code>
and <code>prior</code> arguments. The <code>stan_glm</code> function
supports a variety of prior distributions, which are explained in the
<strong>rstanarm</strong> documentation
(<code><a href="../reference/priors.html">help(priors, package = 'rstanarm')</a></code>).</p>
<p>As an example, suppose we have <span class="math inline">\(K\)</span>
predictors and believe — prior to seeing the data — that <span class="math inline">\(\alpha, \beta_1, \dots, \beta_K\)</span> are as
likely to be positive as they are to be negative, but are highly
unlikely to be far from zero. These beliefs can be represented by normal
distributions with mean zero and a small scale (standard deviation). To
give <span class="math inline">\(\alpha\)</span> and each of the <span class="math inline">\(\beta\)</span>s this prior (with a scale of 1,
say), in the call to <code>stan_glm</code> we would include the
arguments <code>prior_intercept = normal(0,1)</code> and
<code>prior = normal(0,1)</code>.</p>
<p>If, on the other hand, we have less a priori confidence that the
parameters will be close to zero then we could use a larger scale for
the normal distribution and/or a distribution with heavier tails than
the normal like the Student t distribution. <strong>Step 1</strong> in
the “How to Use the <strong>rstanarm</strong> Package” vignette
discusses one such example.</p>
</div>
<div class="section level2">
<h2 id="posterior">Posterior<a class="anchor" aria-label="anchor" href="#posterior"></a>
</h2>
<p>With independent prior distributions, the joint posterior
distribution for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\boldsymbol{\beta}\)</span> is proportional to the
product of the priors and the <span class="math inline">\(N\)</span>
likelihood contributions:</p>
<p><span class="math display">\[f\left(\alpha,\boldsymbol{\beta} |
\mathbf{y},\mathbf{X}\right) \propto
  f\left(\alpha\right) \times \prod_{k=1}^K f\left(\beta_k\right) \times
  \prod_{i=1}^N {
  g^{-1}\left(\eta_i\right)^{y_i}
  \left(1 - g^{-1}\left(\eta_i\right)\right)^{n_i-y_i}}.\]</span></p>
<p>This is posterior distribution that <code>stan_glm</code> will draw
from when using MCMC.</p>
</div>
<div class="section level2">
<h2 id="logistic-regression-example">Logistic Regression Example<a class="anchor" aria-label="anchor" href="#logistic-regression-example"></a>
</h2>
<p>When the logit link function is used the model is often referred to
as a logistic regression model (the inverse logit function is the CDF of
the standard logistic distribution). As an example, here we will show
how to carry out a few parts of the analysis from Chapter 5.4 of <a href="https://sites.stat.columbia.edu/gelman/arm/" class="external-link">Gelman and Hill
(2007)</a> using <code>stan_glm</code>.</p>
<p>Gelman and Hill describe a survey of 3200 residents in a small area
of Bangladesh suffering from arsenic contamination of groundwater.
Respondents with elevated arsenic levels in their wells had been
encouraged to switch their water source to a safe public or private well
in the nearby area and the survey was conducted several years later to
learn which of the affected residents had switched wells. The goal of
the analysis presented by Gelman and Hill is to learn about the factors
associated with switching wells.</p>
<p>To start, we’ll use <code>dist</code> (the distance from the
respondent’s house to the nearest well with safe drinking water) as the
only predictor of <code>switch</code> (1 if switched, 0 if not). Then
we’ll expand the model by adding the arsenic level of the water in the
resident’s own well as a predictor and compare this larger model to the
original.</p>
<p>After loading the <code>wells</code> data, we first rescale the
<code>dist</code> variable (measured in meters) so that it is measured
in units of 100 meters. If we leave <code>dist</code> in its original
units then the corresponding regression coefficient will represent the
effect of the marginal meter, which is too small to have a useful
interpretation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wells</span><span class="op">)</span></span>
<span><span class="va">wells</span><span class="op">$</span><span class="va">dist100</span> <span class="op">&lt;-</span> <span class="va">wells</span><span class="op">$</span><span class="va">dist</span> <span class="op">/</span> <span class="fl">100</span></span></code></pre></div>
<p>Before estimating any models we can visualize the distribution of
<code>dist100</code> in the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">wells</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dist100</span>, y <span class="op">=</span> <span class="va">..density..</span>, fill <span class="op">=</span> <span class="va">switch</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray30"</span>, <span class="st">"skyblue"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="binomial_files/figure-html/binom-arsenic-plot-dist100-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>In the plot above the blue bars correspond to the 1737 residents who
said they switched wells and darker bars show the distribution of
<code>dist100</code> for the 1283 residents who didn’t switch. As we
would expect, for the residents who switched wells, the distribution of
<code>dist100</code> is more concentrated at smaller distances.</p>
<p>A Bayesian version of Gelman and Hill’s initial logistic regression
model can be estimated using the <code>stan_glm</code> function. Here
we’ll use a Student t prior with 7 degrees of freedom and a scale of
2.5, which, as discussed above, is a reasonable default prior when
coefficients should be close to zero but have some chance of being
large.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/priors.html">student_t</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">7</span>, location <span class="op">=</span> <span class="fl">0</span>, scale <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_glm.html">stan_glm</a></span><span class="op">(</span><span class="va">switch</span> <span class="op">~</span> <span class="va">dist100</span>, data <span class="op">=</span> <span class="va">wells</span>, </span>
<span>                 family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, </span>
<span>                 prior <span class="op">=</span> <span class="va">t_prior</span>, prior_intercept <span class="op">=</span> <span class="va">t_prior</span>,  </span>
<span>                 cores <span class="op">=</span> <span class="fl">2</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<pre><code>(Intercept)     dist100 
      0.605      -0.621 </code></pre>
<p>The <code>formula</code>, <code>data</code> and <code>family</code>
arguments to <code>stan_glm</code> are specified in exactly the same way
as for <code>glm</code>. We’ve also added the optional additional
arguments <code>chains</code> (how many chains we want to execute),
<code>cores</code> (how many cores we want the computer to utilize) and
<code>seed</code> (for reproducibility). You can read about other
possible arguments in the <code>stan_glm</code> documentation
(<code><a href="../reference/stan_glm.html">help(stan_glm, package = 'rstanarm')</a></code>).</p>
<p>To get a sense for the uncertainty in our estimates we can use the
<code>posterior_interval</code> function to get Bayesian uncertainty
intervals. The uncertainty intervals are computed by finding the
relevant quantiles of the draws from the posterior distribution. For
example, to compute 50% intervals we use:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/posterior_interval.stanreg.html">posterior_interval</a></span><span class="op">(</span><span class="va">fit1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>              25%   75%
(Intercept)  0.57  0.65
dist100     -0.69 -0.56</code></pre>
<p>For more on <code>posterior_interval</code> and interpreting the
parameter estimates from a Bayesian model see Step 2 in the <a href="rstanarm.html">“How to Use the <strong>rstanarm</strong>
Package”</a> vignette.</p>
<p>Using the coefficient estimates we can plot the predicted probability
of <code>switch = 1</code> (as a function of <code>dist100</code>)
together with the observed outcomes:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predicted probability as a function of x</span></span>
<span><span class="va">pr_switch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">ests</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">ests</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">ests</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="co"># A function to slightly jitter the binary data</span></span>
<span><span class="va">jitt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html" class="external-link">aes_string</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.05</span>, width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>             size <span class="op">=</span> <span class="fl">2</span>, shape <span class="op">=</span> <span class="fl">21</span>, stroke <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">wells</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dist100</span>, y <span class="op">=</span> <span class="va">switch</span>, color <span class="op">=</span> <span class="va">switch</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">jitt</span><span class="op">(</span>x<span class="op">=</span><span class="st">"dist100"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">pr_switch</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"gray35"</span><span class="op">)</span></span></code></pre></div>
<p><img src="binomial_files/figure-html/binom-arsenic-plot-model-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>The plot shows that under this model the predicted probability of
switching is a decent bit above 50% for residents living very close to
wells with safe drinking water. As expected, larger values of
<code>dist100</code> are associated with lower predicted probabilities
of switching. At the extreme (<span class="math inline">\(\approx
300\)</span> meters), the probability is about 25%.</p>
<p>Next, we incorporate an additional predictor into the model: the
arsenic level of water in the respondent’s well. According to Gelman and
Hill, “At the levels present in the Bangladesh drinking water, the
health risks from arsenic are roughly proportional to exposure, and so
we would expect switching to be more likely from wells with high arsenic
levels” (pg. 90). We only need to change the formula, so we can use the
<code>update</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit1</span>, formula <span class="op">=</span> <span class="va">switch</span> <span class="op">~</span> <span class="va">dist100</span> <span class="op">+</span> <span class="va">arsenic</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">coef_fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>(Intercept)     dist100     arsenic 
      0.002      -0.896       0.462 </code></pre>
<p>As expected the coefficient on <code>arsenic</code> is positive. The
plot below shows distance on the x-axis and arsenic level on the y-axis
with the predicted probability of well-switching mapped to the color of
the background tiles (the lighter the color the higher the probability).
The observed value of <code>switch</code> is indicated by the color of
the points.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pr_switch2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">ests</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">ests</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">ests</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">ests</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>dist100 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, </span>
<span>                    arsenic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grid</span><span class="op">$</span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">grid</span>, <span class="fu">pr_switch2</span><span class="op">(</span><span class="va">dist100</span>, <span class="va">arsenic</span>, <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dist100</span>, y <span class="op">=</span> <span class="va">arsenic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wells</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">switch</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span><span class="st">"switch"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"black"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="binomial_files/figure-html/binom-arsenic-plot-model2-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>We can see that the black points (<code>switch=1</code>) are
predominantly clustered in the upper-left region of the plot where the
predicted probability of switching is highest.</p>
<p>Another way we can visualize the data and model is to follow Gelman
and Hill and create separate plots for varying the arsenic level and
distance. Here we’ll plot curves representing the predicted probability
of switching for the minimum, maximum and quartile values of both
variables.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quantiles</span></span>
<span><span class="va">q_ars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">wells</span><span class="op">$</span><span class="va">dist100</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">wells</span><span class="op">$</span><span class="va">arsenic</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span>  </span>
<span><span class="va">base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">wells</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vary_arsenic</span> <span class="op">&lt;-</span> <span class="va">base</span> <span class="op">+</span> <span class="fu">jitt</span><span class="op">(</span>x<span class="op">=</span><span class="st">"arsenic"</span>, y<span class="op">=</span><span class="st">"switch"</span>, color<span class="op">=</span><span class="st">"switch"</span><span class="op">)</span></span>
<span><span class="va">vary_dist</span> <span class="op">&lt;-</span> <span class="va">base</span> <span class="op">+</span> <span class="fu">jitt</span><span class="op">(</span>x<span class="op">=</span><span class="st">"dist100"</span>, y<span class="op">=</span><span class="st">"switch"</span>, color<span class="op">=</span><span class="st">"switch"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vary_dist</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">vary_dist</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">pr_switch2</span>, color <span class="op">=</span> <span class="st">"gray35"</span>, </span>
<span>                              args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">q_dist</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">vary_arsenic</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">vary_arsenic</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">pr_switch2</span>, color <span class="op">=</span> <span class="st">"gray35"</span>, </span>
<span>                                 args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">q_ars</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot_grid.html" class="external-link">bayesplot_grid</a></span><span class="op">(</span><span class="va">vary_dist</span>, <span class="va">vary_arsenic</span>, </span>
<span>               grid_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="binomial_files/figure-html/binom-arsenic-plot-model2-alt-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>We can compare our two models (with and without <code>arsenic</code>)
using an approximation to Leave-One-Out (LOO) cross-validation, which is
a method for estimating out of sample predictive performance and is
implemented by the <code>loo</code> function in the <strong>loo</strong>
package:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">loo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>
Computed from 4000 by 3020 log-likelihood matrix.

         Estimate   SE
elpd_loo  -2040.1 10.4
p_loo         2.0  0.0
looic      4080.2 20.8
------
MCSE of elpd_loo is 0.0.
MCSE and ESS estimates assume independent draws (r_eff=1).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">loo2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>
Computed from 4000 by 3020 log-likelihood matrix.

         Estimate   SE
elpd_loo  -1968.4 15.7
p_loo         3.2  0.1
looic      3936.9 31.3
------
MCSE of elpd_loo is 0.0.
MCSE and ESS estimates assume independent draws (r_eff=1).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span><span class="op">(</span><span class="va">loo1</span>, <span class="va">loo2</span><span class="op">)</span></span></code></pre></div>
<pre><code>     elpd_diff se_diff
fit2   0.0       0.0  
fit1 -71.7      12.2  </code></pre>
<p>These results favor <code>fit2</code> over <code>fit1</code>, as the
estimated difference in <code>elpd</code> (the expected log pointwise
predictive density for a new dataset) is so much larger than its
standard error. LOO penalizes models for adding additional predictors
(this helps counter overfitting), but in this case <code>fit2</code>
represents enough of an improvement over <code>fit1</code> that the
penalty for including <code>arsenic</code> is negligible (as it should
be if <code>arsenic</code> is an important predictor).</p>
<p>The <a href="lm.html">vignette</a> for the <code>stan_lm</code>
function also has an example of using the <code>loo</code> function
where the results are quite a bit different from what we see here and
some important additional considerations are discussed.</p>
</div>
<div class="section level2">
<h2 id="conditional-logit-models">Conditional Logit Models<a class="anchor" aria-label="anchor" href="#conditional-logit-models"></a>
</h2>
<p>The previous example relies on the fact that observations are
plausibly conditionally independent. In contrast, so-called
“case-control studies” require that there are a fixed number of
successes and failures within each stratum, and the question is
<em>which</em> members of each stratum succeed and fail? The
<code>stan_clogit</code> function estimates such a model and is very
similar to the <code>clogit</code> function in the
<strong>survival</strong> package. The main syntactical difference is
that the <code>clogit</code> function requires that the user call the
<code>strata</code> function in the model formula, whereas the
<code>stan_clogit</code> function has a required <code>strata</code>
argument. In addition, in the <code>stan_clogit</code> case the data
must be sorted by the variable passed to <code>strata</code>. The
advantage to these changes is that <code>stan_clogit</code> can
optionally utilize the multilevel syntax from the <strong>lme4</strong>
package to specify group-specific terms, rather than the more limited
multilevel structure supported by the <code>frailty</code> function in
the <strong>survival</strong> package. The <a href="glmer.html">vignette</a> for the <code>stan_glmer</code> function
discusses the lme4-style syntax in more detail. For example,</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_clogit.html">stan_clogit</a></span><span class="op">(</span><span class="va">case</span> <span class="op">~</span> <span class="va">spontaneous</span> <span class="op">+</span> <span class="va">induced</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">parity</span><span class="op">)</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">infert</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">infert</span><span class="op">$</span><span class="va">stratum</span><span class="op">)</span>, <span class="op">]</span>, <span class="co"># order necessary</span></span>
<span>                    strata <span class="op">=</span> <span class="va">stratum</span>, QR <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    cores <span class="op">=</span> <span class="fl">2</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post</span></span></code></pre></div>
<pre><code>stan_clogit
 family:       binomial [clogit]
 formula:      case ~ spontaneous + induced + (1 | parity)
 observations: 248
------
            Median MAD_SD
spontaneous 2.0    0.3   
induced     1.4    0.3   

Error terms:
 Groups Name        Std.Dev.
 parity (Intercept) 1.4     
Num. levels: parity 6 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>The posterior predictions are also constrained such that there is
exactly one success (in this case) for each of the strata and thus the
posterior distribution of the probabilities are also so constrained:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PPD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_predict.stanreg.html">posterior_predict</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">PPD</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">infert</span><span class="op">$</span><span class="va">stratum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">PLP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_linpred.stanreg.html">posterior_linpred</a></span><span class="op">(</span><span class="va">post</span>, transform <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">PLP</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">infert</span><span class="op">$</span><span class="va">stratum</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="binomial-models">Binomial Models<a class="anchor" aria-label="anchor" href="#binomial-models"></a>
</h2>
<p>Although the example in this vignette focused on a binary response
variable, we can use nearly identical code if we have the sum of
multiple binary variables. For example, image a hypothetical dataset
similar to the well-switching data but spanning multiple villages. Each
observation (each row) of this <code>data.frame</code> corresponds to an
entire village: <code>switch[i]</code> is the number of ‘yes’ responses
to the well-switching question for village <code>i</code>,
<code>dist100[i]</code> is the average distance to the closest well with
clean water for village <code>i</code>, etc. We also now have a variable
<code>n</code> where <code>n[i]</code> is the number of respondents from
village <code>i</code>.</p>
<p>For this data we can estimate a similar model to the one we used in
the binary case by changing the formula to</p>
<p><code>cbind(switch, n - switch) ~ dist100 + arsenic</code></p>
<p>The left-hand side is now a 2-column matrix where the first column is
the number of ‘yes’ responses and the second column is the number of
‘no’ responses (or more generally, the number of successes and number of
failures). The same model can also be specified using the proportion of
‘yes’ responses and the total number of responses in each village. This
corresponds to the formula</p>
<p><code>prop_switch ~ dist100 + arsenic</code></p>
<p>where <code>prop_switch = switch / n</code> is the proportion of
‘yes’ responses. The total number of responses is provided using the
<code>weights</code> argument. In this case we would add
<code>weights = n</code> to the call to <code>stan_glm</code>.</p>
<p>An example of a similar model can also be found in <strong>Step
1</strong> of the <a href="rstanarm.html">“How to Use the
<strong>rstanarm</strong> Package”</a> vignette.</p>
</div>
<div class="section level2">
<h2 id="going-further">Going Further<a class="anchor" aria-label="anchor" href="#going-further"></a>
</h2>
<p>In the hypothetical scenario above, if we also have access to the
observations for each individual in all of the villages (not just the
aggregate data), then a natural extension would be to consider a
multilevel model that takes advantage of the inherent multilevel
structure of the data (individuals nested within villages). The <a href="glmer.html">vignette</a> for the <code>stan_glmer</code> function
discusses these models.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Gelman, A. and Hill, J. (2007). <em>Data Analysis Using Regression
and Multilevel/Hierarchical Models.</em> Cambridge University Press,
Cambridge, UK.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
