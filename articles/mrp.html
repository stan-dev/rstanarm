<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MRP with rstanarm • rstanarm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.js" integrity="sha256-qoRlVrS5NAnXSSSiMfFXwK8C9obG11Iybe4h2+bQYR4=" crossorigin="anonymous">
  </script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MRP with rstanarm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages">
<li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>MRP with rstanarm</h1>
                        <h4 data-toc-skip class="author">Lauren Kennedy
and Jonah Gabry</h4>
            
            <h4 data-toc-skip class="date">2025-12-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/New-pkgdown-theme/vignettes/mrp.Rmd" class="external-link"><code>vignettes/mrp.Rmd</code></a></small>
      <div class="d-none name"><code>mrp.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{MRP with rstanarm}
-->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/theme_default.html" class="external-link">theme_default</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># options(mc.cores = 4) </span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<p>Inference about the population is one the main aims of statistical
methodology. Multilevel regression and post-stratification (MRP) <span class="citation">(Little 1993; Lax and Phillips 2009; Park, Gelman, and
Bafumi 2004)</span> has been shown to be an effective method of
adjusting the sample to be more representative of the population for a
set of key variables. Recent work has demonstrated the effectiveness of
MRP when there are a number of suspected interactions between these
variables <span class="citation">(Ghitza and Gelman 2013)</span>,
replicated by <span class="citation">Lei, Gelman, and Ghitza
(2017)</span>. While <span class="citation">Ghitza and Gelman
(2013)</span> use approximate marginal maximum likelihood estimates;
<span class="citation">Lei, Gelman, and Ghitza (2017)</span> implement a
fully Bayesian approach through Stan.</p>
<p>The <strong>rstanarm</strong> package allows the user to conduct
complicated regression analyses in Stan with the simplicity of standard
formula notation in R. The purpose of this vignette is to demonstrate
the utility of <strong>rstanarm</strong> when conducting MRP analyses.
We will not delve into the details of conducting logistic regression
with rstanarm as this is already covered in <a href="https://mc-stan.org/rstanarm/articles/">other vignettes</a>.</p>
<p>Most of the code for data manipulation and plotting is not shown in
the text but is available in the R markdown <a href="https://github.com/stan-dev/rstanarm/blob/master/vignettes/mrp.Rmd" class="external-link">source
code on GitHub</a>.</p>
<div class="section level2">
<h2 id="the-data">The Data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h2>
<p>Three data sets are simulated by the function
<code>simulate_mrp_data()</code>, which is defined in the <a href="https://github.com/stan-dev/rstanarm/blob/master/vignettes/mrp.Rmd" class="external-link">source
code</a> for this R markdown document (and printed in the appendix). The
first, <code>sample</code>, contains <span class="math inline">\(n\)</span> observations from the individuals that
form our sample (i.e., <span class="math inline">\(n\)</span> rows). For
each individual we have their age (recorded as membership within a
specific age bracket), ethnicity, income level (recorded as membership
within a specific bracket), and gender. Participants were randomly
sampled from a state.</p>
<p>MRP is often used for dichotomous fixed choice questions (e.g.,
McCain’s share of two party vote <span class="citation">(Ghitza and
Gelman 2013)</span>; support for George W Bush, <span class="citation">(Park, Gelman, and Bafumi 2004)</span>; or support for
the death penalty <span class="citation">(Shirley and Gelman
2015)</span>), so we will use a binary variable as the outcome in this
vignette. However, MRP can also be used if there are more than two
categories or if the outcome is continuous.</p>
<p>As this is a simple toy example, we will describe the proportion of
the population who would choose to adopt a cat over a dog, given the
opportunity. We will simulate data using a function that is included in
the appendix of this document. The <code>simulate_mrp_data()</code>
function simulates a sample from a much larger population. It returns a
list including the sample, population poststratification matrix and the
true population preference for cats.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrp_sim</span> <span class="op">&lt;-</span> <span class="fu">simulate_mrp_data</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1200</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mrp_sim</span><span class="op">)</span></span></code></pre></div>
<pre><code>List of 3
 $ sample   :'data.frame':  1200 obs. of  7 variables:
  ..$ cat_pref: num [1:1200] 1 1 1 1 0 0 1 1 1 1 ...
  ..$ male    : num [1:1200] 0 0 0 0 0 0 0 1 0 0 ...
  ..$ age     : num [1:1200] 5 6 3 6 1 5 7 6 5 7 ...
  ..$ eth     : num [1:1200] 3 1 2 1 1 1 3 3 2 3 ...
  ..$ income  : num [1:1200] 3 1 2 1 3 1 2 1 1 1 ...
  ..$ state   : num [1:1200] 19 45 21 47 12 38 2 20 11 34 ...
  ..$ id      : num [1:1200] 1 2 3 4 5 6 7 8 9 10 ...
 $ poststrat:'data.frame':  6300 obs. of  6 variables:
  ..$ male  : num [1:6300] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ eth   : num [1:6300] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ age   : num [1:6300] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ income: num [1:6300] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ state : num [1:6300] 1 2 3 4 5 6 7 8 9 10 ...
  ..$ N     : num [1:6300] 103741 104862 164704 133049 167578 ...
 $ true_popn:'data.frame':  6300 obs. of  6 variables:
  ..$ male    : num [1:6300] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ eth     : num [1:6300] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ age     : num [1:6300] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ income  : num [1:6300] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ state   : num [1:6300] 1 2 3 4 5 6 7 8 9 10 ...
  ..$ cat_pref: num [1:6300] 0.5 0.426 0.269 0.574 0.332 ...</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="va">mrp_sim</span><span class="op">[[</span><span class="st">"sample"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>     cat_pref male age eth income state   id
1           1    0   5   3      3    19    1
2           1    0   6   1      1    45    2
3           1    0   3   2      2    21    3
4           1    0   6   1      1    47    4
5           0    0   1   1      3    12    5
6           0    0   5   1      1    38    6
1195        0    0   6   3      2    21 1195
1196        1    0   3   3      1    46 1196
1197        1    0   5   1      2    48 1197
1198        0    1   1   1      1    14 1198
1199        0    0   1   3      1    12 1199
1200        0    1   3   2      2    12 1200</code></pre>
<p>The variables describing the individual (age, ethnicity, income level
and gender) will be used to match the sample to the population of
interest. To do this we will need to form a post-stratification table,
which contains the number of people in each possible combination of the
post-stratification variables. We have 4 variables with 2 (male), 7
(age), 3 (ethnicity) and 3 (income) levels, so there are 2x7x3x3
different levels. Participants are also selected from a state (50),
increasing the number of possible levels to <span class="math inline">\(6300\)</span>.</p>
<p>To make inference about the population, we will also need the
proportion of individuals in each post stratification cell at the
<em>population</em> level. We will use this information to update the
estimate of our outcome variable from the sample so that is more
representative of the population. This is particularly helpful if there
is a belief that the sample has some bias (e.g., a greater proportion of
females responded than males), and that the bias impacts the outcome
variable (e.g., maybe women are more likely to pick a cat than men). For
each possible combination of factors, the post-stratification table
shows the proportion/number of the population in that cell (rather than
the proportion/number in the sample in the cell).</p>
<p>Below we read in the poststrat data our simulated data list.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poststrat</span> <span class="op">&lt;-</span> <span class="va">mrp_sim</span><span class="op">[[</span><span class="st">"poststrat"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>     male eth age income state      N
1       0   1   1      1     1 103741
2       0   1   1      1     2 104862
3       0   1   1      1     3 164704
4       0   1   1      1     4 133049
5       0   1   1      1     5 167578
6       0   1   1      1     6 109814
6295    1   3   7      3    45  10061
6296    1   3   7      3    46  13055
6297    1   3   7      3    47  12578
6298    1   3   7      3    48  13754
6299    1   3   7      3    49   9937
6300    1   3   7      3    50   9646</code></pre>
<p>One of the benefits of using a simulated data set for this example is
that the actual population level probability of cat preference is known
for each post-stratification cell. In real world data analysis, we don’t
have this luxury, but we will use it later in this case study to check
the predictions of the model. Details regarding the simulation of this
data are available in the appendix.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">true_popn</span> <span class="op">&lt;-</span> <span class="va">mrp_sim</span><span class="op">[[</span><span class="st">"true_popn"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">true_popn</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">true_popn</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>     male eth age income state  cat_pref
1       0   1   1      1     1 0.5000000
2       0   1   1      1     2 0.4255575
3       0   1   1      1     3 0.2689414
4       0   1   1      1     4 0.5744425
5       0   1   1      1     5 0.3318122
6       0   1   1      1     6 0.6224593
6295    1   3   7      3    45 0.7502601
6296    1   3   7      3    46 0.8581489
6297    1   3   7      3    47 0.9241418
6298    1   3   7      3    48 0.6456563
6299    1   3   7      3    49 0.4255575
6300    1   3   7      3    50 0.9308616</code></pre>
</div>
<div class="section level2">
<h2 id="exploring-graphically">Exploring Graphically<a class="anchor" aria-label="anchor" href="#exploring-graphically"></a>
</h2>
<p>Before we begin with the MRP analysis, we first explore the data set
with some basic visualizations.</p>
<div class="section level3">
<h3 id="comparing-sample-to-population">Comparing sample to population<a class="anchor" aria-label="anchor" href="#comparing-sample-to-population"></a>
</h3>
<p>The aim of this analysis is to obtain a <em>population</em>
estimation of cat preference given our sample of <span class="math inline">\(4626\)</span>. We can see in the following plot
the difference in proportions between the sample and the population.
Horizontal panels represent each variable. Bars represent the proportion
of the sample (solid) and population (dashed) in each category
(represented by colour and the x-axis). For ease of viewing, we ordered
the states in terms of the proportion of the sample in that state that
was observed. We will continue this formatting choice thoughout this
vignette.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample</span><span class="op">$</span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">state</span>, levels<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">sample</span><span class="op">$</span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">state</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">true_popn</span><span class="op">$</span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">true_popn</span><span class="op">$</span><span class="va">state</span>,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">state</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">poststrat</span><span class="op">$</span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">$</span><span class="va">state</span>,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">state</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mrp_files/figure-html/plot-data-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"><img src="mrp_files/figure-html/plot-data-2.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="effect-of-the-post-stratification-variable-on-preference-for-cats">Effect of the post-stratification variable on preference for
cats<a class="anchor" aria-label="anchor" href="#effect-of-the-post-stratification-variable-on-preference-for-cats"></a>
</h2>
<p>Secondly; we consider the evidence of different proportions across
different levels of a post-stratification variable; which we should
consider for each of the post-stratification variables. Here we break
down the proportion of individuals who would prefer a cat
(<em>y-axis</em>) by different levels (<em>x-axis</em>) of the
post-stratification variable (<em>horizontal panels</em>). We can see
from this figure that there appears to be differences in cat preference
for the different levels of post-stratification variables. Given the
previous figure, which suggested that the sample was different to the
population in the share of different levels of theses variables, this
should suggest that using the sample to estimate cat preference may not
give accurate estimates of cat preference in the population.</p>
<p><img src="mrp_files/figure-html/plot-summary-by-poststrat-var-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="interaction-effect">Interaction effect<a class="anchor" aria-label="anchor" href="#interaction-effect"></a>
</h3>
<p>Thirdly, we demonstrate visually that there is an interaction between
age and gender and compare to a case where there is no interaction. Here
a simulated interaction effect between age (<em>x-axis</em>) and gender
(<em>color</em>), right panel, is contrasted with no interaction effect
(<em>left panel</em>). While both panels demonstrate a difference
between the genders on the outcome variable (<em>y-axis</em>), only the
second panel shows this difference changing with the variable on the
x-axis.</p>
<p><img src="mrp_files/figure-html/plot-interaction-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="design-effect">Design effect<a class="anchor" aria-label="anchor" href="#design-effect"></a>
</h3>
<p>Lastly we look at the difference in cat preference between states,
which will form the basis for the multi-level component of our analysis.
Participants were randomly selected from particular states. Plotting the
state (<em>x-axis</em>) against the overall proportion of participants
who prefer cats (<em>y-axis</em>) demonstrates state differences. The
downward slope is because we ordered the x-axis by the proportion of cat
preference for ease of viewing. We also include second plot with a
horizontal line to represent the overall preference for cats in the
total population, according to the sample.</p>
<p><img src="mrp_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="mrp-with-rstanarm">MRP with rstanarm<a class="anchor" aria-label="anchor" href="#mrp-with-rstanarm"></a>
</h2>
<p>From visual inspection, it appears that different levels of
post-stratification variable have different preferences for cats. Our
survey also appears to have sampling bias; indicating that some groups
were over/under sampled relative to the population. The net effect of
this is that we could not make good population level estimates of cat
preference straight from our sample. Our aim is to infer the preference
for cats in the <em>population</em> using the post-stratification
variables to account for systematic differences between the sample and
population. Using rstanarm, this becomes a simple procedure.</p>
<p>The first step is to use a multi-level logistic regression model to
predict preference for cats in the sample given the variables that we
will use to post-stratify. Note that we actually have more rows in the
post-stratification matrix than the we have observed units, so there are
some cells in the poststrat matrix that we don’t observe. We can use a
multi-level model to partially pool information across the different
levels within each variable to assist with this. In the model described
below, we use a fixed intercept for gender, and hierarchically modeled
varying intercepts for each of the other factors.</p>
<p>Let <span class="math inline">\(\theta_{j}\)</span> denote the
preference for cats in the <span class="math inline">\(j\)</span>th
poststratification cell. The non-hierarchical part of the model can be
written as</p>
<p><span class="math display">\[\theta_j=
logit^{-1}(X_{j}\beta),\]</span></p>
<p>where here <span class="math inline">\(X\)</span> only contains an
indicator for male or female and an interaction term with age.</p>
<p>Adding the varying intercepts for the other variables the model
becomes</p>
<p><span class="math display">\[
\theta_j = logit^{-1}(
X_{j}\beta
+ \alpha_{\rm state[j]}^{\rm state}
+ \alpha_{\rm age[j]}^{\rm age}
+ \alpha_{\rm eth[j]}^{\rm eth}
+ \alpha_{\rm inc[j]}^{\rm inc}
)
\]</span> with</p>
<p>$$ <span class="math display">\[\begin{align*}
\alpha_{\rm state[j]}^{\rm state} &amp; \sim N(0,\sigma^{\rm state}) \\
\alpha_{\rm age[j]}^{\rm age} &amp; \sim N(0,\sigma^{\rm age})\\
\alpha_{\rm eth[j]}^{\rm eth} &amp; \sim N(0,\sigma^{\rm eth})\\
\alpha_{\rm inc[j]}^{\rm inc} &amp;\sim N(0,\sigma^{\rm inc}) \\
\end{align*}\]</span></p>
<p>$$</p>
<p>Each of <span class="math inline">\(\sigma^{\rm state}\)</span>,
<span class="math inline">\(\sigma^{\rm age}\)</span>, <span class="math inline">\(\sigma^{\rm eth}\)</span>, and <span class="math inline">\(\sigma^{\rm inc}\)</span> are estimated from the
data (in this case using rstanarm’s default priors), which is beneficial
as it means we share information between the levels of each variable and
we can prevent levels with with less data from being too sensitive to
the few observed values. This also helps with the levels we don’t
observe at all it will use information from the levels that we do
observe. For more on the benefits of this type of model, see <span class="citation">Gelman et al. (2005)</span>, and see <span class="citation">Ghitza and Gelman (2013)</span> and <span class="citation">Si et al. (2017)</span> for more complicated extensions
that involve deep interactions and structured prior distributions.</p>
<p>Here is the model specified using the <code><a href="../reference/stan_glmer.html">stan_glmer()</a></code>
function in rstanarm, which uses the same formula syntax as the
<code><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">glmer()</a></code> function from the lme4 package:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_glmer.html">stan_glmer</a></span><span class="op">(</span></span>
<span>  <span class="va">cat_pref</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">male</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">male</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">age</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">eth</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">income</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">sample</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code>stan_glmer
 family:       binomial [logit]
 formula:      cat_pref ~ factor(male) + factor(male) * factor(age) + (1 | state) + 
       (1 | age) + (1 | eth) + (1 | income)
 observations: 1200
------
                           Median MAD_SD
(Intercept)                 0.8    0.9  
factor(male)1              -0.3    0.6  
factor(age)2               -0.2    1.0  
factor(age)3               -0.5    0.8  
factor(age)4                0.6    0.8  
factor(age)5                0.3    0.8  
factor(age)6                1.1    0.9  
factor(age)7                0.8    0.8  
factor(male)1:factor(age)2  0.3    1.7  
factor(male)1:factor(age)3 -0.8    0.8  
factor(male)1:factor(age)4 -1.3    0.7  
factor(male)1:factor(age)5 -1.0    0.7  
factor(male)1:factor(age)6 -0.6    0.7  
factor(male)1:factor(age)7 -1.1    0.6  

Error terms:
 Groups Name        Std.Dev.
 state  (Intercept) 1.13    
 age    (Intercept) 1.21    
 eth    (Intercept) 0.91    
 income (Intercept) 0.73    
Num. levels: state 50, age 7, eth 3, income 3 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>As a first pass to check whether the model is performing well, note
that there are no warnings about divergences, failure to converge or
tree depth. If these errors do occur, more information on how to
alleviate them is provided <a href="https://mc-stan.org/rstanarm/articles/rstanarm.html#step-3-criticize-the-model">here</a>.</p>
<div class="section level3">
<h3 id="population-estimate">Population Estimate<a class="anchor" aria-label="anchor" href="#population-estimate"></a>
</h3>
<p>From this we get a summary of the baseline log odds of cat preference
at the first element of each factor (i.e., male = 0, age = 1) for each
state, plus estimates on variability of the intercept for state,
ethnicity, age and income. While this is interesting, currently all we
have achieved is a model that predicts cat preference given a number of
factor-type predictors in a sample. What we would like to do is estimate
cat preference in the population by accounting for differences between
our sample and the population. We use the
<code><a href="../reference/posterior_linpred.stanreg.html">posterior_linpred()</a></code> function to obtain posterior estimates
for cat preference given the proportion of people in the
<em>population</em> in each level of the factors included in the
model.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_linpred.stanreg.html">posterior_linpred</a></span><span class="op">(</span><span class="va">fit</span>, transform <span class="op">=</span> <span class="cn">TRUE</span>, newdata <span class="op">=</span> <span class="va">poststrat</span><span class="op">)</span></span>
<span><span class="va">poststrat_prob</span> <span class="op">&lt;-</span> <span class="va">posterior_prob</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">poststrat</span><span class="op">$</span><span class="va">N</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">$</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">model_popn_pref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">poststrat_prob</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">poststrat_prob</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">model_popn_pref</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code> mean    sd 
0.568 0.024 </code></pre>
<p>We can compare this to the estimate we would have made if we had just
used the sample:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_popn_pref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">cat_pref</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sample_popn_pref</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.681</code></pre>
<p>We can also add it to the last figure to graphically represent the
difference between the sample and population estimate.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare2</span> <span class="op">&lt;-</span> <span class="va">compare2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">model_popn_pref</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, colour <span class="op">=</span> <span class="st">'#2ca25f'</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5.2</span>, y <span class="op">=</span> <span class="va">model_popn_pref</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.025</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"MRP"</span>, colour <span class="op">=</span> <span class="st">'#2ca25f'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot_grid.html" class="external-link">bayesplot_grid</a></span><span class="op">(</span><span class="va">compare</span>, <span class="va">compare2</span>, </span>
<span>               grid_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mrp_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>As this is simulated data, we can look directly at the preference for
cats that we simulated from to consider how good our estimate is.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">true_popn_pref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">true_popn</span><span class="op">$</span><span class="va">cat_pref</span> <span class="op">*</span> <span class="va">poststrat</span><span class="op">$</span><span class="va">N</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">$</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">true_popn_pref</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.561</code></pre>
<p>Which we will also add to the figure.
<img src="mrp_files/figure-html/unnamed-chunk-18-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>Our MRP estimate is barely off, while our sample estimate is off by
more than 10 percentage points. This indicates that using MRP helps to
make estimates for the population from our sample that are more
accurate.</p>
</div>
<div class="section level3">
<h3 id="estimates-for-states">Estimates for states<a class="anchor" aria-label="anchor" href="#estimates-for-states"></a>
</h3>
<p>One of the nice benefits of using MRP to make inference about the
population is that we can change the population of interest. In the
previous paragraph we inferred the preference for cats in the whole
population. We can also infer the preference for cats in a single state.
In the following code we post-stratify for each state in turn. Note that
we can reuse the predictive model from the previous step and update for
different population demographics. This is particularly useful for
complicated cases or large data sets where the model takes some time to
fit.</p>
<p>As before, first we use the proportion of the population in each
combination of the post-stratification groups to estimate the proportion
of people who preferred cats in the population, only in this case the
population of interest is the state.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  State <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,</span>
<span>  model_state_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  model_state_pref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  sample_state_pref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  true_state_pref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">$</span><span class="va">state</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">poststrat_state</span> <span class="op">&lt;-</span> <span class="va">poststrat</span><span class="op">[</span><span class="va">poststrat</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="va">i</span>, <span class="op">]</span></span>
<span>    <span class="va">posterior_prob_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_linpred.stanreg.html">posterior_linpred</a></span><span class="op">(</span></span>
<span>    <span class="va">fit</span>,</span>
<span>    transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    draws <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">poststrat_state</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">poststrat_prob_state</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">posterior_prob_state</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">poststrat_state</span><span class="op">$</span><span class="va">N</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">poststrat_state</span><span class="op">$</span><span class="va">N</span><span class="op">)</span></span>
<span>  <span class="co">#This is the estimate for popn in state:</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">model_state_pref</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">poststrat_prob_state</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">model_state_sd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">poststrat_prob_state</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="co">#This is the estimate for sample</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">sample_state_pref</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">cat_pref</span><span class="op">[</span><span class="va">sample</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="co">#And what is the actual popn?</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">true_state_pref</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">true_popn</span><span class="op">$</span><span class="va">cat_pref</span><span class="op">[</span><span class="va">true_popn</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">poststrat_state</span><span class="op">$</span><span class="va">N</span><span class="op">)</span> <span class="op">/</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">poststrat_state</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">N</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">cat_pref</span><span class="op">[</span><span class="va">sample</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">state_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code>   State model_state_pref sample_state_pref true_state_pref  N
1      1           0.5068            0.5000          0.5966  2
2      2           0.6573            0.8571          0.5315  7
3      3           0.4462            0.5385          0.3803 13
4      4           0.7616            0.8846          0.6590 26
5      5           0.4232            0.5200          0.4439 50
6      6           0.6853            0.8947          0.6982 19
7      7           0.7119            0.8250          0.6386 40
8      8           0.6987            0.9167          0.7850 12
9      9           0.7203            0.8571          0.6788 14
10    10           0.6153            0.7727          0.5966 44
11    11           0.7272            0.8824          0.7850 17
12    12           0.3860            0.4737          0.4012 57
13    13           0.7191            1.0000          0.7690  5
14    14           0.6128            0.6818          0.5966 22
15    15           0.2034            0.2000          0.1181 15
16    16           0.3838            0.4706          0.3599 34
17    17           0.2181            0.1538          0.2169 13
18    18           0.3444            0.0000          0.2169  2
19    19           0.4733            0.6000          0.4656  5
20    20           0.7992            0.8974          0.7850 39
21    21           0.3825            0.5250          0.3599 40
22    22           0.7661            0.9167          0.8755 12
23    23           0.6042            0.7333          0.5751 30
24    24           0.6389            1.0000          0.7690  2
25    25           0.7445            0.8261          0.8002 23
26    26           0.7605            0.8704          0.7524 54
27    27           0.2621            0.3500          0.2657 20
28    28           0.5807            0.6667          0.4656  3
29    29           0.5356            0.6757          0.5095 37
30    30           0.5152            0.5946          0.5315 37
31    31           0.6151            0.7143          0.7350  7
32    32           0.4203            0.5000          0.3399 42
33    33           0.6095            0.7353          0.6178 68
34    34           0.5805            0.7200          0.4656 25
35    35           0.5904            0.7200          0.6590 25
36    36           0.5317            0.6250          0.5751  8
37    37           0.6940            0.8571          0.8855  7
38    38           0.2926            0.3750          0.3205 48
39    39           0.7196            0.8824          0.8533 17
40    40           0.3245            0.3684          0.2657 19
41    41           0.7710            0.9286          0.6982 14
42    42           0.6794            0.8235          0.5751 34
43    43           0.5300            0.6667          0.5315  6
44    44           0.6567            0.8000          0.4439 15
45    45           0.6612            0.8077          0.5315 26
46    46           0.6541            0.7750          0.6788 40
47    47           0.7236            0.8621          0.8002 29
48    48           0.5144            0.6545          0.4224 55
49    49           0.2334            0.2500          0.2487  8
50    50           0.8228            1.0000          0.8146 13</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_df</span><span class="op">$</span><span class="va">State</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">state_df</span><span class="op">$</span><span class="va">State</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">state</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here we similar findings to when we considered the population as
whole. While estimates for cat preference (in percent) using the sample
are off by</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">state_df</span><span class="op">$</span><span class="va">sample_state_pref</span><span class="op">-</span><span class="va">state_df</span><span class="op">$</span><span class="va">true_state_pref</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">state_df</span><span class="op">$</span><span class="va">sample_state_pref</span><span class="op">-</span><span class="va">state_df</span><span class="op">$</span><span class="va">true_state_pref</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>mean  max 
  14   36 </code></pre>
<p>the MRP based estimates are much closer to the actual percentage,</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">state_df</span><span class="op">$</span><span class="va">model_state_pref</span><span class="op">-</span><span class="va">state_df</span><span class="op">$</span><span class="va">true_state_pref</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">state_df</span><span class="op">$</span><span class="va">model_state_pref</span><span class="op">-</span><span class="va">state_df</span><span class="op">$</span><span class="va">true_state_pref</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>mean  max 
   6   21 </code></pre>
<p>and especially when the sample size for that population is relatively
small. This is easier to see graphically, so we will continue to add
additional layers to the previous figure. Here we add model
estimates,represented by triangles, and the true population cat
preference, represented as transparent circles.</p>
<p><img src="mrp_files/figure-html/unnamed-chunk-22-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="other-formats">Other formats<a class="anchor" aria-label="anchor" href="#other-formats"></a>
</h2>
<div class="section level3">
<h3 id="alternate-methods-of-modelling">Alternate methods of modelling<a class="anchor" aria-label="anchor" href="#alternate-methods-of-modelling"></a>
</h3>
<p>Previously we used a binary outcome variable. An alternative form of
this model is to aggregate the data to the poststrat cell level and
model the number of successes (or endorsement of cat preference in this
case) out of the total number of people in that cell. To do this we need
to create two n x 1 outcome variables, <code>N_cat_pref</code> (number
in cell who prefer cats) and <code>N</code> (number in the poststrat
cell).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># not evaluated to avoid dependency on tidyverse</span></span>
<span><span class="va">sample_alt</span> <span class="op">&lt;-</span> <span class="va">sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">male</span>, <span class="va">age</span>, <span class="va">income</span>, <span class="va">state</span>, <span class="va">eth</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>N_cat_pref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cat_pref</span><span class="op">)</span>, N <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<!-- ```{r, include=FALSE, eval=FALSE} -->
<!-- # not evaluated to avoid dependency on tidyverse -->
<!-- sample_alt <- sample %>% -->
<!--   group_by(male, age, income, state, eth) %>% -->
<!--   summarise(N_cat_pref = sum(cat_pref), N = n()) %>% -->
<!--   ungroup() -->
<!-- save(sample_alt, file = "mrp-files/sample_alt.rda", version = 2) -->
<!-- ``` -->
<p>We then can use these two outcome variables to model the data using
the binomial distribution.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_glmer.html">stan_glmer</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">N_cat_pref</span>, <span class="va">N</span> <span class="op">-</span> <span class="va">N_cat_pref</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">male</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">male</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">age</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">eth</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">income</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">sample_alt</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
<pre><code>stan_glmer
 family:       binomial [logit]
 formula:      cbind(N_cat_pref, N - N_cat_pref) ~ factor(male) + factor(male) * 
       factor(age) + (1 | state) + (1 | age) + (1 | eth) + (1 | 
       income)
 observations: 940
------
                           Median MAD_SD
(Intercept)                 0.8    1.0  
factor(male)1              -0.4    0.6  
factor(age)2               -0.3    1.1  
factor(age)3               -0.5    0.9  
factor(age)4                0.6    0.9  
factor(age)5                0.3    0.8  
factor(age)6                1.0    0.9  
factor(age)7                0.8    0.9  
factor(male)1:factor(age)2  0.3    1.8  
factor(male)1:factor(age)3 -0.8    0.8  
factor(male)1:factor(age)4 -1.3    0.7  
factor(male)1:factor(age)5 -1.0    0.7  
factor(male)1:factor(age)6 -0.5    0.7  
factor(male)1:factor(age)7 -1.1    0.6  

Error terms:
 Groups Name        Std.Dev.
 state  (Intercept) 1.11    
 age    (Intercept) 1.22    
 eth    (Intercept) 0.92    
 income (Intercept) 0.73    
Num. levels: state 50, age 7, eth 3, income 3 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>Like before, we can use the <code><a href="../reference/posterior_linpred.stanreg.html">posterior_linpred()</a></code> function
to obtain an estimate of the preference for cats in the population.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior_prob_alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_linpred.stanreg.html">posterior_linpred</a></span><span class="op">(</span><span class="va">fit2</span>, transform <span class="op">=</span> <span class="cn">TRUE</span>, newdata <span class="op">=</span> <span class="va">poststrat</span><span class="op">)</span></span>
<span><span class="va">poststrat_prob_alt</span> <span class="op">&lt;-</span> <span class="va">posterior_prob_alt</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">poststrat</span><span class="op">$</span><span class="va">N</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">$</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">model_popn_pref_alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">poststrat_prob_alt</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">poststrat_prob_alt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">model_popn_pref_alt</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code> mean    sd 
0.568 0.024 </code></pre>
<p>As we should, we get the same answer as when we fit the model using
the binary outcome. The two ways are equivalent, so we can use whichever
form is most convenient for the data at hand. More details on these two
forms of binomial models are available <a href="https://mc-stan.org/rstanarm/articles/binomial.html">here</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level4">
<h4 id="examples-of-other-formulas">Examples of other formulas<a class="anchor" aria-label="anchor" href="#examples-of-other-formulas"></a>
</h4>
<p>The formulas for fitting so-called “mixed-effects” models in
<strong>rstanarm</strong> are the same as those in the
<strong>lme4</strong> package. A table of examples can be found in Table
2 of the vignette for the <strong>lme4</strong> package, available <a href="https://CRAN.R-project.org/package=lme4/vignettes/lmer.pdf" class="external-link">here</a>.</p>
</div>
<div class="section level4">
<h4 id="code-to-simulate-the-data">Code to simulate the data<a class="anchor" aria-label="anchor" href="#code-to-simulate-the-data"></a>
</h4>
<p>Here is the source code for the <code>simulate_mrp_function()</code>,
which is based off of some code provided by Aki Vehtari.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">simulate_mrp_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="kw">function</span> <span class="op">(</span><span class="va">n</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>    <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">3</span>, <span class="fl">50</span><span class="op">)</span></span>
<span>    <span class="va">poststrat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"eth"</span>, <span class="st">"age"</span>, <span class="st">"income"</span>, </span>
<span>        <span class="st">"state"</span>, <span class="st">"N"</span><span class="op">)</span></span>
<span>    <span class="va">count</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i1</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i2</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw">for</span> <span class="op">(</span><span class="va">i3</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="kw">for</span> <span class="op">(</span><span class="va">i4</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="kw">for</span> <span class="op">(</span><span class="va">i5</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="va">count</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>                    <span class="va">poststrat</span><span class="op">[</span><span class="va">count</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">i1</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">i2</span>, <span class="va">i3</span>, </span>
<span>                      <span class="va">i4</span>, <span class="va">i5</span><span class="op">)</span></span>
<span>                  <span class="op">}</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">p_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.52</span>, <span class="fl">0.48</span><span class="op">)</span></span>
<span>    <span class="va">p_eth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span>    <span class="va">p_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span>    <span class="va">p_income</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.35</span>, <span class="fl">0.15</span><span class="op">)</span></span>
<span>    <span class="va">p_state_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="va">p_state</span> <span class="op">&lt;-</span> <span class="va">p_state_tmp</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p_state_tmp</span><span class="op">)</span></span>
<span>    <span class="va">poststrat</span><span class="op">$</span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">poststrat</span><span class="op">$</span><span class="va">N</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">2.5e+08</span> <span class="op">*</span> <span class="va">p_male</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_eth</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, <span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_age</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_income</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, <span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_state</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">p_response_baseline</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span>    <span class="va">p_response_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">/</span><span class="fl">2.8</span></span>
<span>    <span class="va">p_response_eth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.2</span>, <span class="fl">2.5</span><span class="op">)</span><span class="op">/</span><span class="fl">4.7</span></span>
<span>    <span class="va">p_response_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.4</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">/</span><span class="fl">18.9</span></span>
<span>    <span class="va">p_response_inc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.9</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">/</span><span class="fl">2.7</span></span>
<span>    <span class="va">p_response_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">p_response_state</span> <span class="op">&lt;-</span> <span class="va">p_response_state</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p_response_state</span><span class="op">)</span></span>
<span>    <span class="va">p_response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">p_response</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_response_baseline</span> <span class="op">*</span> <span class="va">p_response_male</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_response_eth</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, <span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_response_age</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_response_inc</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, <span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_response_state</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">5</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">people</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">poststrat</span><span class="op">$</span><span class="va">N</span> <span class="op">*</span> </span>
<span>        <span class="va">p_response</span><span class="op">)</span></span>
<span>    <span class="va">n_cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">n_cell</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">people</span> <span class="op">==</span> <span class="va">j</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">coef_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.3</span><span class="op">)</span></span>
<span>    <span class="va">coef_eth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span><span class="op">)</span></span>
<span>    <span class="va">coef_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span><span class="op">)</span></span>
<span>    <span class="va">coef_income</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span>    <span class="va">coef_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">49</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">coef_age_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.23</span>, <span class="fl">0.3</span>, <span class="fl">0.43</span>, <span class="fl">0.5</span>, </span>
<span>        <span class="fl">0.6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="op">-</span><span class="fl">0.23</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.43</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">true_popn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, cat_pref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">true_popn</span><span class="op">$</span><span class="va">cat_pref</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">coef_male</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">coef_eth</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, <span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">coef_age</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">coef_income</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, <span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">coef_state</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">coef_age_male</span><span class="op">[</span><span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">poststrat</span><span class="op">[</span><span class="va">j</span>, </span>
<span>            <span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="va">true_popn</span><span class="op">$</span><span class="va">cat_pref</span><span class="op">[</span><span class="va">people</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">male</span> <span class="op">&lt;-</span> <span class="va">poststrat</span><span class="op">[</span><span class="va">people</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">eth</span> <span class="op">&lt;-</span> <span class="va">poststrat</span><span class="op">[</span><span class="va">people</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">age</span> <span class="op">&lt;-</span> <span class="va">poststrat</span><span class="op">[</span><span class="va">people</span>, <span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">income</span> <span class="op">&lt;-</span> <span class="va">poststrat</span><span class="op">[</span><span class="va">people</span>, <span class="fl">4</span><span class="op">]</span></span>
<span>    <span class="va">state</span> <span class="op">&lt;-</span> <span class="va">poststrat</span><span class="op">[</span><span class="va">people</span>, <span class="fl">5</span><span class="op">]</span></span>
<span>    <span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cat_pref <span class="op">=</span> <span class="va">y</span>, <span class="va">male</span>, <span class="va">age</span>, <span class="va">eth</span>, <span class="va">income</span>, </span>
<span>        <span class="va">state</span>, id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">people</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">poststrat</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">poststrat</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">true_popn</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">true_popn</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">true_popn</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">sample</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sample</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>, poststrat <span class="op">=</span> <span class="va">poststrat</span>, true_popn <span class="op">=</span> <span class="va">true_popn</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<!-- mrp.bib specified at the top -->
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-gelman2005analysis" class="csl-entry">
Gelman, Andrew et al. 2005. <span>“Analysis of Variance-Why It Is More
Important Than Ever.”</span> <em>The Annals of Statistics</em> 33 (1):
1–53.
</div>
<div id="ref-ghitza2013deep" class="csl-entry">
Ghitza, Yair, and Andrew Gelman. 2013. <span>“Deep Interactions with
MRP: Election Turnout and Voting Patterns Among Small Electoral
Subgroups.”</span> <em>American Journal of Political Science</em> 57
(3): 762–76.
</div>
<div id="ref-lax2009should" class="csl-entry">
Lax, Jeffrey R, and Justin H Phillips. 2009. <span>“How Should We
Estimate Public Opinion in the States?”</span> <em>American Journal of
Political Science</em> 53 (1): 107–21.
</div>
<div id="ref-lei20172008" class="csl-entry">
Lei, Rayleigh, Andrew Gelman, and Yair Ghitza. 2017. <span>“The 2008
Election: A Preregistered Replication Analysis.”</span> <em>Statistics
and Public Policy</em>, 1–8.
</div>
<div id="ref-little1993post" class="csl-entry">
Little, Roderick JA. 1993. <span>“Post-Stratification: A Modeler’s
Perspective.”</span> <em>Journal of the American Statistical
Association</em> 88 (423): 1001–12.
</div>
<div id="ref-park2004bayesian" class="csl-entry">
Park, David K, Andrew Gelman, and Joseph Bafumi. 2004. <span>“Bayesian
Multilevel Estimation with Poststratification: State-Level Estimates
from National Polls.”</span> <em>Political Analysis</em> 12 (4): 375–85.
</div>
<div id="ref-shirley2015hierarchical" class="csl-entry">
Shirley, Kenneth E, and Andrew Gelman. 2015. <span>“Hierarchical Models
for Estimating State and Demographic Trends in US Death Penalty Public
Opinion.”</span> <em>Journal of the Royal Statistical Society: Series A
(Statistics in Society)</em> 178 (1): 1–28.
</div>
<div id="ref-si2017bayesian" class="csl-entry">
Si, Yajuan, Rob Trangucci, Jonah Sol Gabry, and Andrew Gelman. 2017.
<span>“Bayesian Hierarchical Weighting Adjustment and Survey
Inference.”</span> <em>arXiv Preprint arXiv:1707.08220</em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
