<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating Generalized Linear Models for Continuous Data with rstanarm • rstanarm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Generalized Linear Models for Continuous Data with rstanarm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages">
<li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Estimating Generalized Linear Models for Continuous Data with rstanarm</h1>
                        <h4 data-toc-skip class="author">Jonah Gabry and
Ben Goodrich</h4>
            
            <h4 data-toc-skip class="date">2025-12-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/New-pkgdown-theme/vignettes/continuous.Rmd" class="external-link"><code>vignettes/continuous.Rmd</code></a></small>
      <div class="d-none name"><code>continuous.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{stan_glm: GLMs for Continuous Data}
-->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/theme_default.html" class="external-link">theme_default</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette explains how to estimate linear and generalized linear
models (GLMs) for continuous response variables using the
<code>stan_glm</code> function in the <strong>rstanarm</strong> package.
For GLMs for discrete outcomes see the vignettes for <a href="binomial.html">binary/binomial</a> and <a href="count.html">count</a> outcomes.</p>
<p>The four steps of a Bayesian analysis are</p>
<ol style="list-style-type: decimal">
<li>Specify a joint distribution for the outcome(s) and all the
unknowns, which typically takes the form of a marginal prior
distribution for the unknowns multiplied by a likelihood for the
outcome(s) conditional on the unknowns. This joint distribution is
proportional to a posterior distribution of the unknowns conditional on
the observed data</li>
<li>Draw from posterior distribution using Markov Chain Monte Carlo
(MCMC).</li>
<li>Evaluate how well the model fits the data and possibly revise the
model.</li>
<li>Draw from the posterior predictive distribution of the outcome(s)
given interesting values of the predictors in order to visualize how a
manipulation of a predictor affects (a function of) the outcome(s).</li>
</ol>
<p>This vignette primarily focuses on Steps 1 and 2 when the likelihood
is the product of conditionally independent continuous distributions.
Steps 3 and 4 are covered in more depth by the vignette entitled <a href="rstanarm.html">“How to Use the <strong>rstanarm</strong>
Package”</a>, although this vignette does also give a few examples of
model checking and generating predictions.</p>
</div>
<div class="section level2">
<h2 id="likelihood">Likelihood<a class="anchor" aria-label="anchor" href="#likelihood"></a>
</h2>
<p>In the simplest case a GLM for a continuous outcome is simply a
linear model and the likelihood for one observation is a conditionally
normal PDF <span class="math display">\[\frac{1}{\sigma \sqrt{2 \pi}}
e^{-\frac{1}{2}
\left(\frac{y - \mu}{\sigma}\right)^2},\]</span> where <span class="math inline">\(\mu = \alpha + \mathbf{x}^\top
\boldsymbol{\beta}\)</span> is a linear predictor and <span class="math inline">\(\sigma\)</span> is the standard deviation of the
error in predicting the outcome, <span class="math inline">\(y\)</span>.</p>
<p>More generally, a linear predictor <span class="math inline">\(\eta =
\alpha + \mathbf{x}^\top
\boldsymbol{\beta}\)</span> can be related to the conditional mean of
the outcome via a link function <span class="math inline">\(g\)</span>
that serves as a map between the range of values on which the outcome is
defined and the space on which the linear predictor is defined. For the
linear model described above no transformation is needed and so the link
function is taken to be the identity function. However, there are cases
in which a link function is used for Gaussian models; the log link, for
example, can be used to log transform the (conditional) expected value
of the outcome when it is constrained to be positive.</p>
<p>Like the <code>glm</code> function, the <code>stan_glm</code>
function uses R’s family objects. The family objects for continuous
outcomes compatible with <code>stan_glm</code> are the
<code>gaussian</code>, <code>Gamma</code>, and
<code>inverse.gaussian</code> distributions. All of the link functions
provided by these family objects are also compatible with
<code>stan_glm</code>. For example, for a Gamma GLM, where we assume
that observations are conditionally independent Gamma random variables,
common link functions are the log and inverse links.</p>
<p>Regardless of the distribution and link function, the likelihood for
the entire sample is the product of the likelihood contributions of the
individual observations.</p>
</div>
<div class="section level2">
<h2 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h2>
<p>A full Bayesian analysis requires specifying prior distributions
<span class="math inline">\(f(\alpha)\)</span> and <span class="math inline">\(f(\boldsymbol{\beta})\)</span> for the intercept
and vector of regression coefficients. When using <code>stan_glm</code>,
these distributions can be set using the <code>prior_intercept</code>
and <code>prior</code> arguments. The <code>stan_glm</code> function
supports a variety of prior distributions, which are explained in the
<strong>rstanarm</strong> documentation
(<code><a href="../reference/priors.html">help(priors, package = 'rstanarm')</a></code>).</p>
<p>As an example, suppose we have <span class="math inline">\(K\)</span>
predictors and believe — prior to seeing the data — that <span class="math inline">\(\alpha, \beta_1, \dots, \beta_K\)</span> are as
likely to be positive as they are to be negative, but are highly
unlikely to be far from zero. These beliefs can be represented by normal
distributions with mean zero and a small scale (standard deviation). To
give <span class="math inline">\(\alpha\)</span> and each of the <span class="math inline">\(\beta\)</span>s this prior (with a scale of 1,
say), in the call to <code>stan_glm</code> we would include the
arguments <code>prior_intercept = normal(0,1)</code> and
<code>prior = normal(0,1)</code>.</p>
<p>If, on the other hand, we have less a priori confidence that the
parameters will be close to zero then we could use a larger scale for
the normal distribution and/or a distribution with heavier tails than
the normal like the Student t distribution. <strong>Step 1</strong> in
the “How to Use the <strong>rstanarm</strong> Package” vignette
discusses one such example.</p>
</div>
<div class="section level2">
<h2 id="posterior">Posterior<a class="anchor" aria-label="anchor" href="#posterior"></a>
</h2>
<p>With independent prior distributions, the joint posterior
distribution for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\boldsymbol{\beta}\)</span> is proportional to the
product of the priors and the <span class="math inline">\(N\)</span>
likelihood contributions:</p>
<p><span class="math display">\[f\left(\boldsymbol{\beta} |
\mathbf{y},\mathbf{X}\right) \propto
  f\left(\alpha\right) \times \prod_{k=1}^K f\left(\beta_k\right) \times
  \prod_{i=1}^N {f(y_i|\eta_i)},\]</span></p>
<p>where <span class="math inline">\(\mathbf{X}\)</span> is the matrix
of predictors and <span class="math inline">\(\eta\)</span> the linear
predictor. This is the posterior distribution that <code>stan_glm</code>
will draw from when using MCMC.</p>
</div>
<div class="section level2">
<h2 id="linear-regression-example">Linear Regression Example<a class="anchor" aria-label="anchor" href="#linear-regression-example"></a>
</h2>
<p>The <code>stan_lm</code> function, which has its own <a href="lm.html">vignette</a>, fits regularized linear models using a
novel means of specifying priors for the regression coefficients. Here
we focus using the <code>stan_glm</code> function, which can be used to
estimate linear models with independent priors on the regression
coefficients.</p>
<p>To illustrate the usage of <code>stan_glm</code> and some of the
post-processing functions in the <strong>rstanarm</strong> package we’ll
use a simple example from Chapter 3 of <a href="https://sites.stat.columbia.edu/gelman/arm/" class="external-link">Gelman and Hill
(2007)</a>:</p>
<blockquote>
<p>We shall fit a series of regressions predicting cognitive test scores
of three- and four-year-old children given characteristics of their
mothers, using data from a survey of adult American women and their
children (a subsample from the National Longitudinal Survey of
Youth).</p>
</blockquote>
<p>Using two predictors – a binary indicator for whether the mother has
a high-school degree (<code>mom_hs</code>) and the mother’s score on an
IQ test (<code>mom_iq</code>) – we will fit four contending models. The
first two models will each use just one of the predictors, the third
will use both, and the fourth will also include a term for the
interaction of the two predictors.</p>
<p>For these models we’ll use the default weakly informative priors for
<code>stan_glm</code>, which are currently set to
<code>normal(0,10)</code> for the intercept and <code>normal(0,5)</code>
for the other regression coefficients. For an overview of the many other
available prior distributions see
<code>help("prior", package = "rstanarm")</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">kidiq</span><span class="op">)</span></span>
<span><span class="va">post1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_glm.html">stan_glm</a></span><span class="op">(</span><span class="va">kid_score</span> <span class="op">~</span> <span class="va">mom_hs</span>, data <span class="op">=</span> <span class="va">kidiq</span>, </span>
<span>                  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>, </span>
<span>                  seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">post2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">post1</span>, formula <span class="op">=</span> <span class="va">.</span> <span class="op">~</span> <span class="va">mom_iq</span><span class="op">)</span></span>
<span><span class="va">post3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">post1</span>, formula <span class="op">=</span> <span class="va">.</span> <span class="op">~</span> <span class="va">mom_hs</span> <span class="op">+</span> <span class="va">mom_iq</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">post4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">post1</span>, formula <span class="op">=</span> <span class="va">.</span> <span class="op">~</span> <span class="va">mom_hs</span> <span class="op">*</span> <span class="va">mom_iq</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>stan_glm
 family:       gaussian [identity]
 formula:      kid_score ~ mom_hs + mom_iq + mom_hs:mom_iq
 observations: 434
 predictors:   4
------
              Median MAD_SD
(Intercept)   -10.1   13.7 
mom_hs         49.5   15.3 
mom_iq          1.0    0.1 
mom_hs:mom_iq  -0.5    0.2 

Auxiliary parameter(s):
      Median MAD_SD
sigma 18.0    0.6  

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>Following Gelman and Hill’s example, we make some plots overlaying
the estimated regression lines on the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">kidiq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mom_hs</span>, y <span class="op">=</span> <span class="va">kid_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.05</span>, width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No HS"</span>, <span class="st">"HS"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">base</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">post1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">post1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                   color <span class="op">=</span> <span class="st">"skyblue4"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot1a-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>There several ways we could add the uncertainty in our estimates to
the plot. One way is to also plot the estimated regression line at each
draw from the posterior distribution. To do this we can extract the
posterior draws from the fitted model object using the
<code>as.matrix</code> or <code>as.data.frame</code> methods:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">post1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">a</span>, slope <span class="op">=</span> <span class="va">b</span><span class="op">)</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"skyblue"</span>, size <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">post1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">post1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"skyblue4"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot1b-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>For the second model we can make the same plot but the x-axis will
show the continuous predictor <code>mom_iq</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">post2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">kidiq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mom_iq</span>, y <span class="op">=</span> <span class="va">kid_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">a</span>, slope <span class="op">=</span> <span class="va">b</span><span class="op">)</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"skyblue"</span>, size <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">post2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">post2</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"skyblue4"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot2-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>For the third and fourth models, each of which uses both predictors,
we can plot the continuous <code>mom_iq</code> on the x-axis and use
color to indicate which points correspond to the different
subpopulations defined by <code>mom_hs</code>. We also now plot two
regression lines, one for each subpopulation:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">ests</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">ests</span> </span>
<span><span class="va">reg1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">ests</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">ests</span></span>
<span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">post3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">kidiq</span><span class="op">$</span><span class="va">clr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">kidiq</span><span class="op">$</span><span class="va">mom_hs</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No HS"</span>, <span class="st">"HS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lgnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">base2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">kidiq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mom_iq</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="va">clr</span>, ref <span class="op">=</span> <span class="st">"HS"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">kid_score</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, stroke <span class="op">=</span> <span class="fl">.2</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">lgnd</span>, fill <span class="op">=</span> <span class="va">lgnd</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span><span class="va">base2</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">reg0</span>, args <span class="op">=</span> <span class="va">args</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"No HS"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">reg1</span>, args <span class="op">=</span> <span class="va">args</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"HS"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot3-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">ests</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">x</span>, <span class="fl">0</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">ests</span> </span>
<span><span class="va">reg1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">ests</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">x</span>, <span class="fl">1</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">ests</span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">post4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">base2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">reg0</span>, args <span class="op">=</span> <span class="va">args</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"No HS"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">reg1</span>, args <span class="op">=</span> <span class="va">args</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"HS"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot4-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="model-comparison">Model comparison<a class="anchor" aria-label="anchor" href="#model-comparison"></a>
</h3>
<p>One way we can compare the four contending models is to use an
approximation to Leave-One-Out (LOO) cross-validation, which is
implemented by the <code>loo</code> function in the <strong>loo</strong>
package:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare them with loo</span></span>
<span><span class="va">loo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span><span class="op">(</span><span class="va">post1</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">loo2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span><span class="op">(</span><span class="va">post2</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">loo3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span><span class="op">(</span><span class="va">post3</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">loo4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span><span class="op">(</span><span class="va">post4</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span><span class="op">(</span><span class="va">loo1</span>, <span class="va">loo2</span>, <span class="va">loo3</span>, <span class="va">loo4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>      elpd_diff se_diff
post4   0.0       0.0  
post3  -3.5       2.7  
post2  -6.2       4.1  
post1 -42.4       8.7  </code></pre>
<p>In this case the fourth model is preferred as it has the highest
expected log predicted density (<code>elpd_loo</code>) or, equivalently,
the lowest value of the LOO Information Criterion (<code>looic</code>).
The fourth model is preferred by a lot over the first model</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span><span class="op">(</span><span class="va">loo1</span>, <span class="va">loo4</span><span class="op">)</span></span></code></pre></div>
<pre><code>      elpd_diff se_diff
post4   0.0       0.0  
post1 -42.4       8.7  </code></pre>
<p>because the difference in <code>elpd</code> is so much larger than
the standard error. However, the preference of the fourth model over the
others isn’t as strong:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span><span class="op">(</span><span class="va">loo3</span>, <span class="va">loo4</span><span class="op">)</span></span></code></pre></div>
<pre><code>      elpd_diff se_diff
post4  0.0       0.0   
post3 -3.5       2.7   </code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span><span class="op">(</span><span class="va">loo2</span>, <span class="va">loo4</span><span class="op">)</span></span></code></pre></div>
<pre><code>      elpd_diff se_diff
post4  0.0       0.0   
post2 -6.2       4.1   </code></pre>
</div>
<div class="section level3">
<h3 id="the-posterior-predictive-distribution">The posterior predictive distribution<a class="anchor" aria-label="anchor" href="#the-posterior-predictive-distribution"></a>
</h3>
<p>The posterior predictive distribution is the distribution of the
outcome implied by the model after using the observed data to update our
beliefs about the unknown parameters. When simulating observations from
the posterior predictive distribution we use the notation <span class="math inline">\(y^{\rm rep}\)</span> (for <em>replicate</em>) when
we use the same observations of <span class="math inline">\(X\)</span>
that were used to estimate the model parameters. When <span class="math inline">\(X\)</span> contains new observations we use the
notation <span class="math inline">\(\tilde{y}\)</span> to refer to the
posterior predictive simulations.</p>
<p>Simulating data from the posterior predictive distribution using the
observed predictors is useful for checking the fit of the model. Drawing
from the posterior predictive distribution at interesting values of the
predictors also lets us visualize how a manipulation of a predictor
affects (a function of) the outcome(s).</p>
<div class="section level4">
<h4 id="graphical-posterior-predictive-checks">Graphical posterior predictive checks<a class="anchor" aria-label="anchor" href="#graphical-posterior-predictive-checks"></a>
</h4>
<p>The <code>pp_check</code> function generates a variety of plots
comparing the observed outcome <span class="math inline">\(y\)</span> to
simulated datasets <span class="math inline">\(y^{\rm rep}\)</span> from
the posterior predictive distribution using the same observations of the
predictors <span class="math inline">\(X\)</span> as we used to fit the
model. He we show a few of the possible displays. The documentation at
<code><a href="../reference/pp_check.stanreg.html">help("pp_check.stanreg", package = "rstanarm")</a></code> has details
on all of the <code>pp_check</code> options.</p>
<p>First we’ll look at a plot directly comparing the distributions of
<span class="math inline">\(y\)</span> and <span class="math inline">\(y^{\rm rep}\)</span>. The following call to
<code>pp_check</code> will create a plot juxtaposing the histogram of
<span class="math inline">\(y\)</span> and histograms of five <span class="math inline">\(y^{\rm rep}\)</span> datasets:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.stanreg.html">pp_check</a></span><span class="op">(</span><span class="va">post4</span>, plotfun <span class="op">=</span> <span class="st">"hist"</span>, nreps <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-pp_check1-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>The idea is that if the model is a good fit to the data we should be
able to generate data <span class="math inline">\(y^{\rm rep}\)</span>
from the posterior predictive distribution that looks a lot like the
observed data <span class="math inline">\(y\)</span>. That is, given
<span class="math inline">\(y\)</span>, the <span class="math inline">\(y^{\rm
rep}\)</span> we generate should be plausible.</p>
<p>Another useful plot we can make using <code>pp_check</code> shows the
distribution of a test quantity <span class="math inline">\(T(y^{\rm
rep})\)</span> compared to <span class="math inline">\(T(y)\)</span>,
the value of the quantity in the observed data. When the argument
<code>plotfun = "stat"</code> is specified, <code>pp_check</code> will
simulate <span class="math inline">\(S\)</span> datasets <span class="math inline">\(y_1^{\rm rep}, \dots, y_S^{\rm rep}\)</span>, each
containing <span class="math inline">\(N\)</span> observations. Here
<span class="math inline">\(S\)</span> is the size of the posterior
sample (the number of MCMC draws from the posterior distribution of the
model parameters) and <span class="math inline">\(N\)</span> is the
length of <span class="math inline">\(y\)</span>. We can then check if
<span class="math inline">\(T(y)\)</span> is consistent with the
distribution of <span class="math inline">\(\left(T(y_1^{\rm yep}),
\dots, T(y_S^{\rm yep})\right)\)</span>. In the plot below we see that
the mean of the observations is plausible when compared to the
distribution of the means of the <span class="math inline">\(S\)</span>
<span class="math inline">\(y^{\rm rep}\)</span> datasets:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.stanreg.html">pp_check</a></span><span class="op">(</span><span class="va">post4</span>, plotfun <span class="op">=</span> <span class="st">"stat"</span>, stat <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-pp_check2-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
<p>Using <code>plotfun="stat_2d"</code> we can also specify two test
quantities and look at a scatterplot:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.stanreg.html">pp_check</a></span><span class="op">(</span><span class="va">post4</span>, plotfun <span class="op">=</span> <span class="st">"stat_2d"</span>, stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-pp_check3-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="generating-predictions">Generating predictions<a class="anchor" aria-label="anchor" href="#generating-predictions"></a>
</h4>
<p>The <code>posterior_predict</code> function is used to generate
replicated data <span class="math inline">\(y^{\rm
rep}\)</span> or predictions for future observations <span class="math inline">\(\tilde{y}\)</span>. Here we show how to use
<code>posterior_predict</code> to generate predictions of the outcome
<code>kid_score</code> for a range of different values of
<code>mom_iq</code> and for both subpopulations defined by
<code>mom_hs</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IQ_SEQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">75</span>, to <span class="op">=</span> <span class="fl">135</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">y_nohs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_predict.stanreg.html">posterior_predict</a></span><span class="op">(</span><span class="va">post4</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mom_hs <span class="op">=</span> <span class="fl">0</span>, mom_iq <span class="op">=</span> <span class="va">IQ_SEQ</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y_hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_predict.stanreg.html">posterior_predict</a></span><span class="op">(</span><span class="va">post4</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mom_hs <span class="op">=</span> <span class="fl">1</span>, mom_iq <span class="op">=</span> <span class="va">IQ_SEQ</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">y_hs</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 4000   13</code></pre>
<p>We now have two matrices, <code>y_nohs</code> and <code>y_hs</code>.
Each matrix has as many columns as there are values of
<code>IQ_SEQ</code> and as many rows as the size of the posterior
sample. One way to show the predictors is to plot the predictions for
the two groups of kids side by side:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">y_hs</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, outline <span class="op">=</span> <span class="cn">FALSE</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">170</span><span class="op">)</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Mom IQ"</span>, ylab <span class="op">=</span> <span class="st">"Predicted Kid IQ"</span>, main <span class="op">=</span> <span class="st">"Mom HS"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y_hs</span><span class="op">)</span>, labels <span class="op">=</span> <span class="va">IQ_SEQ</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">y_nohs</span>, outline <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"red"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">170</span><span class="op">)</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Mom IQ"</span>, ylab <span class="op">=</span> <span class="cn">NULL</span>, main <span class="op">=</span> <span class="st">"Mom No HS"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y_hs</span><span class="op">)</span>, labels <span class="op">=</span> <span class="va">IQ_SEQ</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot-predict-1.png" class="r-plt" width="60%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="gamma-regression-example">Gamma Regression Example<a class="anchor" aria-label="anchor" href="#gamma-regression-example"></a>
</h2>
<p>Gamma regression is often used when the response variable is
continuous and positive, and the <em>coefficient of variation</em>
(rather than the variance) is constant.</p>
<p>We’ll use one of the standard examples of Gamma regression, which is
taken from McCullagh &amp; Nelder (1989). This example is also given in
the documentation for R’s <code>glm</code> function. The outcome of
interest is the clotting time of blood (in seconds) for “normal plasma
diluted to nine different percentage concentrations with
prothrombin-free plasma; clotting was induced by two lots of
thromboplastin” (p. 300).</p>
<p>The help page for R’s <code>glm</code> function presents the example
as follows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clotting</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">60</span>,<span class="fl">80</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>    lot1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">118</span>,<span class="fl">58</span>,<span class="fl">42</span>,<span class="fl">35</span>,<span class="fl">27</span>,<span class="fl">25</span>,<span class="fl">21</span>,<span class="fl">19</span>,<span class="fl">18</span><span class="op">)</span>,</span>
<span>    lot2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">69</span>,<span class="fl">35</span>,<span class="fl">26</span>,<span class="fl">21</span>,<span class="fl">18</span>,<span class="fl">16</span>,<span class="fl">13</span>,<span class="fl">12</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">lot1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">clotting</span>, family <span class="op">=</span> <span class="va">Gamma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">lot2</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">clotting</span>, family <span class="op">=</span> <span class="va">Gamma</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To fit the analogous Bayesian models we can simply substitute
<code>stan_glm</code> for <code>glm</code> above. However, instead of
fitting separate models we can also reshape the data slightly and fit a
model interacting lot with plasma concentration:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clotting2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">clotting</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  log_plasma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  clot_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lot1</span>, <span class="va">lot2</span><span class="op">)</span>,</span>
<span>  lot_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_glm.html">stan_glm</a></span><span class="op">(</span><span class="va">clot_time</span> <span class="op">~</span> <span class="va">log_plasma</span> <span class="op">*</span> <span class="va">lot_id</span>, data <span class="op">=</span> <span class="va">clotting2</span>, family <span class="op">=</span> <span class="va">Gamma</span>, </span>
<span>                prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, autoscale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                prior <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, autoscale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>stan_glm
 family:       Gamma [inverse]
 formula:      clot_time ~ log_plasma * lot_id
 observations: 18
 predictors:   4
------
                   Median MAD_SD
(Intercept)        -0.016  0.007
log_plasma          0.015  0.003
lot_id2            -0.007  0.014
log_plasma:lot_id2  0.008  0.006

Auxiliary parameter(s):
      Median MAD_SD
shape 7.982  2.756 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>In the output above, the estimate reported for <code>shape</code> is
for the shape parameter of the Gamma distribution. The
<em>reciprocal</em> of the shape parameter can be interpreted similarly
to what <code>summary.glm</code> refers to as the dispersion
parameter.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Gelman, A. and Hill, J. (2007). <em>Data Analysis Using Regression
and Multilevel/Hierarchical Models.</em> Cambridge University Press,
Cambridge, UK.</p>
<p>McCullagh, P. and Nelder, J. A. (1989). <em>Generalized Linear
Models.</em> Chapman and Hall/CRC Press, New York.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
