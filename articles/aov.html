<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating ANOVA Models with rstanarm • rstanarm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating ANOVA Models with rstanarm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      rstanarm
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages">
<li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/rstanarm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Estimating ANOVA Models with rstanarm</h1>
                        <h4 data-toc-skip class="author">Jonah Gabry and
Ben Goodrich</h4>
            
            <h4 data-toc-skip class="date">2025-12-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/New-pkgdown-theme/vignettes/aov.Rmd" class="external-link"><code>vignettes/aov.Rmd</code></a></small>
      <div class="d-none name"><code>aov.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{stan_aov: ANOVA Models}
-->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/theme_default.html" class="external-link">theme_default</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette explains how to estimate ANalysis Of VAriance (ANOVA)
models using the <code>stan_aov</code> function in the
<strong>rstanarm</strong> package</p>
<p>The four steps of a Bayesian analysis are</p>
<ol style="list-style-type: decimal">
<li>Specify a joint distribution for the outcome(s) and all the
unknowns, which typically takes the form of a marginal prior
distribution for the unknowns multiplied by a likelihood for the
outcome(s) conditional on the unknowns. This joint distribution is
proportional to a posterior distribution of the unknowns conditional on
the observed data</li>
<li>Draw from posterior distribution using Markov Chain Monte Carlo
(MCMC).</li>
<li>Evaluate how well the model fits the data and possibly revise the
model.</li>
<li>Draw from the posterior predictive distribution of the outcome(s)
given interesting values of the predictors in order to visualize how a
manipulation of a predictor affects (a function of) the outcome(s).</li>
</ol>
<p>Steps 3 and 4 are covered in more depth by the vignette entitled <a href="rstanarm.html">“How to Use the <strong>rstanarm</strong>
Package”</a>. This vignette focuses on Step 1 when the likelihood is the
product of independent normal distributions. We also demonstrate that
Step 2 is not entirely automatic because it is sometimes necessary to
specify some additional tuning parameters in order to obtain optimally
efficient results.</p>
</div>
<div class="section level2">
<h2 id="likelihood">Likelihood<a class="anchor" aria-label="anchor" href="#likelihood"></a>
</h2>
<p>The likelihood for one observation under a linear model can be
written as a conditionally normal PDF <span class="math display">\[\frac{1}{\sigma_{\epsilon} \sqrt{2 \pi}}
  e^{-\frac{1}{2} \left(\frac{y -
\mu}{\sigma_{\epsilon}}\right)^2},\]</span> where <span class="math inline">\(\mu = \alpha + \mathbf{x}^\top
\boldsymbol{\beta}\)</span> is a linear predictor and <span class="math inline">\(\sigma_{\epsilon}\)</span> is the standard
deviation of the error in predicting the outcome, <span class="math inline">\(y\)</span>. The likelihood of the entire sample is
the product of <span class="math inline">\(N\)</span> individual
likelihood contributions.</p>
<p>An ANOVA model can be considered a special case of the above linear
regression model where each of the <span class="math inline">\(K\)</span> predictors in <span class="math inline">\(\mathbf{x}\)</span> is a dummy variable indicating
membership in a group. An equivalent linear predictor can be written as
<span class="math inline">\(\mu_j = \alpha + \alpha_j\)</span>, which
expresses the conditional expectation of the outcome in the <span class="math inline">\(j\)</span>-th group as the sum of a common mean,
<span class="math inline">\(\alpha\)</span>, and a group-specific
deviation from the common mean, <span class="math inline">\(\alpha_j\)</span>.</p>
</div>
<div class="section level2">
<h2 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h2>
<p>If we view the ANOVA model as a special case of a linear regression
model with only dummy variables as predictors, then the model could be
estimated using the prior specification in the <code>stan_lm</code>
function. In fact, this is exactly how the <code>stan_aov</code>
function is coded. These functions require the user to specify a value
for the prior location (by default the mode) of the <span class="math inline">\(R^2\)</span>, the proportion of variance in the
outcome attributable to the predictors under a linear model. This prior
specification is appealing in an ANOVA context because of the
fundamental identity <span class="math display">\[SS_{\mbox{total}} =
SS_{\mbox{model}} + SS_{\mbox{error}},\]</span> where <span class="math inline">\(SS\)</span> stands for sum-of-squares. If we
normalize this identity, we obtain the tautology <span class="math inline">\(1 = R^2 + \left(1 - R^2\right)\)</span> but it is
reasonable to expect a researcher to have a plausible guess for <span class="math inline">\(R^2\)</span> before conducting an ANOVA. See the
<a href="lm.html">vignette</a> for the <code>stan_lm</code> function
(regularized linear models) for more information on this approach.</p>
<p>If we view the ANOVA model as a difference of means, then the model
could be estimated using the prior specification in the
<code>stan_lmer</code> function. In the syntax popularized by the
<strong>lme4</strong> package, <code>y ~ 1 + (1|group)</code> represents
a likelihood where <span class="math inline">\(\mu_j = \alpha +
\alpha_j\)</span> and <span class="math inline">\(\alpha_j\)</span> is
normally distributed across the <span class="math inline">\(J\)</span>
groups with mean zero and some unknown standard deviation. The
<code>stan_lmer</code> function specifies that this standard deviation
has a Gamma prior with, by default, both its shape and scale parameters
equal to <span class="math inline">\(1\)</span>, which is just an
standard exponential distribution. However, the shape and scale
parameters can be specified as other positive values. This approach also
requires specifying a prior distribution on the standard deviation of
the errors that is independent of the prior distribution for each <span class="math inline">\(\alpha_j\)</span>. See the <a href="glmer.html">vignette</a> for the <code>stan_glmer</code> function
(<strong>lme4</strong>-style models using <strong>rstanarm</strong>) for
more information on this approach.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>We will utilize an example from the <strong>HSAUR3</strong> package
by Brian S. Everitt and Torsten Hothorn, which is used in their 2014
book <em>A Handbook of Statistical Analyses Using R (3rd Edition)</em>
(Chapman &amp; Hall / CRC). This book is frequentist in nature and we
will show how to obtain the corresponding Bayesian results.</p>
<p>The model in section 4.3.1 analyzes an experiment where rats were
subjected to different diets in order to see how much weight they
gained. The experimental factors were whether their diet had low or high
protein and whether the protein was derived from beef or cereal. Before
seeing the data, one might expect that a moderate proportion of the
variance in weight gain might be attributed to protein (source) in the
diet. The frequentist ANOVA estimates can be obtained:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"weightgain"</span>, package <span class="op">=</span> <span class="st">"HSAUR3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">weightgain</span> <span class="op">~</span> <span class="va">source</span> <span class="op">*</span> <span class="va">type</span>, data <span class="op">=</span> <span class="va">weightgain</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>         (Intercept)         sourceCereal              typeLow 
               100.0                -14.1                -20.8 
sourceCereal:typeLow 
                18.8 </code></pre>
<p>To obtain Bayesian estimates we can prepend <code>stan_</code> to
<code>aov</code> and specify the prior location of the <span class="math inline">\(R^2\)</span> as well as optionally the number of
cores that the computer is allowed to utilize:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span></span>
<span><span class="va">post1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_lm.html">stan_aov</a></span><span class="op">(</span><span class="va">weightgain</span> <span class="op">~</span> <span class="va">source</span> <span class="op">*</span> <span class="va">type</span>, data <span class="op">=</span> <span class="va">weightgain</span>, </span>
<span>                  prior <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">R2</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, adapt_delta <span class="op">=</span> <span class="fl">0.999</span>,</span>
<span>                  seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">post1</span></span></code></pre></div>
<pre><code>stan_aov
 family:       gaussian [identity]
 formula:      weightgain ~ source * type
 observations: 40
 predictors:   4
------
                     Median MAD_SD
(Intercept)           98.7    4.6 
sourceCereal         -12.8    6.2 
typeLow              -18.6    6.4 
sourceCereal:typeLow  16.8    8.8 

Auxiliary parameter(s):
              Median MAD_SD
R2             0.2    0.1  
log-fit_ratio  0.0    0.1  
sigma         14.7    1.6  

ANOVA-like table:
                    Median MAD_SD
Mean Sq source      546.9  421.7 
Mean Sq type        961.6  583.8 
Mean Sq source:type 707.1  701.6 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>Here we have specified <code>adapt_delta = 0.999</code> to decrease
the stepsize and largely prevent divergent transitions. See the
Troubleshooting section in the main rstanarm <a href="rstanarm.html">vignette</a> for more details about
<code>adapt_delta</code>. Also, our prior guess that <span class="math inline">\(R^2 = 0.5\)</span> was overly optimistic. However,
the frequentist estimates presumably overfit the data even more.</p>
<p>Alternatively, we could prepend <code>stan_</code> to
<code>lmer</code> and specify the corresponding priors</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_glmer.html">stan_lmer</a></span><span class="op">(</span><span class="va">weightgain</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">source</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">type</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">source</span><span class="op">:</span><span class="va">type</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">weightgain</span>, prior_intercept <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">cauchy</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   prior_covariance <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">decov</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, scale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   adapt_delta <span class="op">=</span> <span class="fl">0.999</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></code></pre></div>
<p>Comparing these two models using the <code>loo</code> function in the
<strong>loo</strong> package reveals a negligible preference for the
first approach that is almost entirely due to its having a smaller
number of effective parameters as a result of the more regularizing
priors. However, the difference is so small that it may seem
advantageous to present the second results which are more in line with a
mainstream Bayesian approach to an ANOVA model.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette has compared and contrasted two approaches to
estimating an ANOVA model with Bayesian techniques using the
<strong>rstanarm</strong> package. They both have the same likelihood,
so the (small in this case) differences in the results are attributable
to differences in the priors.</p>
<p>The <code>stan_aov</code> approach just calls <code>stan_lm</code>
and thus only requires a prior location on the <span class="math inline">\(R^2\)</span> of the linear model. This seems
rather easy to do in the context of an ANOVA decomposition of the total
sum-of-squares in the outcome into model sum-of-squares and residual
sum-of-squares.</p>
<p>The <code>stan_lmer</code> approach just calls <code>stan_glm</code>
but specifies a normal prior with mean zero for the deviations from
<span class="math inline">\(\alpha\)</span> across groups. This is more
in line with what most Bayesians would do naturally — particularly if
the factors were considered “random” — but also requires a prior for
<span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\sigma\)</span>, and the standard deviation of the
normal prior on the group-level intercepts. The <code>stan_lmer</code>
approach is very flexible and might be more appropriate for more
complicated experimental designs.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
